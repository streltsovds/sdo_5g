/**
 * @class eli18n
 * Javascript applications localization 
 *
 * @param Object o - class options. Object. {textdomain : 'имя_группы_сообщений', messages : {textdomain1 : {}[, textdomain2 : {}]...}}
 *
 * Usage:
 * 
 * var msgs = { Hello : 'Превэд', 'Hello %user' : 'Превед %user' };
 * //load messages and set default textdomain
 * var translator = new eli18n( {textdomain : 'test', messages : {test : msgs}} )
 * window.console.log(translator.translate('Hello'));
 * window.console.log(translator.format('Hello %user', {user : 'David Blain'}))
 * // create new textdomain
 * translator.load({test2 : {'Goodbye' : 'Ja, deva mata!'} })
 * // and use it, without changing default one
 * window.console.log(translator.translate('Goodbye', 'test2'));
 *
 * @author:    Dmitry (dio) Levashov dio@std42.ru
 * license:   BSD license
 **/function eli18n(a){this.textdomain=function(a){return this.messages[a]?this._domain=a:this._domain},a&&a.messages&&this.load(a.messages),a&&a.textdomain&&this.textdomain(a.textdomain)}function elDialogForm(a){var b=this,c={"class":"el-dialogform",submit:function(a,b){b.close()},form:{action:window.location.href,method:"post"},ajaxForm:null,validate:null,spinner:"Loading",tabs:{active:0,selected:0},tabPrefix:"el-df-tab-",dialog:{title:"dialog",dialogClass:"el-dialogform-container",autoOpen:!1,modal:!0,resizable:!1,closeOnEscape:!0,buttons:[{text:a.rte.i18n("Cancel"),click:function(){b.close()}},{text:"Ok",click:function(){b.form.trigger("submit")}}]}};this.opts=jQuery.extend(!0,{},c,a),this.opts.dialog.close=function(){b.close()},this.opts.rtl&&(this.opts["class"]+=" el-dialogform-rtl"),a&&a.dialog&&a.dialog.buttons&&typeof a.dialog.buttons=="object"&&(this.opts.dialog.buttons=a.dialog.buttons),this.ul=null,this.tabs={},this._table=null,this.dialog=jQuery("<div />").addClass(this.opts["class"]).dialog(this.opts.dialog),this.message=jQuery('<div class="el-dialogform-message rounded-5" />').hide().appendTo(this.dialog),this.error=jQuery('<div class="el-dialogform-error rounded-5" />').hide().appendTo(this.dialog),this.spinner=jQuery('<div class="spinner" />').hide().appendTo(this.dialog),this.content=jQuery('<div class="el-dialogform-content" />').appendTo(this.dialog),this.form=jQuery("<form />").attr(this.opts.form).appendTo(this.content),this.opts.submit&&this.form.bind("submit",function(a){b.opts.submit(a,b)}),this.opts.ajaxForm&&jQuery.fn.ajaxForm&&this.form.ajaxForm(this.opts.ajaxForm),this.opts.validate&&this.form.validate(this.opts.validate),this.option=function(a,b){return this.dialog.dialog("option",a,b)},this.showError=function(a,b){return this.hideMessage(),this.hideSpinner(),this.error.html(a).show(),b&&this.content.hide(),this},this.hideError=function(){return this.error.text("").hide(),this.content.show(),this},this.showSpinner=function(a){return this.error.hide(),this.message.hide(),this.content.hide(),this.spinner.text(a||this.opts.spinner).show(),this.option("buttons",{}),this},this.hideSpinner=function(){return this.content.show(),this.spinner.hide(),this},this.showMessage=function(a,b){return this.hideError(),this.hideSpinner(),this.message.html(a||"").show(),b&&this.content.hide(),this},this.hideMessage=function(){return this.message.hide(),this.content.show(),this},this.tab=function(a,b){return a=this.opts.tabPrefix+a,this.ul||(this.ul=jQuery("<ul />").prependTo(this.form)),jQuery("<li />").append(jQuery("<a />").attr("href","#"+a).html(b)).appendTo(this.ul),this.tabs[a]={tab:jQuery("<div />").attr("id",a).addClass("tab").appendTo(this.form),table:null},this},this.table=function(a){return a=a&&a.indexOf(this.opts.tabPrefix)==-1?this.opts.tabPrefix+a:a,a&&this.tabs&&this.tabs[a]?this.tabs[a].table=jQuery("<table />").appendTo(this.tabs[a].tab):this._table=jQuery("<table />").appendTo(this.form),this},this.append=function(a,b,c){b=b?"el-df-tab-"+b:"";if(!a)return this;if(b&&this.tabs[b])if(c){!this.tabs[b].table&&this.table(b);var d=jQuery("<tr />").appendTo(this.tabs[b].table);if(!jQuery.isArray(a))d.append(jQuery("<td />").append(a));else for(var e=0;e<a.length;e++)d.append(jQuery("<td />").append(a[e]))}else if(!jQuery.isArray(a))this.tabs[b].tab.append(a);else for(var e=0;e<a.length;e++)this.tabs[b].tab.append(a[e]);else if(!c)if(!jQuery.isArray(a))this.form.append(a);else for(var e=0;e<a.length;e++)this.form.append(a[e]);else{this._table||this.table();var d=jQuery("<tr />").appendTo(this._table);if(!jQuery.isArray(a))d.append(jQuery("<td />").append(a));else for(var e=0;e<a.length;e++)d.append(jQuery("<td />").append(a[e]))}return this},this.separator=function(a){return a="el-df-tab-"+a,this.tabs&&this.tabs[a]?(this.tabs[a].tab.append(jQuery("<div />").addClass("separator")),this.tabs[a].table&&this.table(a)):this.form.append(jQuery("<div />").addClass("separator")),this},this.open=function(){var a=this;return this.ul&&this.form.tabs(this.opts.tabs),setTimeout(function(){a.dialog.find(":text").keydown(function(b){b.keyCode==13&&(b.preventDefault(),a.form.submit())}).filter(":first")[0].focus()},200),this.dialog.dialog("open"),this},this.close=function(){typeof this.opts.close=="function"&&this.opts.close(),this.dialog.dialog("destroy")}}eli18n.prototype=new function(){this.messages={},this._domain="",this.load=function(a){if(typeof a=="object")for(var b in a){var c=a[b];if(typeof c=="object"){this.messages[b]||(this.messages[b]={});for(var d in c)typeof c[d]=="string"&&(this.messages[b][d]=c[d])}}return this},this.translate=function(a,b){var b=b&&this.messages[b]?b:this._domain;return this.messages[b]&&this.messages[b][a]?this.messages[b][a]:a},this.format=function(a,b,c){a=this.translate(a,c);if(typeof b=="object")for(var d in b)a=a.replace("%"+d,this.translate(b[d],c));return a}},function(a){a.fn.elColorPicker=function(b){function e(a){c.val(a),d.change&&d.change(c.val()),c.palette.slideUp()}function f(){c.palette=a("<div />").addClass(d.paletteClass+" rounded-3");for(var b=0;b<d.colors.length;b++)a("<div />").addClass("color").css("background-color",d.colors[b]).attr({title:d.colors[b],unselectable:"on"}).appendTo(c.palette).mouseenter(function(){var b=a(this).attr("title");c.input.val(b),c.preview.css("background-color",b)}).click(function(b){b.stopPropagation(),e(a(this).attr("title"))});c.input=a('<input type="text" />').addClass("rounded-3").attr("size",8).click(function(b){b.stopPropagation(),a(this).focus()}).keydown(function(b){if(b.ctrlKey||b.metaKey)return!0;var d=b.keyCode;if(d==27)return c.mouseleave();if(d!=8&&d!=13&&d!=46&&d!=37&&d!=39&&(d<48||d>57)&&(d<65||d>70))return!1;var f=a(this).val();if(f.length==7||f.length==0){d==13&&(b.stopPropagation(),b.preventDefault(),e(f),c.palette.slideUp());if(b.keyCode!=8&&b.keyCode!=46&&d!=37&&d!=39)return!1}}).keyup(function(b){var d=a(this).val();d.length==7&&/^#[0-9abcdef]{6}$/i.test(d)&&c.val(d)}),c.preview=a("<div />").addClass("preview rounded-3").click(function(a){a.stopPropagation(),e(c.input.val())}),c.palette.append(a("<div />").addClass("clearfix")).append(a("<div />").addClass("panel").append(c.input).append(c.preview)),d.palettePosition=="outer"?(c.palette.hide().appendTo(c.parents("body").eq(0)).mouseleave(function(){c.palette.is(":animated")||(a(this).slideUp(),c.val(c.val()))}),c.mouseleave(function(a){a.relatedTarget!=c.palette.get(0)&&(c.palette.is(":animated")||(c.palette.slideUp(),c.val(c.val())))})):c.append(c.palette.hide()).mouseleave(function(a){c.palette.slideUp(),c.val(c.val())}),c.val(c.val())}var c=this,d=a.extend({},a.fn.elColorPicker.defaults,b);return this.hidden=a('<input type="hidden" />').attr("name",d.name).val(d.color||"").appendTo(this),this.palette=null,this.preview=null,this.input=null,this.empty().addClass(d["class"]+" rounded-3").css({position:"relative","background-color":d.color||""}).click(function(b){if(!c.hasClass("disabled")){!c.palette&&f();if(d.palettePosition=="outer"&&c.palette.css("display")=="none"){var e=a(this).offset(),g=c.palette.width(),h=c.parents("body").width()-e.left>=g?e.left:e.left+a(this).outerWidth()-g;c.palette.css({left:h+"px",top:e.top+a(this).height()+1+"px"})}c.palette.slideToggle()}}),this.val=function(a){return!a&&a!==""?this.hidden.val():(this.hidden.val(a),d.update?d.update(this.hidden.val()):this.css("background-color",a),c.palette&&(c.preview.css("background-color",a),c.input.val(a)),this)},this},a.fn.elColorPicker.defaults={"class":"el-colorpicker",paletteClass:"el-palette",palettePosition:"inner",name:"color",color:"",update:null,change:function(a){},colors:["#ffffff","#cccccc","#999999","#666666","#333333","#000000","#ffcccc","#cc9999","#996666","#663333","#330000","#ff9999","#cc6666","#cc3333","#993333","#660000","#ff6666","#ff3333","#ff0000","#cc0000","#990000","#ff9966","#ff6633","#ff3300","#cc3300","#993300","#ffcc99","#cc9966","#cc6633","#996633","#663300","#ff9933","#ff6600","#ff9900","#cc6600","#cc9933","#ffcc66","#ffcc33","#ffcc00","#cc9900","#996600","#ffffcc","#cccc99","#999966","#666633","#333300","#ffff99","#cccc66","#cccc33","#999933","#666600","#ffff66","#ffff33","#ffff00","#cccc00","#999900","#ccff66","#ccff33","#ccff00","#99cc00","#669900","#ccff99","#99cc66","#99cc33","#669933","#336600","#99ff33","#99ff00","#66ff00","#66cc00","#66cc33","#99ff66","#66ff33","#33ff00","#33cc00","#339900","#ccffcc","#99cc99","#669966","#336633","#003300","#99ff99","#66cc66","#33cc33","#339933","#006600","#66ff66","#33ff33","#00ff00","#00cc00","#009900","#66ff99","#33ff66","#00ff33","#00cc33","#009933","#99ffcc","#66cc99","#33cc66","#339966","#006633","#33ff99","#00ff66","#00ff99","#00cc66","#33cc99","#66ffcc","#33ffcc","#00ffcc","#00cc99","#009966","#ccffff","#99cccc","#669999","#336666","#003333","#99ffff","#66cccc","#33cccc","#339999","#006666","#66cccc","#33ffff","#00ffff","#00cccc","#009999","#66ccff","#33ccff","#00ccff","#0099cc","#006699","#99ccff","#6699cc","#3399cc","#336699","#003366","#3399ff","#0099ff","#0066ff","#066ccc","#3366cc","#6699ff","#3366ff","#0033ff","#0033cc","#003399","#ccccff","#9999cc","#666699","#333366","#000033","#9999ff","#6666cc","#3333cc","#333399","#000066","#6666ff","#3333ff","#0000ff","#0000cc","#009999","#9966ff","#6633ff","#3300ff","#3300cc","#330099","#cc99ff","#9966cc","#6633cc","#663399","#330066","#9933ff","#6600ff","#9900ff","#6600cc","#9933cc","#cc66ff","#cc33ff","#cc00ff","#9900cc","#660099","#ffccff","#cc99cc","#996699","#663366","#330033","#ff99ff","#cc66cc","#cc33cc","#993399","#660066","#ff66ff","#ff33ff","#ff00ff","#cc00cc","#990099","#ff66cc","#ff33cc","#ff00cc","#cc0099","#990066","#ff99cc","#cc6699","#cc3399","#993366","#660033","#ff3399","#ff0099","#ff0066","#cc0066","#cc3366","#ff6699","#ff3366","#ff0033","#cc0033","#990033"]}}(jQuery),function(a){a.fn.elBorderSelect=function(b){function i(a){function b(a){return hexDigits=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],a?hexDigits[(a-a%16)/16]+hexDigits[a%16]:"00"}var c=(a||"").match(/\(([0-9]{1,3}),\s*([0-9]{1,3}),\s*([0-9]{1,3})\)/);return c?"#"+b(c[1])+b(c[2])+b(c[3]):""}function j(b){if(!b)return b;var c=b.match(/([0-9]+\.?[0-9]*)\s*(px|pt|em|%)/);c&&(b=c[1],unit=c[2]),b[0]=="."&&(b="0"+b),b=parseFloat(b);if(isNaN(b))return"";var d=parseInt(a(document.body).css("font-size"))||16;switch(unit){case"em":return parseInt(b*d);case"pt":return parseInt(b*d/12);case"%":return parseInt(b*d/100)}return b}var c=this,d=this.eq(0),e=a.extend({},a.fn.elBorderSelect.defaults,b),f=a('<input type="text" />').attr({name:e.name+"[width]",size:3}).css("text-align","right").change(function(){c.change()}),g=a("<div />").css("position","relative").elColorPicker({"class":"el-colorpicker ui-icon ui-icon-pencil",name:e.name+"[color]",palettePosition:"outer",change:function(){c.change()}}),h=a("<div />").elSelect({tpl:'<div style="border-bottom:4px %val #000;width:100%;margin:7px 0"> </div>',tpls:{"":"%label"},maxHeight:e.styleHeight||null,select:function(){c.change()},src:{"":"none",solid:"solid",dashed:"dashed",dotted:"dotted","double":"double",groove:"groove",ridge:"ridge",inset:"inset",outset:"outset"}});return d.empty().addClass(e["class"]).attr("name",e.name||"").append(a("<table />").attr("cellspacing",0).append(a("<tr />").append(a("<td />").append(f).append(" px")).append(a("<td />").append(h)).append(a("<td />").append(g)))),this.change=function(){e.change&&e.change(this.val())},this.val=function(b){var c,d,e,k,l;return!b&&b!==""?(c=parseInt(f.val()),c=isNaN(c)?"":c+"px",d=h.val(),e=g.val(),{width:c,style:d,color:e,css:a.trim(c+" "+d+" "+e)}):(k="",b.nodeName||b.css?(b.css||(b=a(b)),k=b.css("border"),(k=b.css("border"))?c=d=e=k:(c=b.css("border-width"),d=b.css("border-style"),e=b.css("border-color"))):(c=b.width||"",d=b.style||"",e=b.color||""),f.val(j(c)),l=d?d.match(/(solid|dashed|dotted|double|groove|ridge|inset|outset)/i):"",h.val(l?l[1]:""),g.val(e.indexOf("#")===0?e:i(e)),this)},this.val(e.value),this},a.fn.elBorderSelect.defaults={name:"el-borderselect","class":"el-borderselect",value:{},change:null}}(jQuery),function(a){a.fn.elPaddingInput=function(b){function e(b){return b=a.trim(b.toString()),b[0]=="."&&(b="0"+b),n=parseFloat(b),isNaN(n)?b=="auto"?b:"":n}function f(){d.change&&d.change(c)}var c=this,d=a.extend({},a.fn.elPaddingInput.defaults,{name:this.attr("name")},b);return this.regexps={main:new RegExp(d.type=="padding"?'paddings*:s*([^;"]+)':'margins*:s*([^;"]+)',"im"),left:new RegExp(d.type=="padding"?'padding-lefts*:s*([^;"]+)':'margin-lefts*:s*([^;"]+)',"im"),top:new RegExp(d.type=="padding"?'padding-tops*:s*([^;"]+)':'margin-tops*:s*([^;"]+)',"im"),right:new RegExp(d.type=="padding"?'padding-rights*:s*([^;"]+)':'margin-rights*:s*([^;"]+)',"im"),bottom:new RegExp(d.type=="padding"?'padding-bottoms*:s*([^;"]+)':'margin-bottoms*:s*([^;"]+)',"im")},a.each(["left","top","right","bottom"],function(){c[this]=a('<input type="text" />').attr("size",3).css("text-align","right").css("border-"+this,"2px solid red").bind("change",function(){a(this).val(e(a(this).val())),f()}).attr("name",d.name+"["+this+"]")}),a.each(["uleft","utop","uright","ubottom"],function(){c[this]=a("<select />").append('<option value="px">px</option>').append('<option value="em">em</option>').append('<option value="pt">pt</option>').bind("change",function(){f()}).attr("name",d.name+"["+this+"]"),d.percents&&c[this].append('<option value="%">%</option>')}),this.empty().addClass(d["class"]).append(this.left).append(this.uleft).append(" x ").append(this.top).append(this.utop).append(" x ").append(this.right).append(this.uright).append(" x ").append(this.bottom).append(this.ubottom),this.val=function(b){if(!b&&b!==""){var d=e(this.left.val()),f=e(this.top.val()),g=e(this.right.val()),h=e(this.bottom.val()),i={left:d=="auto"||d==0?d:d!==""?d+this.uleft.val():"",top:f=="auto"||f==0?f:f!==""?f+this.utop.val():"",right:g=="auto"||g==0?g:g!==""?g+this.uright.val():"",bottom:h=="auto"||h==0?h:h!==""?h+this.ubottom.val():"",css:""};return i.left!==""&&i.right!==""&&i.top!==""&&i.bottom!==""&&(i.left==i.right&&i.top==i.bottom?i.css=i.top+" "+i.left:i.css=i.top+" "+i.right+" "+i.bottom+" "+i.left),i}if(b.nodeName||b.css){b.css||(b=a(b));var j={left:"",top:"",right:"",bottom:""},k=(b.attr("style")||"").toLowerCase();if(k){k=a.trim(k);var l=k.match(this.regexps.main);if(l){var m=a.trim(l[1]).replace(/\s+/g," ").split(" ",4);j.top=m[0],j.right=m[1]&&m[1]!==""?m[1]:j.top,j.bottom=m[2]&&m[2]!==""?m[2]:j.top,j.left=m[3]&&m[3]!==""?m[3]:j.right}else a.each(["left","top","right","bottom"],function(){var a=this.toString();l=k.match(c.regexps[a]),l&&(j[a]=l[1])})}var b=j}return a.each(["left","top","right","bottom"],function(){var a=this.toString();c[a].val(""),c["u"+a].val();if(typeof b[a]!="undefined"&&b[a]!==null){b[a]=b[a].toString();var d=e(b[a]);c[a].val(d);var f=b[a].match(/(px|em|pt|%)/i);c["u"+a].val(f?f[1]:"px")}}),this},this.val(d.value),this},a.fn.elPaddingInput.defaults={name:"el-paddinginput","class":"el-paddinginput",type:"padding",value:{},percents:!0,change:null}}(jQuery),function(a){a.fn.elSelect=function(b){function l(a){var b=e.labelTpl||e.tpls[a]||e.tpl;g.html(b.replace(/%val/g,a).replace(/%label/,e.src[a])).children().attr({unselectable:"on"})}function m(){h=a("<div />").addClass(e.listClass+" rounded-3").hide().appendTo(d.mouseleave(function(a){h.slideUp()}));for(var b in e.src){var g=e.tpls[b]||e.tpl;a("<div />").attr("name",b).append(a(g.replace(/%val/g,b).replace(/%label/g,e.src[b])).attr({unselectable:"on"})).appendTo(h).hover(function(){a(this).addClass("hover")},function(){a(this).removeClass("hover")}).click(function(b){b.stopPropagation(),b.preventDefault();var d=a(this).attr("name");c.val(d),e.select(d),h.slideUp()})}var i=d.outerWidth();h.width()<i&&h.width(i);var j=h.height();e.maxHeight>0&&j>e.maxHeight&&h.height(e.maxHeight),c.val(f.val())}var c=this,d=this.eq(0),e=a.extend({},a.fn.elSelect.defaults,b),f=a('<input type="hidden" />').attr("name",e.name),g=a("<label />").attr({unselectable:"on"}).addClass("rounded-left-3"),h=null,i=null;d.get(0).nodeName=="SELECT"&&(e.src={},d.children("option").each(function(){e.src[a(this).val()]=a(this).text()}),e.value=d.val(),e.name=d.attr("name"),d.replaceWith(d=a("<div />")));if(!e.value||!e.src[e.val]){e.value=null;var j=0;for(var k in e.src)j++==0&&(e.value=k)}return this.val=function(b){return!b&&b!==""?f.val():(e.src[b]&&(f.val(b),l(b),h&&h.children().each(function(){a(this).attr("name")==b?a(this).addClass("active"):a(this).removeClass("active")})),this)},d.empty().addClass(e["class"]+" rounded-3").attr({unselectable:"on"}).append(f).append(g).hover(function(){a(this).addClass("hover")},function(){a(this).removeClass("hover")}).click(function(b){!h&&m(),h.slideToggle(),a.browser.msie&&!i&&(h.children().each(function(){i=Math.max(i,a(this).width())}),i>h.width()&&h.width(i+40))}),this.val(e.value),this},a.fn.elSelect.defaults={name:"el-select","class":"el-select",listClass:"list",labelTpl:null,tpl:"<%val>%label</%val>",tpls:{},value:null,src:{},select:function(a){window.console&&window.console.log&&window.console.log("selected: "+a)},maxHeight:410}}(jQuery),function(a){elRTE=function(b,c){if(!b||!b.nodeName)return alert('elRTE: argument "target" is not DOM Element');var d=this,e;this.version="1.3",this.build="2011-06-23",this.options=a.extend(!0,{},this.options,c),this.browser=a.browser,this.target=a(b),this.lang=""+this.options.lang,this._i18n=new eli18n({textdomain:"rte",messages:{rte:this.i18Messages[this.lang]||{}}}),this.rtl=!!/^(ar|fa|he)$/.test(this.lang)&&!!this.i18Messages[this.lang],this.rtl&&(this.options.cssClass+=" el-rte-rtl"),this.toolbar=a('<div class="toolbar"/>'),this.iframe=document.createElement("iframe"),this.iframe.setAttribute("frameborder",0),this.workzone=a('<div class="workzone"/>').append(this.iframe).append(this.source),this.statusbar=a('<div class="statusbar"/>'),this.tabsbar=a('<div class="tabsbar"/>'),this.editor=a('<div class="'+this.options.cssClass+'" />').append(this.toolbar).append(this.workzone).append(this.statusbar).append(this.tabsbar),this.doc=null,this.$doc=null,this.window=null,this.utils=new this.utils(this),this.dom=new this.dom(this),this.filter=new this.filter(this),this.updateHeight=function(){d.workzone.add(d.iframe).add(d.source).height(d.workzone.height())},this.resizable=function(b){var c=this;this.options.resizable&&a.fn.resizable&&(b?this.editor.resizable({handles:"se",alsoResize:this.workzone,minWidth:300,minHeight:200}).bind("resize",c.updateHeight):this.editor.resizable("destroy").unbind("resize",c.updateHeight))},this.editor.insertAfter(b);var f="";b.nodeName=="TEXTAREA"?(this.source=this.target,this.source.insertAfter(this.iframe).hide(),f=this.target.val()):(this.source=a("<textarea />").insertAfter(this.iframe).hide(),f=this.target.hide().html()),this.source.attr("name",this.target.attr("name")||this.target.attr("id")),f=a.trim(f),f||(f=" "),this.options.allowSource&&this.tabsbar.append('<div class="tab editor rounded-bottom-7 active">'+d.i18n("Editor")+'</div><div class="tab source rounded-bottom-7">'+d.i18n("Source")+'</div><div class="clearfix" style="clear:both"/>').children(".tab").click(function(b){a(this).hasClass("active")||(d.tabsbar.children(".tab").toggleClass("active"),d.workzone.children().toggle(),a(this).hasClass("editor")?(d.updateEditor(),d.window.focus(),d.ui.update(!0)):(d.updateSource(),d.source.focus(),a.browser.msie||d.source[0].setSelectionRange(0,0),d.ui.disable(),d.statusbar.empty()))}),this.window=this.iframe.contentWindow,this.doc=this.iframe.contentWindow.document,this.$doc=a(this.doc),e='<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />',a.each(d.options.cssfiles,function(){e+='<link rel="stylesheet" type="text/css" href="'+this+'" />'}),this.doc.open();var g=this.filter.wysiwyg(f),h=this.rtl?' class="el-rte-rtl"':"";this.doc.write(d.options.doctype+e+"</head><body"+h+">"+g+"</body></html>"),this.doc.close();if(a.browser.msie)this.doc.body.contentEditable=!0;else{try{this.doc.designMode="on"}catch(i){}this.doc.execCommand("styleWithCSS",!1,this.options.styleWithCSS)}this.options.height>0&&this.workzone.height(this.options.height),this.options.width>0&&this.editor.width(this.options.width),this.updateHeight(),this.resizable(!0),this.window.focus(),this.history=new this.history(this),this.selection=new this.selection(this),this.ui=new this.ui(this),this.target.parents("form").bind("submit.elfinder",function(a){d.source.parents("form").find('[name="el-select"]').remove(),d.beforeSave()}),this.source.bind("keydown",function(b){if(b.keyCode==9){b.preventDefault();if(a.browser.msie){var c=document.selection.createRange();c.text="\t"+c.text,this.focus()}else{var d=this.value.substr(0,this.selectionStart),e=this.value.substr(this.selectionEnd);this.value=d+"\t"+e,this.setSelectionRange(d.length+1,d.length+1)}}}),a(this.doc.body).bind("dragend",function(a){setTimeout(function(){try{d.window.focus();var a=d.selection.getBookmark();d.selection.moveToBookmark(a),d.ui.update()}catch(b){}},200)}),this.typing=!1,this.lastKey=null,this.$doc.bind("mouseup",function(){d.typing=!1,d.lastKey=null,d.ui.update()}).bind("keyup",function(a){(a.keyCode>=8&&a.keyCode<=13||a.keyCode>=32&&a.keyCode<=40||a.keyCode==46||a.keyCode>=96&&a.keyCode<=111)&&d.ui.update()}).bind("keydown",function(b){if((b.metaKey||b.ctrlKey)&&b.keyCode==65)d.ui.update();else if(b.keyCode==13){var c=d.selection.getNode();if(d.dom.selfOrParent(c,/^PRE$/))return d.selection.insertNode(d.doc.createTextNode("\r\n")),!1;if(a.browser.safari&&b.shiftKey)return d.selection.insertNode(d.doc.createElement("br")),!1}if(b.keyCode>=48&&b.keyCode<=57||b.keyCode==61||b.keyCode==109||b.keyCode>=65&&b.keyCode<=90||b.keyCode==188||b.keyCode==190||b.keyCode==191||b.keyCode>=219&&b.keyCode<=222)d.typing||d.history.add(!0),d.typing=!0,d.lastKey=null;else if(b.keyCode==8||b.keyCode==46||b.keyCode==32||b.keyCode==13)b.keyCode!=d.lastKey&&d.history.add(!0),d.lastKey=b.keyCode,d.typing=!1;if(b.keyCode==32&&a.browser.opera)return d.selection.insertNode(d.doc.createTextNode(" ")),!1}).bind("paste",function(b){if(!d.options.allowPaste)b.stopPropagation(),b.preventDefault();else{var c=a(d.dom.create("div"))[0],e=d.doc.createTextNode("_");d.history.add(!0),d.typing=!0,d.lastKey=null,c.appendChild(e),d.selection.deleteContents().insertNode(c),d.selection.select(e),setTimeout(function(){c.parentNode?(a(c).html(d.filter.proccess("paste",a(c).html())),e=c.lastChild,d.dom.unwrap(c),e&&(d.selection.select(e),d.selection.collapse(!1))):(c.parentNode&&c.parentNode.removeChild(c),d.val(d.filter.proccess("paste",d.filter.wysiwyg2wysiwyg(a(d.doc.body).html()))),d.selection.select(d.doc.body.firstChild),d.selection.collapse(!0)),a(d.doc.body).mouseup()},15)}}),a.browser.msie&&this.$doc.bind("keyup",function(b){b.keyCode==86&&(b.metaKey||b.ctrlKey)&&(d.history.add(!0),d.typing=!0,d.lastKey=null,d.selection.saveIERange(),d.val(d.filter.proccess("paste",d.filter.wysiwyg2wysiwyg(a(d.doc.body).html()))),d.selection.restoreIERange(),a(d.doc.body).mouseup(),this.ui.update())}),a.browser.safari&&this.$doc.bind("click",function(b){a(d.doc.body).find(".elrte-webkit-hl").removeClass("elrte-webkit-hl"),b.target.nodeName=="IMG"&&a(b.target).addClass("elrte-webkit-hl")}).bind("keyup",function(b){a(d.doc.body).find(".elrte-webkit-hl").removeClass("elrte-webkit-hl")}),this.window.focus(),this.destroy=function(){this.updateSource(),this.target.is("textarea")?this.target.val(a.trim(this.source.val())):this.target.html(a.trim(this.source.val())),this.editor.remove(),this.target.show().parents("form").unbind("submit.elfinder")}},elRTE.prototype.i18n=function(a){return this._i18n.translate(a)},elRTE.prototype.open=function(){this.editor.show()},elRTE.prototype.close=function(){this.editor.hide()},elRTE.prototype.updateEditor=function(){this.val(this.source.val())},elRTE.prototype.updateSource=function(){this.source.val(this.filter.source(a(this.doc.body).html()))},elRTE.prototype.val=function(b){if(typeof b=="string")b=""+b,this.source.is(":visible")?this.source.val(this.filter.source2source(b)):a.browser.msie?(this.doc.body.innerHTML="<br />"+this.filter.wysiwyg(b),this.doc.body.removeChild(this.doc.body.firstChild)):this.doc.body.innerHTML=this.filter.wysiwyg(b);else return this.source.is(":visible")?a.trim(this.filter.source2source(this.source.val())):a.trim(this.filter.source(a(this.doc.body).html()))},elRTE.prototype.beforeSave=function(){this.source.val(a.trim(this.val())||"")},elRTE.prototype.save=function(){this.beforeSave(),this.editor.parents("form").submit()},elRTE.prototype.log=function(a){window.console&&window.console.log&&window.console.log(a)},elRTE.prototype.i18Messages={},a.fn.elrte=function(a,b){var c=typeof a=="string"?a:"",d;return this.each(function(){this.elrte||(this.elrte=new elRTE(this,typeof a=="object"?a:{}));switch(c){case"open":case"show":this.elrte.open();break;case"close":case"hide":this.elrte.close();break;case"updateSource":this.elrte.updateSource();break;case"destroy":this.elrte.destroy()}}),c=="val"?this.length?this.length==1?b?this[0].elrte.val(b):this[0].elrte.val():(d={},this.each(function(){d[this.elrte.source.attr("name")]=this.elrte.val()}),d):"":this}}(jQuery),function(a){elRTE.prototype.dom=function(b){this.rte=b;var c=this;this.regExp={textNodes:/^(A|ABBR|ACRONYM|ADDRESS|B|BDO|BIG|BLOCKQUOTE|CAPTION|CENTER|CITE|CODE|DD|DEL|DFN|DIV|DT|EM|FIELDSET|FONT|H[1-6]|I|INS|KBD|LABEL|LEGEND|LI|MARQUEE|NOBR|NOEMBED|P|PRE|Q|SAMP|SMALL|SPAN|STRIKE|STRONG|SUB|SUP|TD|TH|TT|VAR)$/,textContainsNodes:/^(A|ABBR|ACRONYM|ADDRESS|B|BDO|BIG|BLOCKQUOTE|CAPTION|CENTER|CITE|CODE|DD|DEL|DFN|DIV|DL|DT|EM|FIELDSET|FONT|H[1-6]|I|INS|KBD|LABEL|LEGEND|LI|MARQUEE|NOBR|NOEMBED|OL|P|PRE|Q|SAMP|SMALL|SPAN|STRIKE|STRONG|SUB|SUP|TABLE|THEAD|TBODY|TFOOT|TD|TH|TR|TT|UL|VAR)$/,block:/^(APPLET|BLOCKQUOTE|BR|CAPTION|CENTER|COL|COLGROUP|DD|DIV|DL|DT|H[1-6]|EMBED|FIELDSET|LI|MARQUEE|NOBR|OBJECT|OL|P|PRE|TABLE|THEAD|TBODY|TFOOT|TD|TH|TR|UL)$/,selectionBlock:/^(APPLET|BLOCKQUOTE|BR|CAPTION|CENTER|COL|COLGROUP|DD|DIV|DL|DT|H[1-6]|EMBED|FIELDSET|LI|MARQUEE|NOBR|OBJECT|OL|P|PRE|TD|TH|TR|UL)$/,header:/^H[1-6]$/,formElement:/^(FORM|INPUT|HIDDEN|TEXTAREA|SELECT|BUTTON)$/},this.root=function(){return this.rte.body},this.create=function(a){return this.rte.doc.createElement(a)},this.createBookmark=function(){var b=this.rte.doc.createElement("span");return b.id="elrte-bm-"+Math.random().toString().substr(2),a(b).addClass("elrtebm elrte-protected"),b},this.indexOf=function(b){var c=0;b=a(b);while((b=b.prev())&&b.length)c++;return c},this.attr=function(b,c){var d="";return b.nodeType==1&&(d=a(b).attr(c),d&&c!="src"&&c!="href"&&c!="title"&&c!="alt"&&(d=d.toString().toLowerCase())),d||""},this.findCommonAncestor=function(b,c){if(!b||!c)return this.rte.log("dom.findCommonAncestor invalid arguments");if(b==c)return b;if(b.nodeName=="BODY"||c.nodeName=="BODY")return this.rte.doc.body;var d=a(b).parents(),e=a(c).parents(),f=e.length-1,g=e[f];for(var h=d.length-1;h>=0;h--,f--)if(d[h]==e[f])g=d[h];else break;return g},this.isEmpty=function(b){return b.nodeType==1?this.regExp.textNodes.test(b.nodeName)?a.trim(a(b).text()).length==0:!1:b.nodeType==3?/^(TABLE|THEAD|TFOOT|TBODY|TR|UL|OL|DL)$/.test(b.parentNode.nodeName)||b.nodeValue==""||a.trim(b.nodeValue).length==0&&!(b.nextSibling&&b.previousSibling&&b.nextSibling.nodeType==1&&b.previousSibling.nodeType==1&&!this.regExp.block.test(b.nextSibling.nodeName)&&!this.regExp.block.test(b.previousSibling.nodeName)):!0},this.next=function(a){while(a.nextSibling&&(a=a.nextSibling))if(a.nodeType==1||a.nodeType==3&&!this.isEmpty(a))return a;return null},this.prev=function(a){while(a.previousSibling&&(a=a.previousSibling))if(a.nodeType==1||a.nodeType==3&&!this.isEmpty(a))return a;return null},this.isPrev=function(a,b){while(a=this.prev(a))if(a==b)return!0;return!1},this.nextAll=function(a){var b=[];while(a=this.next(a))b.push(a);return b},this.prevAll=function(a){var b=[];while(a=this.prev(a))b.push(a);return b},this.toLineEnd=function(a){var b=[];while((a=this.next(a))&&a.nodeName!="BR"&&a.nodeName!="HR"&&this.isInline(a))b.push(a);return b},this.toLineStart=function(a){var b=[];while((a=this.prev(a))&&a.nodeName!="BR"&&a.nodeName!="HR"&&this.isInline(a))b.unshift(a);return b},this.isFirstNotEmpty=function(b){while(b=this.prev(b))if(b.nodeType==1||b.nodeType==3&&a.trim(b.nodeValue)!="")return!1;return!0},this.isLastNotEmpty=function(a){while(a=this.next(a))if(!this.isEmpty(a))return!1;return!0},this.isOnlyNotEmpty=function(a){return this.isFirstNotEmpty(a)&&this.isLastNotEmpty(a)},this.findLastNotEmpty=function(a){this.rte.log("findLastNotEmpty Who is here 0_o");if(a.nodeType==1&&(l=a.lastChild)){if(!this.isEmpty(l))return l;while(l.previousSibling&&(l=l.previousSibling))if(!this.isEmpty(l))return l}return!1},this.isInline=function(b){if(b.nodeType==3)return!0;if(b.nodeType==1){b=a(b);var c=b.css("display"),d=b.css("float");return c=="inline"||c=="inline-block"||d=="left"||d=="right"}return!0},this.is=function(a,b){if(a&&a.nodeName){typeof b=="string"&&(b=this.regExp[b]||/.?/);if(b instanceof RegExp&&a.nodeName)return b.test(a.nodeName);if(typeof b=="function")return b(a)}return!1},this.filter=function(a,b){var c=[],d;if(!a.push)return this.is(a,b)?a:null;for(d=0;d<a.length;d++)this.is(a[d],b)&&c.push(a[d]);return c},this.parents=function(a,b){var c=[];while(a&&(a=a.parentNode)&&a.nodeName!="BODY"&&a.nodeName!="HTML")this.is(a,b)&&c.push(a);return c},this.parent=function(a,b){return this.parents(a,b)[0]||null},this.selfOrParent=function(a,b,c){return this.is(a,b)?a:this.parent(a,c||b)},this.selfOrParentLink=function(a){return a=this.selfOrParent(a,/^A$/),a&&a.href?a:null},this.selfOrParentAnchor=function(a){return a=this.selfOrParent(a,/^A$/),a&&!a.href&&a.name?a:null},this.childLinks=function(b){var c=[];return a("a[href]",b).each(function(){c.push(this)}),c},this.selectionHas=function(a){var b=this.rte.selection.cloneContents(),c;if(b&&b.childNodes&&b.childNodes.length)for(c=0;c<b.childNodes.length;c++)if(typeof a=="function"){if(a(b.childNodes[c]))return!0}else if(b instanceof RegExp&&a.test(b.childNodes[c].nodeName))return!0;return!1},this.wrap=function(b,c){return b=a.isArray(b)?b:[b],c=c.nodeName?c:this.create(c),b[0]&&b[0].nodeType&&b[0].parentNode&&(c=b[0].parentNode.insertBefore(c,b[0]),a(b).each(function(){this!=c&&c.appendChild(this)})),c},this.unwrap=function(a){if(a&&a.parentNode){while(a.firstChild)a.parentNode.insertBefore(a.firstChild,a);a.parentNode.removeChild(a)}},this.wrapContents=function(a,b){b=b.nodeName?b:this.create(b);for(var c=0;c<a.childNodes.length;c++)b.appendChild(a.childNodes[c]);return a.appendChild(b),b},this.cleanNode=function(b){if(b.nodeType!=1)return;/^(P|LI)$/.test(b.nodeName)&&(l=this.findLastNotEmpty(b))&&l.nodeName=="BR"&&a(l).remove(),$n=a(b),$n.children().each(function(){this.cleanNode(this)});if(b.nodeName!="BODY"&&!/^(TABLE|TR|TD)$/.test(b)&&this.isEmpty(b))return $n.remove();$n.attr("style")===""&&$n.removeAttr("style"),this.rte.browser.safari&&$n.hasClass("Apple-span")&&$n.removeClass("Apple-span"),b.nodeName=="SPAN"&&!$n.attr("style")&&!$n.attr("class")&&!$n.attr("id")&&$n.replaceWith($n.html())},this.cleanChildNodes=function(b){var c=this.cleanNode;a(b).children().each(function(){c(this)})},this.tableMatrix=function(b){var c=[];if(b&&b.nodeName=="TABLE"){var d=0;function e(a){for(var b=0;b<=d;b++)if(!c[a][b])return b}a(b).find("tr").each(function(b){a.isArray(c[b])||(c[b]=[]),a(this).children("td,th").each(function(){var f=parseInt(a(this).attr("colspan")||1),g=parseInt(a(this).attr("rowspan")||1),h=e(b);for(var i=0;i<g;i++)for(var j=0;j<f;j++){var k=b+i;a.isArray(c[k])||(c[k]=[]);var l=j==0&&i==0?this:i==0?j:"-";c[k][h+j]=l}d=Math.max(d,c[b].length)})})}return c},this.indexesOfCell=function(a,b){for(var c=0;c<b.length
;c++)for(var d=0;d<b[c].length;d++)if(b[c][d]==a)return[c,d]},this.fixTable=function(b){if(b&&b.nodeName=="TABLE"){var c=a(b),d=this.tableMatrix(b),e=0;a.each(d,function(){e=Math.max(e,this.length)});if(e==0)return c.remove();for(var f=0;f<d.length;f++){var g=d[f].length;if(g==0)c.find("tr").eq(f).remove();else if(g<e){var h=e-g,j=c.find("tr").eq(f);for(i=0;i<h;i++)j.append("<td>&nbsp;</td>")}}}},this.tableColumn=function(a,b,c){a=this.selfOrParent(a,/^TD|TH$/);var d=this.selfOrParent(a,/^TABLE$/);ret=[],info={offset:[],delta:[]};if(a&&d){c&&this.fixTable(d);var e=this.tableMatrix(d),f=!1,g;for(var h=0;h<e.length;h++){for(var i=0;i<e[h].length;i++)if(e[h][i]==a){g=i,f=!0;break}if(f)break}if(g>=0)for(var h=0;h<e.length;h++){var j=e[h][g]||null;if(j)if(j.nodeName)ret.push(j),b&&(info.delta.push(0),info.offset.push(g));else{var k=parseInt(j);!isNaN(k)&&e[h][g-k]&&e[h][g-k].nodeName&&(ret.push(e[h][g-k]),b&&(info.delta.push(k),info.offset.push(g)))}}}return b?{column:ret,info:info}:ret}}}(jQuery),function(a){elRTE.prototype.filter=function(b){var c=this,d=a("<span/>").addClass("elrtetesturl").appendTo(document.body)[0];this.url=(typeof d.currentStyle!="undefined"?d.currentStyle.backgroundImage:document.defaultView.getComputedStyle(d,null).backgroundImage).replace(/^url\((['"]?)([\s\S]+\/)[\s\S]+\1\)$/i,"$2"),a(d).remove(),this.rte=b,this.xhtml=/xhtml/i.test(b.options.doctype),this.boolAttrs=b.utils.makeObject("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected".split(",")),this.tagRegExp=/<(\/?)([\w:]+)((?:\s+[a-z\-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*\/?>/g,this.openTagRegExp=/<([\w:]+)((?:\s+\w+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*\/?>/g,this.attrRegExp=/(\w+)(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^\s]+))?/g,this.scriptRegExp=/<script([^>]*)>([\s\S]*?)<\/script>/gi,this.styleRegExp=/(<style([^>]*)>[\s\S]*?<\/style>)/gi,this.linkRegExp=/(<link([^>]+)>)/gi,this.cdataRegExp=/<!\[CDATA\[([\s\S]+)\]\]>/g,this.objRegExp=/<object([^>]*)>([\s\S]*?)<\/object>/gi,this.embRegExp=/<(embed)((?:\s+\w+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*>/gi,this.paramRegExp=/<(param)((?:\s+\w+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*>/gi,this.iframeRegExp=/<iframe([^>]*)>([\s\S]*?)<\/iframe>/gi,this.yMapsRegExp=/<div\s+([^>]*id\s*=\s*('|")?YMapsID[^>]*)>/gi,this.gMapsRegExp=/<iframe\s+([^>]*src\s*=\s*"http:\/\/maps\.google\.\w+[^>]*)>([\s\S]*?)<\/iframe>/gi,this.videoHostRegExp=/^(http:\/\/[\w\.]*)?(youtube|vimeo|rutube).*/i,this.serviceClassRegExp=/<(\w+)([^>]*class\s*=\s*"[^>]*elrte-[^>]*)>\s*(<\/\1>)?/gi,this.pagebreakRegExp=/<(\w+)([^>]*style\s*=\s*"[^>]*page-break[^>]*)>\s*(<\/\1>)?/gi,this.pbRegExp=new RegExp("<!-- pagebreak -->","gi"),this.allowTags=b.options.allowTags.length?b.utils.makeObject(b.options.allowTags):null,this.denyTags=b.options.denyTags.length?b.utils.makeObject(b.options.denyTags):null,this.denyAttr=b.options.denyAttr?b.utils.makeObject(b.options.denyAttr):null,this.pasteDenyAttr=b.options.pasteDenyAttr?b.utils.makeObject(b.options.pasteDenyAttr):null,this.fontSize=["medium","xx-small","small","medium","large","x-large","xx-large"],this.fontFamily={"sans-serif":/^(arial|tahoma|verdana)$/i,serif:/^(times|times new roman)$/i,monospace:/^courier$/i},this.scripts={},this._chains={},a.each(this.chains,function(b){c._chains[b]=[],a.each(this,function(a,d){typeof c.rules[d]=="function"&&c._chains[b].push(c.rules[d])})}),this.proccess=function(b,d){return d=a.trim(d).replace(/^\s*(&nbsp;)+/gi,"").replace(/(&nbsp;|<br[^>]*>)+\s*$/gi,""),a.each(this._chains[b]||[],function(){d=this.call(c,d)}),d=d.replace(/\t/g,"  ").replace(/\r/g,"").replace(/\s*\n\s*\n+/g,"\n")+"  ",a.trim(d)?d:" "},this.wysiwyg=function(a){return this.proccess("wysiwyg",a)},this.source=function(a){return this.proccess("source",a)},this.source2source=function(a){return this.proccess("source2source",a)},this.wysiwyg2wysiwyg=function(a){return this.proccess("wysiwyg2wysiwyg",a)},this.parseAttrs=function(b){var c={},d=this.boolAttrs,e=b.match(this.attrRegExp),f,g,h;return e&&a.each(e,function(b,e){f=e.split("="),g=a.trim(f[0]).toLowerCase(),f.length>2?(f.shift(),h=f.join("=")):h=d[g]||f[1]||"",c[g]=a.trim(h).replace(/^('|")(.*)(\1)$/,"$2")}),c.style=this.rte.utils.parseStyle(c.style),c["class"]=this.rte.utils.parseClass(c["class"]||""),c},this.serializeAttrs=function(b,c){var d=[],e=this;return a.each(b,function(a,b){a=="style"?b=e.rte.utils.serializeStyle(b,c):a=="class"&&(b=e.rte.utils.serializeClass(b)),b&&d.push(a+'="'+b+'"')}),d.join(" ")},this.cleanAttrs=function(b,c){function f(a){return a+(/\d$/.test(a)?"px":"")}var d=this,e=this.replaceAttrs;return a.each(b["class"],function(a){/^(Apple-style-span|mso\w+)$/i.test(a)&&delete b["class"][a]}),a.each(b,function(g,h){e[g]&&e[g].call(d,b,c),g=="style"&&a.each(h,function(a,c){switch(a){case"mso-padding-alt":case"mso-padding-top-alt":case"mso-padding-right-alt":case"mso-padding-bottom-alt":case"mso-padding-left-alt":case"mso-margin-alt":case"mso-margin-top-alt":case"mso-margin-right-alt":case"mso-margin-bottom-alt":case"mso-margin-left-alt":case"mso-table-layout-alt":case"mso-height":case"mso-width":case"mso-vertical-align-alt":b.style[a.replace(/^mso-|-alt$/g,"")]=f(c),delete b.style[a];break;case"horiz-align":b.style["text-align"]=c,delete b.style[a];break;case"vert-align":b.style["vertical-align"]=c,delete b.style[a];break;case"font-color":case"mso-foreground":b.style.color=c,delete b.style[a];break;case"mso-background":case"mso-highlight":b.style.background=c,delete b.style[a];break;case"mso-default-height":b.style["min-height"]=f(c),delete b.style[a];break;case"mso-default-width":b.style["min-width"]=f(c),delete b.style[a];break;case"mso-padding-between-alt":b.style["border-collapse"]="separate",b.style["border-spacing"]=f(c),delete b.style[a];break;case"text-line-through":c.match(/(single|double)/i)&&(b.style["text-decoration"]="line-through"),delete b.style[a];break;case"mso-zero-height":c=="yes"&&(b.style.display="none"),delete b.style[a];break;case"font-weight":c==700&&(b.style["font-weight"]="bold");break;default:a.match(/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?!align|decor|indent|trans)|top-bar|version|vnd|word-break)/)&&delete b.style[a]}})}),b}},elRTE.prototype.filter.prototype.replaceTags={b:{tag:"strong"},big:{tag:"span",style:{"font-size":"large"}},center:{tag:"div",style:{"text-align":"center"}},i:{tag:"em"},font:{tag:"span"},nobr:{tag:"span",style:{"white-space":"nowrap"}},menu:{tag:"ul"},plaintext:{tag:"pre"},s:{tag:"strike"},small:{tag:"span",style:{"font-size":"small"}},u:{tag:"span",style:{"text-decoration":"underline"}},xmp:{tag:"pre"}},elRTE.prototype.filter.prototype.replaceAttrs={align:function(a,b){switch(b){case"img":a.style[a.align.match(/(left|right)/)?"float":"vertical-align"]=a.align;break;case"table":a.align=="center"?a.style["margin-left"]=a.style["margin-right"]="auto":a.style["float"]=a.align;break;default:a.style["text-align"]=a.align}delete a.align},border:function(a){!a.style["border-width"]&&(a.style["border-width"]=(parseInt(a.border)||1)+"px"),!a.style["border-style"]&&(a.style["border-style"]="solid"),delete a.border},bordercolor:function(a){!a.style["border-color"]&&(a.style["border-color"]=a.bordercolor),delete a.bordercolor},background:function(a){!a.style["background-image"]&&(a.style["background-image"]="url("+a.background+")"),delete a.background},bgcolor:function(a){!a.style["background-color"]&&(a.style["background-color"]=a.bgcolor),delete a.bgcolor},clear:function(a){a.style.clear=a.clear=="all"?"both":a.clear,delete a.clear},color:function(a){!a.style.color&&(a.style.color=a.color),delete a.color},face:function(b){var c=b.face.toLowerCase();a.each(this.fontFamily,function(a,d){c.match(d)&&(b.style["font-family"]=c+","+a)}),delete b.face},hspace:function(a,b){if(b=="img"){var c=parseInt(a.hspace)||0;!a.style["margin-left"]&&(a.style["margin-left"]=c+"px"),!a.style["margin-right"]&&(a.style["margin-right"]=c+"px"),delete a.hspace}},size:function(a,b){b!="input"&&(a.style["font-size"]=this.fontSize[parseInt(a.size)||0]||"medium",delete a.size)},valign:function(a){a.style["vertical-align"]||(a.style["vertical-align"]=a.valign),delete a.valign},vspace:function(a,b){if(b=="img"){var c=parseInt(a.vspace)||0;!a.style["margin-top"]&&(a.style["margin-top"]=c+"px"),!a.style["margin-bottom"]&&(a.style["margin-bottom"]=c+"px"),delete a.hspace}}},elRTE.prototype.filter.prototype.rules={allowedTags:function(a){var b=this.allowTags;return b?a.replace(this.tagRegExp,function(a,c,d){return b[d.toLowerCase()]?a:""}):a},deniedTags:function(a){var b=this.denyTags;return b?a.replace(this.tagRegExp,function(a,c,e){return b[e.toLowerCase()]?"":a}):a},clean:function(b){var c=this,d=this.replaceTags,e=this.replaceAttrs,f=this.denyAttr,g;return b=b.replace(/<!DOCTYPE([\s\S]*)>/gi,"").replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p><strong>$1</strong></p>").replace(/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s&nbsp;]*)<\/span>/gi,"$1").replace(/(<p[^>]*>\s*<\/p>|<p[^>]*\/>)/gi,"<br>").replace(/(<\/p>)(?:\s*<br\s*\/?>\s*|\s*&nbsp;\s*)+\s*(<p[^>]*>)/gi,function(a,b,c){return b+"\n"+c}).replace(this.tagRegExp,function(b,e,g,h){return g=g.toLowerCase(),e?"</"+(d[g]?d[g].tag:g)+">":(h=c.cleanAttrs(c.parseAttrs(h||""),g),d[g]&&(d[g].style&&a.extend(h.style,d[g].style),g=d[g].tag),f&&a.each(h,function(a){f[a]&&delete h[a]}),h=c.serializeAttrs(h),"<"+g+(h?" ":"")+h+">")}),g=a("<div>"+b+"</div>"),g.find("span:not([id]):not([class])").each(function(){var b=a(this);b.attr("style")||(a.trim(b.html()).length?c.rte.dom.unwrap(this):b.remove())}).end().find("span span:only-child").each(function(){var b=a(this),d=b.parent().eq(0),e=b.attr("id"),f=d.attr("id"),g,h,i;c.rte.dom.isOnlyNotEmpty(this)&&(!e||!f)&&(i=a.trim(d.attr("class")+" "+b.attr("class")),i&&d.attr("class",i),h=c.rte.utils.serializeStyle(a.extend(c.rte.utils.parseStyle(a(this).attr("style")||""),c.rte.utils.parseStyle(a(d).attr("style")||""))),h&&d.attr("style",h),g=e||f,g&&d.attr("id",g),this.firstChild?a(this.firstChild).unwrap():b.remove())}).end().find("a[name]").each(function(){a(this).addClass("elrte-protected elrte-anchor")}),g.html()},cleanPaste:function(b){var c=this,d=this.pasteDenyAttr;return b=b.replace(this.scriptRegExp,"").replace(this.styleRegExp,"").replace(this.linkRegExp,"").replace(this.cdataRegExp,"").replace(/\<\!--[\s\S]*?--\>/g,""),this.rte.options.pasteOnlyText?b=b.replace(this.tagRegExp,function(a,b,c){return/br/i.test(c)||b&&/h[1-6]|p|ol|ul|li|div|blockquote|tr/i?"<br>":""}).replace(/(&nbsp;|<br[^>]*>)+\s*$/gi,""):d&&(b=b.replace(this.openTagRegExp,function(b,e,f){return f=c.parseAttrs(f),a.each(f,function(a){d[a]&&delete f[a]}),f=c.serializeAttrs(f,!0),"<"+e+(f?" ":"")+f+">"})),b},replace:function(b){function f(a,b){function k(){if(a.embed&&a.embed.src)return a.embed.src;if(a.params&&a.params.length){j=a.params.length;while(j--)if(a.params[j].name=="src"||a.params[j].name=="movie")return a.params[j].value}}var d=k(),e=d&&c.videoHostRegExp.test(d)?d.replace(c.videoHostRegExp,"$2"):b.replace(/^\w+\/(.+)/,"$1"),f=parseInt((a.obj?a.obj.width||a.obj.style.width:0)||(a.embed?a.embed.width||a.embed.style.width:0))||150,g=parseInt((a.obj?a.obj.height||a.obj.style.height:0)||(a.embed?a.embed.height||a.embed.style.height:0))||100,h="media"+Math.random().toString().substring(2),i="",j;return a.obj&&a.obj.style&&a.obj.style["float"]&&(i=' style="float:'+a.obj.style["float"]+'"'),c.scripts[h]=a,'<img src="'+c.url+'pixel.gif" class="elrte-media elrte-media-'+e+' elrte-protected" title="'+(d?c.rte.utils.encode(d):"")+'" rel="'+h+'" width="'+f+'" height="'+g+'"'+i+">"}var c=this,d=this.rte.options.replace||[],e;d.length&&a.each(d,function(a,d){typeof d=="function"&&(b=d.call(c,b))}),b=b.replace(this.styleRegExp,"<!-- ELRTE_COMMENT$1 -->").replace(this.linkRegExp,"<!-- ELRTE_COMMENT$1-->").replace(this.cdataRegExp,"<!--[CDATA[$1]]-->").replace(this.scriptRegExp,function(a,b,d){var e;return c.denyTags.script?"":(e="script"+Math.random().toString().substring(2),b=c.parseAttrs(b),!b.type&&(b.type="text/javascript"),c.scripts[e]="<script "+c.serializeAttrs(b)+">"+d+"</script>","<!-- ELRTE_SCRIPT:"+e+" -->")}).replace(this.yMapsRegExp,function(a,b){return b=c.parseAttrs(b),b["class"]["elrte-yandex-maps"]="elrte-yandex-maps",b["class"]["elrte-protected"]="elrte-protected","<div "+c.serializeAttrs(b)+">"}).replace(this.gMapsRegExp,function(a,b){var d="gmaps"+Math.random().toString().substring(2),e,f;return b=c.parseAttrs(b),e=parseInt(b.width||b.style.width||100),f=parseInt(b.height||b.style.height||100),c.scripts[d]=a,'<img src="'+c.url+'pixel.gif" class="elrte-google-maps elrte-protected" id="'+d+'" style="width:'+e+"px;height:"+f+'px">'}).replace(this.objRegExp,function(b,d,e){var g=e.match(c.embRegExp),h={obj:c.parseAttrs(d),embed:g&&g.length?c.parseAttrs(g[0].substring(7)):null,params:[]},i=c.rte.utils.mediaInfo(h.embed?h.embed.type||"":"",h.obj.classid||"");return i?((g=e.match(c.paramRegExp))&&a.each(g,function(a,b){h.params.push(c.parseAttrs(b.substring(6)))}),!h.obj.classid&&(h.obj.classid=i.classid[0]),!h.obj.codebase&&(h.obj.codebase=i.codebase),h.embed&&!h.embed.type&&(h.embed.type=i.type),h.obj.width=="1"&&delete h.obj.width,h.obj.height=="1"&&delete h.obj.height,h.embed&&(h.embed.width=="1"&&delete h.embed.width,h.embed.height=="1"&&delete h.embed.height),f(h,i.type)):b}).replace(this.embRegExp,function(a,b,d){var d=c.parseAttrs(d),e=c.rte.utils.mediaInfo(d.type||"");return d.width=="1"&&delete d.width,d.height=="1"&&delete d.height,e?f({embed:d},e.type):a}).replace(this.iframeRegExp,function(a,b){var b=c.parseAttrs(b),d=b.style.width||(parseInt(b.width)>1?parseInt(b.width)+"px":"100px"),e=b.style.height||(parseInt(b.height)>1?parseInt(b.height)+"px":"100px"),f="iframe"+Math.random().toString().substring(2);c.scripts[f]=a;var g='<img id="'+f+'" src="'+c.url+'pixel.gif" class="elrte-protected elrte-iframe" style="width:'+d+"; height:"+e+'">';return g}).replace(this.vimeoRegExp,function(a,b,d){return d=c.parseAttrs(d),delete d.frameborder,d.width=="1"&&delete d.width,d.height=="1"&&delete d.height,d.type="application/x-shockwave-flash",f({embed:d},"application/x-shockwave-flash")}).replace(/<\/(embed|param)>/gi,"").replace(this.pbRegExp,function(){return'<img src="'+c.url+'pixel.gif" class="elrte-protected elrte-pagebreak">'}),e=a("<div>"+b+"</div>");if(!this.rte.options.allowTextNodes){var g=this.rte.dom,h=[],i=[];if(a.browser.msie)for(var j=0;j<e[0].childNodes.length;j++)h.push(e[0].childNodes[j]);else h=Array.prototype.slice.call(e[0].childNodes);function k(){i.length&&g.filter(i,"notEmpty").length&&g.wrap(i,document.createElement("p")),i=[]}a.each(h,function(a,b){g.is(b,"block")?k():(i.length&&b.previousSibling!=i[i.length-1]&&k(),i.push(b))}),k()}return e.html()},restore:function(b){var c=this,d=this.rte.options.restore||[];return d.length&&a.each(d,function(a,d){typeof d=="function"&&(b=d.call(c,b))}),b=b.replace(/\<\!--\[CDATA\[([\s\S]*?)\]\]--\>/gi,"<![CDATA[$1]]>").replace(/\<\!--\s*ELRTE_SCRIPT\:\s*(script\d+)\s*--\>/gi,function(a,b){return c.scripts[b]&&(a=c.scripts[b],delete c.scripts[b]),a||""}).replace(/\<\!-- ELRTE_COMMENT([\s\S]*?) --\>/gi,"$1").replace(this.serviceClassRegExp,function(b,d,e,f){var e=c.parseAttrs(e),g,h="";if(e["class"]["elrte-google-maps"]){var b="";return c.scripts[e.id]&&(b=c.scripts[e.id],delete c.scripts[e.id]),b}if(e["class"]["elrte-iframe"])return c.scripts[e.id]||"";if(e["class"].elrtebm)return"";if(e["class"]["elrte-media"]){g=c.scripts[e.rel]||{};var i=!0,j="";g.params&&a.each(g.params,function(a,b){b.name=="src"&&(j=b.value)}),g.params&&a.each(g.params,function(a,b){b.name=="FlashVars"&&(i=!1,b.value="src="+j+"&playButtonOverlay=false&controlBarAutoHide=false"),h="<param "+c.serializeAttrs(b)+">\n",g.embed&&(g.embed[b.name]=b.value)});var k="/js/StrobeMediaPlayback.swf";return i&&(h+='<param name="movie" value="'+k+'"/>'+"\n",h+='<param name="allowFullScreen" value="true"/>\n',h+='<param name="FlashVars" value="src='+j+'&playButtonOverlay=false&controlBarAutoHide=false" />'+"\n",g.embed.FlashVars="src="+j+"&playButtonOverlay=false&controlBarAutoHide=false"),g.obj.width==undefined&&(g.embed.width=g.obj.width=360),g.obj.height==undefined&&(g.embed.height=g.obj.height=240),g.embed&&(g.embed.src=k),g.embed&&(h+="<embed "+c.serializeAttrs(g.embed)+">"),g.obj&&(h="<object "+c.serializeAttrs(g.obj)+">\n"+h+"\n</object>\n"),h||b}return e["class"]["elrte-pagebreak"]?"<!-- pagebreak -->":(a.each(e["class"],function(a){/^elrte-\w+/i.test(a)&&delete e["class"][a]}),"<"+d+" "+c.serializeAttrs(e)+">"+(f||""))}),b},compactStyles:function(a){var b=this;return a.replace(this.tagRegExp,function(a,c,d,e){return e=!c&&e?b.serializeAttrs(b.parseAttrs(e),!0):"","<"+c+d.toLowerCase()+(e?" ":"")+e+">"})},xhtmlTags:function(a){return this.xhtml?a.replace(/<(img|hr|br|embed|param|link|area)([^>]*\/*)>/gi,"<$1$2 />"):a}},elRTE.prototype.filter.prototype.chains={wysiwyg:["replace","clean","allowedTags","deniedTags","compactStyles"],source:["clean","allowedTags","restore","compactStyles","xhtmlTags"],paste:["clean","allowedTags","cleanPaste","replace","deniedTags","compactStyles"],wysiwyg2wysiwyg:["clean","allowedTags","restore","replace","deniedTags","compactStyles"],source2source:["clean","allowedTags","replace","deniedTags","restore","compactStyles","xhtmlTags"]}}(jQuery),function(a){elRTE.prototype.history=function(b){this.rte=b,this._prev=[],this._next=[],this.add=function(){this.rte.options.historyLength>0&&this._prev.length>=this.rte.options.historyLength&&this._prev.slice(this.rte.options.historyLength);var b=this.rte.selection.getBookmark();this._prev.push([a(this.rte.doc.body).html(),b]),this.rte.selection.moveToBookmark(b),this._next=[]},this.back=function(){if(this._prev.length){var b=this.rte.selection.getBookmark(),c=this._prev.pop();this._next.push([a(this.rte.doc.body).html(),b]),a(this.rte.doc.body).html(c[0]),this.rte.selection.moveToBookmark(c[1])}},this.fwd=function(){if(this._next.length){var b=this.rte.selection.getBookmark(),c=this._next.pop();this._prev.push([a(this.rte.doc.body).html(),b]),a(this.rte.doc.body).html(c[0]),this.rte.selection.moveToBookmark(c[1])}},this.canBack=function(){return this._prev.length},this.canFwd=function(){return this._next.length}}}(jQuery),function(a){elRTE.prototype.options={doctype:'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">',cssClass:"el-rte",cssfiles:[],height:null,resizable:!0,lang:"en",toolbar:"normal",absoluteURLs:!0,allowSource:!0,stripWhiteSpace:!0,styleWithCSS:!1,fmAllow:!0,fmOpen:null,allowTags:[],denyTags:["applet","base","basefont","bgsound","blink","body","col","colgroup","isindex","frameset","html","head","meta","marquee","noframes","noembed","o:p","title","xml"],denyAttr:[],pasteDenyAttr:["id","name","class","style","language","onclick","ondblclick","onhover","onkeup","onkeydown","onkeypress"],allowTextNodes:!0,allowBrowsersSpecStyles:!1,allowPaste:!0,pasteOnlyText:!1,replace:[],restore:[],pagebreak:'<div style="page-break-after: always;"></div>',buttons:{save:"Save",copy:"Copy",cut:"Cut",css:"Css style and class",paste:"Paste",pastetext:"Paste only text",pasteformattext:"Paste formatted text",removeformat:"Clean format",undo:"Undo last action",redo:"Redo previous action",bold:"Bold",italic:"Italic",underline:"Underline",strikethrough:"Strikethrough",superscript:"Superscript",subscript:"Subscript",justifyleft:"Align left",justifyright:"Ailgn right",justifycenter:"Align center",justifyfull:"Align full",indent:"Indent",outdent:"Outdent",rtl:"Right to left",ltr:"Left to right",forecolor:"Font color",hilitecolor:"Background color",formatblock:"Format",fontsize:"Font size",fontname:"Font",insertorderedlist:"Ordered list",insertunorderedlist:"Unordered list",horizontalrule:"Horizontal rule",blockquote:"Blockquote",div:"Block element (DIV)",link:"Link",unlink:"Delete link",anchor:"Bookmark",image:"Image",pagebreak:"Page break",smiley:"Smiley",flash:"Flash",table:"Table",tablerm:"Delete table",tableprops:"Table properties",tbcellprops:"Table cell properties",tbrowbefore:"Insert row before",tbrowafter:"Insert row after",tbrowrm:"Delete row",tbcolbefore:"Insert column before",tbcolafter:"Insert column after",tbcolrm:"Delete column",tbcellsmerge:"Merge table cells",tbcellsplit:"Split table cell",docstructure:"Toggle display document structure",elfinder:"Open file manager",fullscreen:"Toggle full screen mode",nbsp:"Non breakable space",stopfloat:"Stop element floating",about:"About this software"},panels:{eol:[],save:["save"],copypaste:["copy","cut","paste","pastetext","pasteformattext","removeformat","docstructure"],undoredo:["undo","redo"],style:["bold","italic","underline","strikethrough","subscript","superscript"],colors:["forecolor","hilitecolor"],alignment:["justifyleft","justifycenter","justifyright","justifyfull"],indent:["outdent","indent"],format:["formatblock","fontsize","fontname"],lists:["insertorderedlist","insertunorderedlist"],elements:["horizontalrule","blockquote","div","stopfloat","css","nbsp","smiley","pagebreak"],direction:["ltr","rtl"],links:["link","unlink","anchor"],images:["image"],media:["image","flash"],tables:["table","tableprops","tablerm","tbrowbefore","tbrowafter","tbrowrm","tbcolbefore","tbcolafter","tbcolrm","tbcellprops","tbcellsmerge","tbcellsplit"],elfinder:["elfinder"],fullscreen:["fullscreen","about"]},toolbars:{tiny:["style"],compact:["save","undoredo","style","alignment","lists","links","fullscreen"],normal:["save","copypaste","undoredo","style","alignment","colors","indent","lists","links","elements","images","fullscreen"],complete:["save","copypaste","undoredo","style","alignment","colors","format","indent","lists","links","elements","media","fullscreen"],maxi:["save","copypaste","undoredo","elfinder","style","alignment","direction","colors","format","indent","lists","links","elements","media","tables","fullscreen"],eldorado:["save","copypaste","elfinder","undoredo","style","alignment","colors","format","indent","lists","links","elements","media","tables","fullscreen"]},panelNames:{save:"Save",copypaste:"Copy/Pase",undoredo:"Undo/Redo",style:"Text styles",colors:"Colors",alignment:"Alignment",indent:"Indent/Outdent",format:"Text format",lists:"Lists",elements:"Misc elements",direction:"Script direction",links:"Links",images:"Images",media:"Media",tables:"Tables",elfinder:"File manager (elFinder)"}}}(jQuery),function(a){elRTE.prototype.selection=function(b){function h(){return c.rte.window.getSelection?c.rte.window.getSelection():c.rte.window.document.selection}function i(a,b,d){while(a.nodeName!="BODY"&&a.parentNode&&a.parentNode.nodeName!="BODY"&&(b?a!==b&&a.parentNode!=b:1)&&(d=="left"&&c.rte.dom.isFirstNotEmpty(a)||d=="right"&&c.rte.dom.isLastNotEmpty(a)||c.rte.dom.isFirstNotEmpty(a)&&c.rte.dom.isLastNotEmpty(a)))a=a.parentNode;return a}this.rte=b;var c=this;this.w3cRange=null;var d,e,f,g;a(this.rte.doc).keyup(function(a){(a.ctrlKey||a.metaKey||a.keyCode>=8&&a.keyCode<=13||a.keyCode>=32&&a.keyCode<=40||a.keyCode==46||a.keyCode>=96&&a.keyCode<=111)&&c.cleanCache()}).mousedown(function(a){a.target.nodeName=="HTML"?d=c.rte.doc.body:d=a.target,e=f=null}).mouseup(function(a){a.target.nodeName=="HTML"?e=c.rte.doc.body:e=a.target,e=a.target,f=null}).click(),this.collapsed=function(){return this.getRangeAt().isCollapsed()},this.collapse=function(b){var c=h(),d=this.getRangeAt();return d.collapse(b?!0:!1),a.browser.msie||(c.removeAllRanges(),c.addRange(d)),this},this.getRangeAt=function(a){if(this.rte.browser.msie)return this.w3cRange||(this.w3cRange=new this.rte.w3cRange(this.rte)),a&&this.w3cRange.update(),this.w3cRange;var b=h(),c=b.rangeCount>0?b.getRangeAt(0):this.rte.doc.createRange();return c.getStart=function(){return this.startContainer.nodeType==1?this.startContainer.childNodes[Math.min(this.startOffset,this.startContainer.childNodes.length-1)]:this.startContainer},c.getEnd=function(){return this.endContainer.nodeType==1?this.endContainer.childNodes[Math.min(this.startOffset==this.endOffset?this.endOffset:this.endOffset-1,this.endContainer.childNodes.length-1)]:this.endContainer},c.isCollapsed=function(){return this.collapsed},c},this.saveIERange=function(){a.browser.msie&&(g=this.getRangeAt().getBookmark())},this.restoreIERange=function(){a.browser.msie&&g&&this.getRangeAt().moveToBookmark(g)},this.cloneContents=function(){var b=this.rte.dom.create("div"),c,d,e;if(a.browser.msie){try{c=this.rte.window.document.selection.createRange()}catch(f){c=this.rte.doc.body.createTextRange()}a(b).html(c.htmlText)}else{d=this.getRangeAt().cloneContents();for(e=0;e<d.childNodes.length;e++)b.appendChild(d.childNodes[e].cloneNode(!0))}return b},this.select=function(a,b){b=b||a;if(this.rte.browser.msie){var c=this.rte.doc.body.createTextRange(),d=c.duplicate(),e=c.duplicate();d.moveToElementText(a),e.moveToElementText(b),c.setEndPoint("StartToStart",d),c.setEndPoint("EndToEnd",e),c.select()}else{var f=h(),c=this.getRangeAt();c.setStartBefore(a),c.setEndAfter(b),f.removeAllRanges(),f.addRange(c)}return this.cleanCache()},this.selectContents=function(a){var b=this.getRangeAt();if(a&&a.nodeType==1)if(this.rte.browser.msie)b.range(),b.r.moveToElementText(a.parentNode),b.r.select();else{try{b.selectNodeContents(a)}catch(c){return this.rte.log("unable select node contents "+a)}var d=h();d.removeAllRanges(),d.addRange(b)}return this},this.deleteContents=function(){return a.browser.msie||this.getRangeAt().deleteContents(),this},this.insertNode=function(b,c){c&&!this.collapsed()&&this.collapse();if(this.rte.browser.msie){var d=b.nodeType==3?b.nodeValue:a(this.rte.dom.create("span")).append(a(b)).html(),e=this.getRangeAt();e.insertNode(d)}else{var e=this.getRangeAt();e.insertNode(b),e.setStartAfter(b),e.setEndAfter(b);var f=h();f.removeAllRanges(),f.addRange(e)}return this.cleanCache()},this.insertHtml=function(b,c){c&&!this.collapsed()&&this.collapse();if(this.rte.browser.msie)this.getRangeAt().range().pasteHTML(b);else{var d=a(this.rte.dom.create("span")).html(b||"").get(0);this.insertNode(d),a(d).replaceWith(a(d).html())}return this.cleanCache()},this.insertText=function(a,b){var c=this.rte.doc.createTextNode(a);return this.insertHtml(c.nodeValue)},this.getBookmark=function(){this.rte.window.focus();var b,c,d,e,f,g=this.rte.dom.createBookmark(),i=this.rte.dom.createBookmark();if(a.browser.msie){try{b=this.rte.window.document.selection.createRange()}catch(i){b=this.rte.doc.body.createTextRange()}if(b.item){var j=b.item(0);b=this.rte.doc.body.createTextRange(),b.moveToElementText(j)}c=b.duplicate(),d=b.duplicate(),e=this.rte.dom.create("span"),f=this.rte.dom.create("span"),e.appendChild(g),f.appendChild(i),c.collapse(!0),c.pasteHTML(e.innerHTML),d.collapse(!1),d.pasteHTML(f.innerHTML)}else{var k=h(),b=k.rangeCount>0?k.getRangeAt(0):this.rte.doc.createRange();c=b.cloneRange(),d=b.cloneRange(),d.collapse(!1),d.insertNode(i),c.collapse(!0),c.insertNode(g),this.select(g,i)}return[g.id,i.id]},this.moveToBookmark=function(b){this.rte.window.focus();if(b&&b.length==2){var c=this.rte.doc.getElementById(b[0]),d=this.rte.doc.getElementById(b[1]),e,f;c&&d&&(this.select(c,d),this.rte.dom.next(c)==d&&this.collapse(!0),a.browser.msie||(e=h(),f=e.rangeCount>0?e.getRangeAt(0):this.rte.doc.createRange(),e.removeAllRanges(),e.addRange(f)),c.parentNode.removeChild(c),d.parentNode.removeChild(d))}return this},this.removeBookmark=function(a){this.rte.window.focus();if(a.length==2){var b=this.rte.doc.getElementById(a[0]),c=this.rte.doc.getElementById(a[1]);b&&c&&(b.parentNode.removeChild(b),c.parentNode.removeChild(c))}},this.cleanCache=function(){return d=e=f=null,this},this.getStart=function(){if(!d){var a=this.getRangeAt();d=a.getStart()}return d},this.getEnd=function(){if(!e){var a=this.getRangeAt();e=a.getEnd()}return e},this.getNode=function(){return f||(f=this.rte.dom.findCommonAncestor(this.getStart(),this.getEnd())),f},this.selected=function(b){function k(){function b(){for(var b=0;b<i.length;b++)if(i[b].nodeType==1&&(c.rte.dom.selfOrParent(i[b],/^P$/)||a(i[b]).find("p").length>0))return!1;return!0}if(i.length>0){var e=d.tag=="p"&&!b()?"div":d.tag,f=c.rte.dom.wrap(i,e);h[j]=f,j=null,i=[]}}function l(b){if(b.nodeType==1)if(/^(THEAD|TFOOT|TBODY|COL|COLGROUP|TR)$/.test(b.nodeName))a(b).find("td,th").each(function(){var b=d.tag=="p"&&a(this).find("p").length>0?"div":d.tag,e=c.rte.dom.wrapContents(this,b);return h.push(e)});else if(/^(CAPTION|TD|TH|LI|DT|DD)$/.test(b.nodeName)){var e=d.tag=="p"&&a(b).find("p").length>0?"div":d.tag,b=c.rte.dom.wrapContents(b,e);return h.push(b)}var f=i.length>0?i[i.length-1]:null;f&&f!=c.rte.dom.prev(b)&&k(),i.push(b),j===null&&(j=h.length,h.push("dummy"))}var d={collapsed:!1,blocks:!1,filter:!1,wrap:"text",tag:"span"};d=a.extend({},d,b);if(d.blocks){var e=this.getNode(),f=null;if(f=this.rte.dom.selfOrParent(e,"selectionBlock"))return[f]}var g=this.selectedRaw(d.collapsed,d.blocks),h=[],i=[],j=null;if(g.nodes.length>0){for(var m=0;m<g.nodes.length;m++){var e=g.nodes[m];e.nodeType==3&&(m==0||m==g.nodes.length-1)&&a.trim(e.nodeValue).length>0&&(m==0&&g.so>0&&(e=e.splitText(g.so)),m==g.nodes.length-1&&g.eo>0&&e.splitText(m==0&&g.so>0?g.eo-g.so:g.eo));switch(d.wrap){case"text":e.nodeType==1&&e.nodeName=="BR"||e.nodeType==3&&a.trim(e.nodeValue).length>0?l(e):e.nodeType==1&&h.push(e);break;case"inline":this.rte.dom.isInline(e)?l(e):e.nodeType==1&&h.push(e);break;case"all":(e.nodeType==1||!this.rte.dom.isEmpty(e))&&l(e);break;default:(e.nodeType==1||!this.rte.dom.isEmpty(e))&&h.push(e)}}k()}return h.length&&(this.rte.window.focus(),this.select(h[0],h[h.length-1])),d.filter?this.rte.dom.filter(h,d.filter):h},this.dump=function(a,b,c,d,e){var f=this.getRangeAt();this.rte.log("commonAncestorContainer"),this.rte.log(a||f.commonAncestorContainer),this.rte.log("startContainer"),this.rte.log(b||f.startContainer),this.rte.log("startOffset: "+(d>=0?d:f.startOffset)),this.rte.log("endContainer"),this.rte.log(c||f.endContainer),this.rte.log("endOffset: "+(e>=0?e:f.endOffset))},this.selectedRaw=function(b,d){function m(b,c,d){return b.nodeType==3?(d=d>=0?d:b.nodeValue.length,c==0&&d==b.nodeValue.length||a.trim(b.nodeValue).length==a.trim(b.nodeValue.substring(c,d)).length):!0}function n(b,d,e){return b.nodeType==1?c.rte.dom.isEmpty(b):b.nodeType==3?a.trim(b.nodeValue.substring(d||0,e>=0?e:b.nodeValue.length)).length==0:!0}var e={so:null,eo:null,nodes:[]},f=this.getRangeAt(!0),g=f.commonAncestorContainer,h,j,k=!1,l=!1;f.startContainer.nodeType==1?f.startOffset<f.startContainer.childNodes.length?(h=f.startContainer.childNodes[f.startOffset],e.so=h.nodeType==1?null:0):(h=f.startContainer.childNodes[f.startOffset-1],e.so=h.nodeType==1?null:h.nodeValue.length):(h=f.startContainer,e.so=f.startOffset);if(f.collapsed){if(b)if(d){h=i(h);if(!this.rte.dom.isEmpty(h)||(h=this.rte.dom.next(h)))e.nodes=[h];this.rte.dom.isInline(h)&&(e.nodes=this.rte.dom.toLineStart(h).concat(e.nodes,this.rte.dom.toLineEnd(h))),e.nodes.length>0&&(e.so=e.nodes[0].nodeType==1?null:0,e.eo=e.nodes[e.nodes.length-1].nodeType==1?null:e.nodes[e.nodes.length-1].nodeValue.length)}else this.rte.dom.isEmpty(h)||(e.nodes=[h]);return e}f.endContainer.nodeType==1?(j=f.endContainer.childNodes[f.endOffset-1],e.eo=j.nodeType==1?null:j.nodeValue.length):(j=f.endContainer,e.eo=f.endOffset);if(h.nodeType==1||d||m(h,e.so,h.nodeValue.length))h=i(h,g,"left"),k=!0,e.so=h.nodeType==1?null:0;if(j.nodeType==1||d||m(j,0,e.eo))j=i(j,g,"right"),l=!0,e.eo=j.nodeType==1?null:j.nodeValue.length;d&&(h.nodeType!=1&&h.parentNode!=g&&h.parentNode.nodeName!="BODY"&&(h=h.parentNode,e.so=null),j.nodeType!=1&&j.parentNode!=g&&j.parentNode.nodeName!="BODY"&&(j=j.parentNode,e.eo=null)),h.parentNode==j.parentNode&&h.parentNode.nodeName!="BODY"&&k&&this.rte.dom.isFirstNotEmpty(h)&&l&&this.rte.dom.isLastNotEmpty(j)&&(h=j=h.parentNode,e.so=h.nodeType==1?null:0,e.eo=j.nodeType==1?null:j.nodeValue.length);if(h==j)return this.rte.dom.isEmpty(h)||e.nodes.push(h),e;var o=h;while(o.nodeName!="BODY"&&o.parentNode!==g&&o.parentNode.nodeName!="BODY")o=o.parentNode;var p=j;while(p.nodeName!="BODY"&&p.parentNode!==g&&p.parentNode.nodeName!="BODY")p=p.parentNode;n(h,e.so,h.nodeType==3?h.nodeValue.length:null)||e.nodes.push(h);var q=h;while(q!==o){var r=q;while(r=this.rte.dom.next(r))e.nodes.push(r);q=q.parentNode}q=o;while((q=this.rte.dom.next(q))&&q!=p)e.nodes.push(q);var s=[];q=j;while(q!==p){var r=q;while(r=this.rte.dom.prev(r))s.push(r);q=q.parentNode}return s.length&&(e.nodes=e.nodes.concat(s.reverse())),n(j,0,j.nodeType==3?e.eo:null)||e.nodes.push(j),d&&(this.rte.dom.isInline(h)&&(e.nodes=this.rte
.dom.toLineStart(h).concat(e.nodes),e.so=e.nodes[0].nodeType==1?null:0),this.rte.dom.isInline(j)&&(e.nodes=e.nodes.concat(this.rte.dom.toLineEnd(j)),e.eo=e.nodes[e.nodes.length-1].nodeType==1?null:e.nodes[e.nodes.length-1].nodeValue.length)),e}}}(jQuery),function(a){elRTE.prototype.ui=function(b){this.rte=b,this._buttons=[];var c=this,d=this.rte.options.toolbars[b.options.toolbar&&b.options.toolbars[b.options.toolbar]?b.options.toolbar:"normal"],e=d.length,f,g,h,i,j,k,l;for(l in this.buttons)this.buttons.hasOwnProperty(l)&&l!="button"&&(this.buttons[l].prototype=this.buttons.button.prototype);while(e--){first=e==0?!0:!1,d[e-1]=="eol"&&(first=!0),g=d[e];if(g=="eol"){a(this.rte.doc.createElement("br")).prependTo(this.rte.toolbar);continue}f=a('<ul class="panel-'+g+(first?" first":"")+'" />').prependTo(this.rte.toolbar),f.bind("mousedown",function(a){a.preventDefault()}),h=this.rte.options.panels[g].length;while(h--)i=this.rte.options.panels[g][h],j=this.buttons[i]||this.buttons.button,this._buttons.push(k=new j(this.rte,i)),f.prepend(k.domElem)}this.update(),this.disable=function(){a.each(c._buttons,function(){!this.active&&this.domElem.addClass("disabled")})}},elRTE.prototype.ui.prototype.update=function(b){function j(b){var c=b.nodeName.toLowerCase();return b=a(b),c=="img"&&(b.hasClass("elrte-media")?c="media":b.hasClass("elrte-google-maps")?c="google map":b.hasClass("elrte-yandex-maps")?c="yandex map":b.hasClass("elrte-pagebreak")&&(c="pagebreak")),c}b&&this.rte.selection.cleanCache();var c=this.rte.selection.getNode(),d=this.rte.dom.parents(c,"*"),e=this.rte.rtl,f=e?" &laquo; ":" &raquo; ",g="",h,i;c&&c.nodeType==1&&c.nodeName!="BODY"&&d.unshift(c),e||(d=d.reverse());for(i=0;i<d.length;i++)g+=(i>0?f:"")+j(d[i]);this.rte.statusbar.html(g),a.each(this._buttons,function(){this.update()}),this.rte.window.focus()},elRTE.prototype.ui.prototype.buttons={button:function(b,c){var d=this;this.rte=b,this.active=!1,this.name=c,this.val=null,this.domElem=a('<li style="-moz-user-select:-moz-none" class="'+c+' rounded-3" name="'+c+'" title="'+this.rte.i18n(this.rte.options.buttons[c]||c)+'" unselectable="on" />').hover(function(){a(this).addClass("hover")},function(){a(this).removeClass("hover")}).click(function(b){b.stopPropagation(),b.preventDefault(),a(this).hasClass("disabled")||d.command(),d.rte.window.focus()})}},elRTE.prototype.ui.prototype.buttons.button.prototype.command=function(){this.rte.history.add();try{this.rte.doc.execCommand(this.name,!1,this.val)}catch(a){return this.rte.log("commands failed: "+this.name)}this.rte.ui.update(!0)},elRTE.prototype.ui.prototype.buttons.button.prototype.update=function(){try{if(!this.rte.doc.queryCommandEnabled(this.name))return this.domElem.addClass("disabled");this.domElem.removeClass("disabled")}catch(a){return}try{this.rte.doc.queryCommandState(this.name)?this.domElem.addClass("active"):this.domElem.removeClass("active")}catch(a){}}}(jQuery),function(a){elRTE.prototype.utils=function(b){this.rte=b,this.url=null,this.reg=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,this.baseURL="",this.path="",this.entities={"&":"&amp;",'"':"&quot;","<":"&lt;",">":"&gt;"},this.entitiesRegExp=/[<>&\"]/g,this.media=[{type:"application/x-shockwave-flash",classid:["clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"],codebase:"http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"},{type:"application/x-director",classid:["clsid:166b1bca-3f9c-11cf-8075-444553540000"],codebase:"http://download.macromedia.com/pub/shockwave/cabs/director/sw.cab#version=8,5,1,0"},{type:"application/x-mplayer2",classid:["clsid:6bf52a52-394a-11d3-b153-00c04f79faa6","clsid:22d6f312-b0f6-11d0-94ab-0080c74c7e95","clsid:05589fa1-c356-11ce-bf01-00aa0055595a"],codebase:"http://activex.microsoft.com/activex/controls/mplayer/en/nsmp2inf.cab#Version=5,1,52,701"},{type:"video/quicktime",classid:["clsid:02bf25d5-8c17-4b23-bc80-d3488abddc6b"],codebase:"http://www.apple.com/qtactivex/qtplugin.cab#version=6,0,2,0"},{type:"audio/x-pn-realaudio-plugin",classid:["clsid:cfcdaa03-8be4-11cf-b84b-0020afbbccfa"],codebase:"http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"}],this.rgbRegExp=/\s*rgb\s*?\(\s*?([0-9]+)\s*?,\s*?([0-9]+)\s*?,\s*?([0-9]+)\s*?\)\s*/i,this.colorsRegExp=/aqua|black|blue|fuchsia|gray|green|lime|maroon|navy|olive|orange|purple|red|silver|teal|white|yellow|rgb\s*\([^\)]+\)/i,this.colors={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#ffa500",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#fffffff",yellow:"#ffff00"};var c=this;this.rgb2hex=function(a){return this.color2Hex(""+a)},this.toPixels=function(b){var c=b.match(/([0-9]+\.?[0-9]*)\s*(px|pt|em|%)/);c&&(b=c[1],unit=c[2]),b[0]=="."&&(b="0"+b),b=parseFloat(b);if(isNaN(b))return"";var d=parseInt(a(document.body).css("font-size"))||16;switch(unit){case"em":return parseInt(b*d);case"pt":return parseInt(b*d/12);case"%":return parseInt(b*d/100)}return b},this.absoluteURL=function(b){!this.url&&this._url(),b=a.trim(b);if(!b)return"";if(b[0]=="#")return b;var c=this.parseURL(b);return!c.host&&!c.path&&!c.anchor?"":this.rte.options.absoluteURLs?c.protocol?b:!c.host||c.host.indexOf(".")==-1&&c.host!="localhost"?(b[0]=="/"?b=this.baseURL+b:(b.indexOf("./")==0&&(b=b.substring(2)),b=this.baseURL+this.path+b),b):this.url.protocol+"://"+b:b},this.parseURL=function(b){var c=b.match(this.reg),d={};return a.each(["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],function(a){d[this]=c[a]}),d.host.match(/[a-z0-9]/i)||(d.host=""),d},this.trimEventCallback=function(b){return b=b?b.toString():"",a.trim(b.replace(/\r*\n/mg,"").replace(/^function\s*on[a-z]+\s*\(\s*event\s*\)\s*\{(.+)\}$/igm,"$1"))},this._url=function(){this.url=this.parseURL(window.location.href),this.baseURL=this.url.protocol+"://"+(this.url.userInfo?parts.userInfo+"@":"")+this.url.host+(this.url.port?":"+this.url.port:""),this.path=this.url.file?this.url.path.substring(0,this.url.path.length-this.url.file.length):this.url.path},this.makeObject=function(b){var c={};return a.each(b,function(a,b){c[b]=b}),c},this.encode=function(a){var b=this.entities;return(""+a).replace(this.entitiesRegExp,function(a){return b[a]})},this.decode=function(b){return a("<div/>").html(b||"").text()},this.parseStyle=function(b){var c={},d=this.rte.options.allowBrowsersSpecStyles,e,f,g,h;return typeof b=="string"&&b.length&&a.each(b.replace(/&quot;/gi,"'").split(";"),function(b,e){if((h=e.indexOf(":"))!==-1){f=a.trim(e.substr(0,h)),g=a.trim(e.substr(h+1));if(f=="color"||f=="background-color")g=g.toLowerCase();f&&g&&(d||f.substring(0,1)!="-")&&(c[f]=g)}}),c},this.compactStyle=function(b){var c=this;b.border=="medium none"&&delete b.border,a.each(b,function(a,d){/color$/i.test(a)?b[a]=c.color2Hex(d):/^(border|background)$/i.test(a)&&(b[a]=d.replace(c.colorsRegExp,function(a){return c.color2Hex(a)}))}),b["border-width"]&&(b.border=b["border-width"]+" "+(b["border-style"]||"solid")+" "+(b["border-color"]||"#000"),delete b["border-width"],delete b["border-style"],delete b["border-color"]),b["background-image"]&&(b.background=b["background-color"]+" "||""+b["background-image"]+" "+b["background-position"]||"0 0 "+b["background-repeat"]||"repeat",delete b["background-image"],delete ["background-image"],delete ["background-position"],delete ["background-repeat"]),b["margin-top"]&&b["margin-right"]&&b["margin-bottom"]&&b["margin-left"]&&(b.margin=b["margin-top"]+" "+b["margin-right"]+" "+b["margin-bottom"]+" "+b["margin-left"],delete b["margin-top"],delete b["margin-right"],delete b["margin-bottom"],delete b["margin-left"]),b["padding-top"]&&b["padding-right"]&&b["padding-bottom"]&&b["padding-left"]&&(b.padding=b["padding-top"]+" "+b["padding-right"]+" "+b["padding-bottom"]+" "+b["padding-left"],delete b["padding-top"],delete b["padding-right"],delete b["padding-bottom"],delete b["padding-left"]);if(b["list-style-type"]||b["list-style-position"]||b["list-style-image"])b["list-style"]=a.trim(b["list-style-type"]||" "+b["list-style-position"]||""+b["list-style-image"]||""),delete b["list-style-type"],delete b["list-style-position"],delete b["list-style-image"];return b},this.serializeStyle=function(b,c){var d=[];return a.each(c?this.compactStyle(b):b,function(a,b){b&&d.push(a+":"+b)}),d.join(";")},this.parseClass=function(b){return b=a.trim(b),b.length?this.makeObject(b.split(/\s+/)):{}},this.serializeClass=function(b){var c=[],d=this.rte;return a.each(b,function(a){c.push(a)}),c.join(" ")},this.mediaInfo=function(b,c){var d=this.media.length;while(d--)if(b===this.media[d].type||c&&a.inArray(c,this.media[d].classid)!=-1)return this.media[d]},this.color2Hex=function(a){function c(a){return a=parseInt(a).toString(16),a.length>1?a:"0"+a}var b;return a=a||"",a.indexOf("#")===0?a:this.colors[a]?this.colors[a]:(b=a.match(this.rgbRegExp))?"#"+c(b[1])+c(b[2])+c(b[3]):""}}}(jQuery),function(a){elRTE.prototype.w3cRange=function(a){var b=this;this.rte=a,this.r=null,this.collapsed=!0,this.startContainer=null,this.endContainer=null,this.startOffset=0,this.endOffset=0,this.commonAncestorContainer=null,this.range=function(){try{this.r=this.rte.window.document.selection.createRange()}catch(a){this.r=this.rte.doc.body.createTextRange()}return this.r},this.insertNode=function(a){this.range(),b.r.collapse(!1);var c=b.r.duplicate();c.pasteHTML(a)},this.getBookmark=function(){this.range();if(this.r.item){var a=this.r.item(0);this.r=this.rte.doc.body.createTextRange(),this.r.moveToElementText(a)}return this.r.getBookmark()},this.moveToBookmark=function(a){this.rte.window.focus(),this.range().moveToBookmark(a),this.r.select()},this.update=function(){function a(a){var c="﻿",d=offset=0,e=b.r.duplicate();e.collapse(a);var f=e.parentElement();if(!f||f.nodeName=="HTML")return{parent:b.rte.doc.body,ndx:d,offset:offset};e.pasteHTML(c),childs=f.childNodes;for(var g=0;g<childs.length;g++){var h=childs[g];g>0&&(h.nodeType!==3||childs[g-1].nodeType!==3)&&d++;if(h.nodeType!==3)offset=0;else{var i=h.nodeValue.indexOf(c);if(i!==-1){offset+=i;break}offset+=h.nodeValue.length}}return e.moveStart("character",-1),e.text="",{parent:f,ndx:Math.min(d,f.childNodes.length-1),offset:offset}}this.range(),this.startContainer=this.endContainer=null;if(this.r.item){this.collapsed=!1;var c=this.r.item(0);this.setStart(c.parentNode,this.rte.dom.indexOf(c)),this.setEnd(c.parentNode,this.startOffset+1)}else{this.collapsed=this.r.boundingWidth==0;var d=a(!0),e=a(!1);d.parent.normalize(),e.parent.normalize(),d.ndx=Math.min(d.ndx,d.parent.childNodes.length-1),e.ndx=Math.min(e.ndx,e.parent.childNodes.length-1),d.parent.childNodes[d.ndx].nodeType&&d.parent.childNodes[d.ndx].nodeType==1?this.setStart(d.parent,d.ndx):this.setStart(d.parent.childNodes[d.ndx],d.offset),e.parent.childNodes[e.ndx].nodeType&&e.parent.childNodes[e.ndx].nodeType==1?this.setEnd(e.parent,e.ndx):this.setEnd(e.parent.childNodes[e.ndx],e.offset),this.select()}return this},this.isCollapsed=function(){return this.range(),this.collapsed=this.r.item?!1:this.r.boundingWidth==0,this.collapsed},this.collapse=function(a){this.range();if(this.r.item){var b=this.r.item(0);this.r=this.rte.doc.body.createTextRange(),this.r.moveToElementText(b)}this.r.collapse(a),this.r.select(),this.collapsed=!0},this.getStart=function(){this.range();if(this.r.item)return this.r.item(0);var a=this.r.duplicate();a.collapse(!0);var b=a.parentElement();return b&&b.nodeName=="BODY"?b.firstChild?b.firstChild:b.parentNode.parentNode:b},this.getEnd=function(){this.range();if(this.r.item)return this.r.item(0);var a=this.r.duplicate();a.collapse(!1);var b=a.parentElement();return b&&b.nodeName=="BODY"?b.lastChild?b.lastChild:b.parentNode.parentNode:b},this.setStart=function(a,b){this.startContainer=a,this.startOffset=b,this.endContainer&&(this.commonAncestorContainer=this.rte.dom.findCommonAncestor(this.startContainer,this.endContainer))},this.setEnd=function(a,b){this.endContainer=a,this.endOffset=b,this.startContainer&&(this.commonAncestorContainer=this.rte.dom.findCommonAncestor(this.startContainer,this.endContainer))},this.setStartBefore=function(a){a.parentNode&&this.setStart(a.parentNode,this.rte.dom.indexOf(a))},this.setStartAfter=function(a){a.parentNode&&this.setStart(a.parentNode,this.rte.dom.indexOf(a)+1)},this.setEndBefore=function(a){a.parentNode&&this.setEnd(a.parentNode,this.rte.dom.indexOf(a))},this.setEndAfter=function(a){a.parentNode&&this.setEnd(a.parentNode,this.rte.dom.indexOf(a)+1)},this.select=function(){function a(a,c){if(a.nodeType!=3)return-1;var d="﻿",e=a.nodeValue,f=b.rte.doc.body.createTextRange();a.nodeValue=e.substring(0,c)+d+e.substring(c),f.moveToElementText(a.parentNode),f.findText(d);var g=Math.abs(f.moveStart("character",-1048575));return a.nodeValue=e,g}this.r=this.rte.doc.body.createTextRange();var c=this.startOffset,d=this.endOffset,e=this.startContainer.nodeType==1?this.startContainer.childNodes[Math.min(c,this.startContainer.childNodes.length-1)]:this.startContainer,f=this.endContainer.nodeType==1?this.endContainer.childNodes[Math.min(c==d?d:d-1,this.endContainer.childNodes.length-1)]:this.endContainer;if(this.collapsed)if(e.nodeType==3){var g=a(e,c);this.r.move("character",g)}else this.r.moveToElementText(e),this.r.collapse(!0);else{var h=this.rte.doc.body.createTextRange(),i=a(e,c),j=a(f,d);e.nodeType==3?this.r.move("character",i):this.r.moveToElementText(e),f.nodeType==3?h.move("character",j):h.moveToElementText(f),this.r.setEndPoint("EndToEnd",h)}try{this.r.select()}catch(f){}h&&(h=null)},this.dump=function(){this.rte.log("collapsed: "+this.collapsed),this.rte.log("startContainer: "+(this.startContainer?this.startContainer.nodeName:"non")),this.rte.log("startOffset: "+this.startOffset),this.rte.log("endContainer: "+(this.endContainer?this.endContainer.nodeName:"none")),this.rte.log("endOffset: "+this.endOffset)}}}(jQuery),function(a){elRTE.prototype.ui.prototype.buttons.about=function(b,c){this.constructor.prototype.constructor.call(this,b,c),this.active=!0,this.command=function(){var c,d,e;c={rtl:b.rtl,rte:this.rte,submit:function(a,b){b.close()},dialog:{width:560,title:this.rte.i18n("About this software"),buttons:{Ok:function(){a(this).dialog("destroy")}}}},e='<div class="elrte-logo"></div><h3>'+this.rte.i18n("About elRTE")+'</h3><br clear="all"/>'+'<div class="elrte-ver">'+this.rte.i18n("Version")+": "+this.rte.version+" ("+this.rte.build+")</div>"+'<div class="elrte-ver">jQuery: '+a("<div/>").jquery+"</div>"+'<div class="elrte-ver">jQueryUI: '+a.ui.version+"</div>"+'<div class="elrte-ver">'+this.rte.i18n("Licence")+": BSD Licence</div>"+"<p>"+this.rte.i18n("elRTE is an open-source JavaScript based WYSIWYG HTML-editor.")+"<br/>"+this.rte.i18n("Main goal of the editor - simplify work with text and formating (HTML) on sites, blogs, forums and other online services.")+"<br/>"+this.rte.i18n("You can use it in any commercial or non-commercial projects.")+"</p>"+"<h4>"+this.rte.i18n("Authors")+"</h4>"+'<table class="elrte-authors">'+"<tr><td>Dmitry (dio) Levashov &lt;dio@std42.ru&gt;</td><td>"+this.rte.i18n("Chief developer")+"</td></tr>"+"<tr><td>Troex Nevelin &lt;troex@fury.scancode.ru&gt;</td><td>"+this.rte.i18n("Developer, tech support")+"</td></tr>"+"<tr><td>Valentin Razumnyh &lt;content@std42.ru&gt;</td><td>"+this.rte.i18n("Interface designer")+"</td></tr>"+"<tr><td>Tawfek Daghistani &lt;tawfekov@gmail.com&gt;</td><td>"+this.rte.i18n("RTL support")+"</td></tr>"+(this.rte.options.lang!="en"?"<tr><td>"+this.rte.i18n("_translator")+"</td><td>"+this.rte.i18n("_translation")+"</td></tr>":"")+"</table>"+'<div class="elrte-copy">Copyright &copy; 2009-2011, <a href="http://www.std42.ru">Studio 42</a></div>'+'<div class="elrte-copy">'+this.rte.i18n("For more information about this software visit the")+' <a href="http://elrte.org">'+this.rte.i18n("elRTE website")+".</a></div>"+'<div class="elrte-copy">Twitter: <a href="http://twitter.com/elrte_elfinder">elrte_elfinder</a></div>',d=new elDialogForm(c),d.append(e),d.open()},this.update=function(){this.domElem.removeClass("disabled")}}}(jQuery),function(a){elRTE.prototype.ui.prototype.buttons.anchor=function(b,c){this.constructor.prototype.constructor.call(this,b,c),this.input=a('<input type="text" />').attr("name","anchor").attr("size","16");var d=this;this.command=function(){var c={rtl:this.rte.rtl,rte:this.rte,submit:function(a,b){a.stopPropagation(),a.preventDefault(),b.close(),d.set()},dialog:{title:this.rte.i18n("Bookmark")}};this.anchor=this.rte.dom.selfOrParentAnchor(this.rte.selection.getEnd())||b.dom.create("a"),!this.rte.selection.collapsed()&&this.rte.selection.collapse(!1),this.input.val(a(this.anchor).addClass("elrte-anchor").attr("name")),this.rte.selection.saveIERange();var e=new elDialogForm(c);e.append([this.rte.i18n("Bookmark name"),this.input],null,!0).open(),setTimeout(function(){d.input.focus()},20)},this.update=function(){var a=this.rte.selection.getNode();this.rte.dom.selfOrParentLink(a)?this.domElem.addClass("disabled"):this.rte.dom.selfOrParentAnchor(a)?this.domElem.removeClass("disabled").addClass("active"):this.domElem.removeClass("disabled").removeClass("active")},this.set=function(){var b=a.trim(this.input.val());b?(this.rte.history.add(),this.anchor.parentNode?(this.anchor.name=b,this.anchor.title=this.rte.i18n("Bookmark")+": "+b):this.rte.selection.insertHtml('<a name="'+b+'" title="'+this.rte.i18n("Bookmark")+": "+b+'" class="elrte-anchor"></a>')):this.anchor.parentNode&&(this.rte.history.add(),this.anchor.parentNode.removeChild(this.anchor))}}}(jQuery),function(a){elRTE.prototype.ui.prototype.buttons.blockquote=function(b,c){this.constructor.prototype.constructor.call(this,b,c),this.command=function(){var b,c;this.rte.history.add(),this.rte.selection.collapsed()&&(b=this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^BLOCKQUOTE$/))?a(b).replaceWith(a(b).html()):(c=this.rte.selection.selected({wrap:"all",tag:"blockquote"}),c.length&&this.rte.selection.select(c[0],c[c.length-1])),this.rte.ui.update(!0)},this.update=function(){this.rte.selection.collapsed()?this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^BLOCKQUOTE$/)?this.domElem.removeClass("disabled").addClass("active"):this.domElem.addClass("disabled").removeClass("active"):this.domElem.removeClass("disabled active")}}}(jQuery),function(a){elRTE.prototype.ui.prototype.buttons.copy=function(b,c){this.constructor.prototype.constructor.call(this,b,c),this.command=function(){if(this.rte.browser.mozilla)try{this.rte.doc.execCommand(this.name,!1,null)}catch(b){var c=" Ctl + C";this.name=="cut"?c=" Ctl + X":this.name=="paste"&&(c=" Ctl + V");var d={rte:this.rte,dialog:{title:this.rte.i18n("Warning"),buttons:{Ok:function(){a(this).dialog("close")}}}},e=new elDialogForm(d);e.append(this.rte.i18n("This operation is disabled in your browser on security reason. Use shortcut instead.")+": "+c).open()}else this.constructor.prototype.command.call(this)}},elRTE.prototype.ui.prototype.buttons.cut=elRTE.prototype.ui.prototype.buttons.copy,elRTE.prototype.ui.prototype.buttons.paste=elRTE.prototype.ui.prototype.buttons.copy}(jQuery),function(a){elRTE.prototype.ui.prototype.buttons.css=function(b,c){var d=this;this.constructor.prototype.constructor.call(this,b,c),this.cssStyle=a('<input type="text" size="42" name="style" />'),this.cssClass=a('<input type="text" size="42" name="class" />'),this.elementID=a('<input type="text" size="42" name="id" />'),this.command=function(){var b=this.node(),c;this.rte.selection.saveIERange();if(b){var c={rte:this.rte,submit:function(a,b){a.stopPropagation(),a.preventDefault(),b.close(),d.set()},dialog:{title:this.rte.i18n("Style"),width:450,resizable:!0,modal:!0}};this.cssStyle.val(a(b).attr("style")),this.cssClass.val(a(b).attr("class")),this.elementID.val(a(b).attr("id"));var e=new elDialogForm(c);e.append([this.rte.i18n("Css style"),this.cssStyle],null,!0),e.append([this.rte.i18n("Css class"),this.cssClass],null,!0),e.append([this.rte.i18n("ID"),this.elementID],null,!0),e.open(),setTimeout(function(){d.cssStyle.focus()},20)}},this.set=function(){var b=this.node();this.rte.selection.restoreIERange(),b&&(a(b).attr("style",this.cssStyle.val()),a(b).attr("class",this.cssClass.val()),a(b).attr("id",this.elementID.val()),this.rte.ui.update())},this.node=function(){var a=this.rte.selection.getNode();return a.nodeType==3&&(a=a.parentNode),a.nodeType==1&&a.nodeName!="BODY"?a:null},this.update=function(){this.domElem.toggleClass("disabled",this.node()?!1:!0)}}}(jQuery),function(a){elRTE.prototype.ui.prototype.buttons.rtl=function(b,c){this.constructor.prototype.constructor.call(this,b,c);var d=this;this.command=function(){var b=this.rte.selection.getNode(),c=this;a(b).attr("dir")=="rtl"||a(b).parents('[dir="rtl"]').length||a(b).find('[dir="rtl"]').length?(a(b).removeAttr("dir"),a(b).parents('[dir="rtl"]').removeAttr("dir"),a(b).find('[dir="rtl"]').removeAttr("dir")):this.rte.dom.is(b,"textNodes")&&this.rte.dom.is(b,"block")?a(b).attr("dir","rtl"):a.each(this.rte.dom.parents(b,"textNodes"),function(b,d){if(c.rte.dom.is(d,"block"))return a(d).attr("dir","rtl"),!1}),this.rte.ui.update()},this.update=function(){var b=this.rte.selection.getNode();this.domElem.removeClass("disabled"),a(b).attr("dir")=="rtl"||a(b).parents('[dir="rtl"]').length||a(b).find('[dir="rtl"]').length?this.domElem.addClass("active"):this.domElem.removeClass("active")}},elRTE.prototype.ui.prototype.buttons.ltr=function(b,c){this.constructor.prototype.constructor.call(this,b,c);var d=this;this.command=function(){var b=this.rte.selection.getNode(),c=this;a(b).attr("dir")=="ltr"||a(b).parents('[dir="ltr"]').length||a(b).find('[dir="ltr"]').length?(a(b).removeAttr("dir"),a(b).parents('[dir="ltr"]').removeAttr("dir"),a(b).find('[dir="ltr"]').removeAttr("dir")):this.rte.dom.is(b,"textNodes")&&this.rte.dom.is(b,"block")?a(b).attr("dir","ltr"):a.each(this.rte.dom.parents(b,"textNodes"),function(b,d){if(c.rte.dom.is(d,"block"))return a(d).attr("dir","ltr"),!1}),this.rte.ui.update()},this.update=function(){var b=this.rte.selection.getNode();this.domElem.removeClass("disabled"),a(b).attr("dir")=="ltr"||a(b).parents('[dir="ltr"]').length||a(b).find('[dir="ltr"]').length?this.domElem.addClass("active"):this.domElem.removeClass("active")}}}(jQuery),function(a){elRTE.prototype.ui.prototype.buttons.div=function(b,c){this.constructor.prototype.constructor.call(this,b,c),this.command=function(){var b,c;this.rte.history.add(),this.rte.selection.collapsed()?(b=this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^DIV$/),b&&a(b).replaceWith(a(b).html())):(c=this.rte.selection.selected({wrap:"all",tag:"div"}),c.length&&this.rte.selection.select(c[0],c[c.length-1])),this.rte.ui.update(!0)},this.update=function(){this.rte.selection.collapsed()?this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^DIV$/)?this.domElem.removeClass("disabled").addClass("active"):this.domElem.addClass("disabled active"):this.domElem.removeClass("disabled active")}}}(jQuery),function(a){elRTE.prototype.ui.prototype.buttons.docstructure=function(b,c){this.constructor.prototype.constructor.call(this,b,c),this.command=function(){this.domElem.toggleClass("active"),a(this.rte.doc.body).toggleClass("el-rte-structure")},this.command(),this.update=function(){this.domElem.removeClass("disabled")}}}(jQuery),function(a){elRTE.prototype.ui.prototype.buttons.elfinder=function(a,b){this.constructor.prototype.constructor.call(this,a,b);var c=this,a=this.rte;this.command=function(){c.rte.options.fmAllow&&typeof c.rte.options.fmOpen=="function"&&c.rte.options.fmOpen(function(b){var c=decodeURIComponent(b.split("/").pop().replace(/\+/g," "));a.selection.collapsed()?a.selection.insertHtml('<a href="'+b+'" >'+c+"</a>"):a.doc.execCommand("createLink",!1,b)})},this.update=function(){c.rte.options.fmAllow&&typeof c.rte.options.fmOpen=="function"?this.domElem.removeClass("disabled"):this.domElem.addClass("disabled")}}}(jQuery),function(a){elRTE.prototype.ui.prototype.buttons.flash=function(b,c){this.constructor.prototype.constructor.call(this,b,c);var d=this;this.swf=null,this.placeholder=null,this.src={url:a('<input type="text" name="url" />').css("width","99%"),type:a('<input type="hidden" name="type" value="application/x-shockwave-flash"/>'),width:a('<input type="text" />').attr("size",5).css("text-align","right"),height:a('<input type="text" />').attr("size",5).css("text-align","right"),wmode:a("<select />").append(a("<option />").val("").text(this.rte.i18n("Not set","dialogs"))).append(a("<option />").val("transparent").text(this.rte.i18n("Transparent"))),align:a("<select />").append(a("<option />").val("").text(this.rte.i18n("Not set","dialogs"))).append(a("<option />").val("left").text(this.rte.i18n("Left"))).append(a("<option />").val("right").text(this.rte.i18n("Right"))).append(a("<option />").val("top").text(this.rte.i18n("Top"))).append(a("<option />").val("text-top").text(this.rte.i18n("Text top"))).append(a("<option />").val("middle").text(this.rte.i18n("middle"))).append(a("<option />").val("baseline").text(this.rte.i18n("Baseline"))).append(a("<option />").val("bottom").text(this.rte.i18n("Bottom"))).append(a("<option />").val("text-bottom").text(this.rte.i18n("Text bottom"))),margin:a("<div />")},this.command=function(){var b=this.rte.selection.getEnd(),c,e="",f="",g="",h,i,j,k,m,n;this.rte.selection.saveIERange(),this.src.margin.elPaddingInput({type:"margin"}),this.placeholder=null,this.swf=null;if(a(b).hasClass("elrte-media")&&(k=a(b).attr("rel"))&&this.rte.filter.scripts[k]){this.placeholder=a(b),m=this.rte.filter.scripts[k],e="",m.embed&&m.embed.src&&(e=m.embed.src);if(m.params&&m.params.length){l=m.params.length;while(l--)if(m.params[l].name=="src"||m.params[l].name=="movie")e=m.params[l].value}m.embed?(f=m.embed.width||parseInt(m.embed.style.width)||"",g=m.embed.height||parseInt(m.embed.style.height)||"",n=m.embed.wmode||""):m.obj&&(f=m.obj.width||parseInt(m.obj.style.width)||"",g=m.obj.height||parseInt(m.obj.style.height)||"",n=m.obj.wmode||""),m.obj?(h=m.obj.style["float"]||"",i=m.obj.style["vertical-align"]||""):m.embed&&(h=m.embed.style["float"]||"",i=m.embed.style["vertical-align"]||""),this.src.margin.val(b),this.src.type.val(m.embed?m.embed.type:"")}a(b).hasClass("elrte-swf-placeholder")&&(this.placeholder=a(b),e=a(b).attr("rel"),f=parseInt(a(b).css("width"))||"",g=parseInt(a(b).css("height"))||"",h=a(b).css("float"),i=a(b).css("vertical-align"),this.src.margin.val(b),this.src.wmode.val(a(b).attr("wmode"))),this.src.url.val(e),this.src.width.val(f),this.src.height.val(g),this.src.align.val(h||i),this.src.wmode.val(n);var c={rte:this.rte,rtl:this.rte.rtl,submit:function(a,b){a.stopPropagation(),a.preventDefault(),d.set(),b.close()},dialog:{width:580,position:"top",title:this.rte.i18n("Flash")}},j=new elDialogForm(c);if(this.rte.options.fmAllow&&this.rte.options.fmOpen)var o=a("<span />").append(this.src.url.css("width","85%")).append(a("<span />").addClass("ui-state-default ui-corner-all").css({"float":"right","margin-right":"3px"}).attr("title",d.rte.i18n("Open file manger")).append(a("<span />").addClass("ui-icon ui-icon-folder-open")).click(function(){d.rte.options.fmOpen(function(a){d.src.url.val(a).change()})}).hover(function(){a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")}));else var o=this.src.url;j.append([this.rte.i18n("URL"),o],null,!0),j.append([this.rte.i18n("Size"),a("<span />").append(this.src.width).append(" x ").append(this.src.height).append(" px")],null,!0),j.append([this.rte.i18n("Wmode"),this.src.wmode],null,!0),j.append([this.rte.i18n("Alignment"),this.src.align],null,!0),j.append([this.rte.i18n("Margins"),this.src.margin],null,!0),j.open();var p=a("<fieldset />").append(a("<legend />").text(this.rte.i18n("Preview")));j.append(p,"main");var q=document.createElement("iframe");a(q).attr("src","#").addClass("el-rte-preview").appendTo(p),html=this.rte.options.doctype+'<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /></head><body style="padding:0;margin:0;font-size:9px"> Proin elit arcu, rutrum commodo, vehicula tempus, commodo a, risus. Curabitur nec arcu. Donec sollicitudin mi sit amet mauris. Nam elementum quam ullamcorper ante. Etiam aliquet massa et lorem. Mauris dapibus lacus auctor risus. Aenean tempor ullamcorper leo. Vivamus sed magna quis ligula eleifend adipiscing. Duis orci. Aliquam sodales tortor vitae ipsum. Aliquam nulla. Duis aliquam molestie erat. Ut et mauris vel pede varius sollicitudin</body></html>',q.contentWindow.document.open(),q.contentWindow.document.write(html),q.contentWindow.document.close(),this.frame=q.contentWindow.document,this.preview=a(q.contentWindow.document.body),this.src.type.change(function(){d.src.url.change()}),this.src.width.change(function(){if(d.swf){var b=parseInt(a(this).val())||"";a(this).val(b),d.swf.css("width",b),d.swf.children("embed").css("width",b)}else a(this).val("")}),this.src.height.change(function(){if(d.swf){var b=parseInt(a(this).val())||"";a(this).val(b),d.swf.css("height",b),d.swf.children("embed").css("height",b)}else a(this).val("")}),this.src.wmode.change(function(){if(d.swf){var b=a(this).val();b?(d.swf.attr("wmode",b),d.swf.children("embed").attr("wmode",b)):(d.swf.removeAttr("wmode"),d.swf.children("embed").removeAttr("wmode"))}}),this.src.align.change(function(){var b=a(this).val(),c=b=="left"||b=="right";d.swf?d.swf.css({"float":c?b:"","vertical-align":c?"":b}):a(this).val("")}),this.src.margin.change(function(){if(d.swf){var a=d.src.margin.val();a.css?d.swf.css("margin",a.css):(d.swf.css("margin-top",a.top),d.swf.css("margin-right",a.right),d.swf.css("margin-bottom",a.bottom),d.swf.css("margin-left",a.left))}}),this.src.url.change(function(){var b=d.rte.utils.absoluteURL(a(this).val()),c,e;b?(c=d.rte.utils.mediaInfo(d.src.type.val()),c||(c=d.rte.util.mediaInfo("application/x-shockwave-flash")),e='<object classid="'+c.classid+'" codebase="'+c.codebase+'"><param name="src" value="'+b+'" /><embed quality="high" src="'+b+'" type="'+c.type+'"></object>',d.preview.children("object").remove().end().prepend(e),d.swf=d.preview.children("object").eq(0)):d.swf&&(d.swf.remove(),d.swf=null),d.src.width.trigger("change"),d.src.height.trigger("change"),d.src.align.trigger("change")}).trigger("change")},this.set=function(){d.swf=null;var b=this.rte.utils.absoluteURL(this.src.url.val()),c=parseInt(this.src.width.val())||"",e=parseInt(this.src.height.val())||"",f=this.src.wmode.val(),g=this.src.align.val(),h=g=="left"||g=="right"?g:"",j=this.placeholder?this.placeholder.attr("rel"):"",k,l,m,n=this.src.margin.val(),o;if(!b)this.placeholder&&(this.placeholder.remove(),delete this.rte.filter.scripts[j]);else{i=d.rte.utils.mediaInfo(d.src.type.val()),i||(i=d.rte.util.mediaInfo("application/x-shockwave-flash")),m=this.rte.filter.videoHostRegExp.test(b)?b.replace(this.rte.filter.videoHostRegExp,"$2"):i.type.replace(/^\w+\/(.+)/,"$1"),k={obj:{classid:i.classid[0],codebase:i.codebase,style:{}},params:[{name:"src",value:b}],embed:{src:b,type:i.type,quality:"high",wmode:f,style:{}}},c&&(k.obj.width=c,k.embed.width=c),e&&(k.obj.height=e,k.embed.height=e),h?k.obj.style["float"]=h:g&&(k.obj.style["vertical-align"]=g),n.css?o={margin:n.css}:o={"margin-top":n.top,"margin-right":n.right,"margin-bottom":n.bottom,"margin-left":n.left},k.obj.style=a.extend({},k.obj.style,o);if(this.placeholder&&j)l=this.rte.filter.scripts[j]||{},k=a.extend(!0,l,k),delete k.obj.style.width,delete k.obj.style.height,delete k.embed.style.width,delete k.embed.style.height,this.rte.filter.scripts[j]=k,this.placeholder.removeAttr("class");else{var p="media"+Math.random().toString().substring(2);this.rte.filter.scripts[p]=k,this.placeholder=a(this.rte.dom.create("img")).attr("rel",p).attr("src",this.rte.filter.url+"pixel.gif");var q=!0}this.placeholder.attr("title",this.rte.utils.encode(b)).attr("width",c||150).attr("height",e||100).addClass("elrte-protected elrte-media elrte-media-"+m).css(k.obj.style),h?this.placeholder.css("float",h).css("vertical-align",""):g?this.placeholder.css("float","").css("vertical-align",g):this.placeholder.css("float","").css("vertical-align",""),q&&(this.rte.window.focus(),this.rte.selection.restoreIERange(),this.rte.selection.insertNode(this.placeholder.get(0)))}},this.update=function(){this.domElem.removeClass("disabled");var b=this.rte.selection.getNode();this.domElem.toggleClass("active",b&&b.nodeName=="IMG"&&
a(b).hasClass("elrte-media"))}}}(jQuery),function(a){elRTE.prototype.ui.prototype.buttons.fontname=function(b,c){this.constructor.prototype.constructor.call(this,b,c);var d=this,e={tpl:'<span style="font-family:%val">%label</span>',select:function(a){d.set(a)},src:{"":this.rte.i18n("Font"),"andale mono,sans-serif":"Andale Mono","arial,helvetica,sans-serif":"Arial","arial black,gadget,sans-serif":"Arial Black","book antiqua,palatino,sans-serif":"Book Antiqua","comic sans ms,cursive":"Comic Sans MS","courier new,courier,monospace":"Courier New","georgia,palatino,serif":"Georgia","helvetica,sans-serif":"Helvetica","impact,sans-serif":"Impact","lucida console,monaco,monospace":"Lucida console","lucida sans unicode,lucida grande,sans-serif":"Lucida grande","tahoma,sans-serif":"Tahoma","times new roman,times,serif":"Times New Roman","trebuchet ms,lucida grande,verdana,sans-serif":"Trebuchet MS","verdana,geneva,sans-serif":"Verdana"}};this.select=this.domElem.elSelect(e),this.command=function(){},this.set=function(b){this.rte.history.add();var c=this.rte.selection.selected({filter:"textContainsNodes"});a.each(c,function(){$this=/^(THEAD|TFOOT|TBODY|COL|COLGROUP|TR)$/.test(this.nodeName)?a(this).find("td,th"):a(this),a(this).css("font-family",b).find("[style]").css("font-family","")}),this.rte.ui.update()},this.update=function(){this.domElem.removeClass("disabled");var b=this.rte.selection.getNode();b.nodeType!=1&&(b=b.parentNode);var c=a(b).css("font-family");c=c?c.toString().toLowerCase().replace(/,\s+/g,",").replace(/'|"/g,""):"",this.select.val(e.src[c]?c:"")}}}(jQuery),function(a){elRTE.prototype.ui.prototype.buttons.fontsize=function(b,c){this.constructor.prototype.constructor.call(this,b,c);var d=this,e={labelTpl:"%label",tpl:'<span style="font-size:%val;line-height:1.2em">%label</span>',select:function(a){d.set(a)},src:{"":this.rte.i18n("Font size"),"xx-small":this.rte.i18n("Small (8pt)"),"x-small":this.rte.i18n("Small (10px)"),small:this.rte.i18n("Small (12pt)"),medium:this.rte.i18n("Normal (14pt)"),large:this.rte.i18n("Large (18pt)"),"x-large":this.rte.i18n("Large (24pt)"),"xx-large":this.rte.i18n("Large (36pt)")}};this.select=this.domElem.elSelect(e),this.command=function(){},this.set=function(b){this.rte.history.add();var c=this.rte.selection.selected({filter:"textContainsNodes"});a.each(c,function(){$this=/^(THEAD|TFOOT|TBODY|COL|COLGROUP|TR)$/.test(this.nodeName)?a(this).find("td,th"):a(this),$this.css("font-size",b).find("[style]").css("font-size","")}),this.rte.ui.update()},this.update=function(){this.domElem.removeClass("disabled");var a=this.rte.selection.getNode();this.select.val((m=this.rte.dom.attr(a,"style").match(/font-size:\s*([^;]+)/i))?m[1]:"")}}}(jQuery),function(a){elRTE.prototype.ui.prototype.buttons.forecolor=function(b,c){var d=this;this.constructor.prototype.constructor.call(this,b,c);var e={"class":"",palettePosition:"outer",color:this.defaultColor,update:function(a){d.indicator.css("background-color",a)},change:function(a){d.set(a)}};this.defaultColor=this.name=="forecolor"?"#000000":"#ffffff",this.picker=this.domElem.elColorPicker(e),this.indicator=a("<div />").addClass("color-indicator").prependTo(this.domElem),this.command=function(){},this.set=function(b){if(!this.rte.selection.collapsed()){this.rte.history.add();var c=this.rte.selection.selected({collapse:!1,wrap:"text"}),d=this.name=="forecolor"?"color":"background-color";a.each(c,function(){/^(THEAD|TBODY|TFOOT|TR)$/.test(this.nodeName)?a(this).find("td,th").each(function(){a(this).css(d,b).find("*").css(d,"")}):a(this).css(d,b).find("*").css(d,"")}),this.rte.ui.update(!0)}},this.update=function(){this.domElem.removeClass("disabled");var b=this.rte.selection.getNode();this.picker.val(this.rte.utils.rgb2hex(a(b.nodeType!=1?b.parentNode:b).css(this.name=="forecolor"?"color":"background-color"))||this.defaultColor)}},elRTE.prototype.ui.prototype.buttons.hilitecolor=elRTE.prototype.ui.prototype.buttons.forecolor}(jQuery),function(a){elRTE.prototype.ui.prototype.buttons.formatblock=function(b,c){this.constructor.prototype.constructor.call(this,b,c);var d=this.rte.browser.msie?function(a){f.val=a,f.constructor.prototype.command.call(f)}:function(a){f.ieCommand(a)},f=this,g={labelTpl:"%label",tpls:{"":"%label"},select:function(a){f.formatBlock(a)},src:{span:this.rte.i18n("Format"),h1:this.rte.i18n("Heading 1"),h2:this.rte.i18n("Heading 2"),h3:this.rte.i18n("Heading 3"),h4:this.rte.i18n("Heading 4"),h5:this.rte.i18n("Heading 5"),h6:this.rte.i18n("Heading 6"),p:this.rte.i18n("Paragraph"),address:this.rte.i18n("Address"),pre:this.rte.i18n("Preformatted"),div:this.rte.i18n("Normal (DIV)")}};this.select=this.domElem.elSelect(g),this.command=function(){},this.formatBlock=function(b){function c(b,c){function d(b){return a(b).find("h1,h2,h3,h4,h5,h6,p,address,pre").each(function(){a(this).replaceWith(a(this).html())}),b}/^(LI|DT|DD|TD|TH|CAPTION)$/.test(b.nodeName)?!f.rte.dom.isEmpty(b)&&f.rte.dom.wrapContents(d(b),c):/^(UL|OL|DL|TABLE)$/.test(b.nodeName)?f.rte.dom.wrap(b,c):!f.rte.dom.isEmpty(b)&&a(d(b)).replaceWith(a(f.rte.dom.create(c)).html(a(b).html()))}this.rte.history.add();var d=b.toUpperCase(),g,h,i,j=this.rte.selection.collapsed(),k=this.rte.selection.getBookmark(),m=this.rte.selection.selected({collapsed:!0,blocks:!0,filter:"textContainsNodes",wrap:"inline",tag:"span"});l=m.length,s=a(m[0]).prev(),e=a(m[m.length-1]).next();while(l--)h=m[l],i=a(h),d=="DIV"||d=="SPAN"?/^(H[1-6]|P|ADDRESS|PRE)$/.test(h.nodeName)&&i.replaceWith(a(this.rte.dom.create("div")).html(i.html()||"")):/^(THEAD|TBODY|TFOOT|TR)$/.test(h.nodeName)?i.find("td,th").each(function(){c(this,d)}):h.nodeName!=d&&c(h,d);this.rte.selection.moveToBookmark(k),this.rte.ui.update(!0)},this.update=function(){this.domElem.removeClass("disabled");var a=this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^(H[1-6]|P|ADDRESS|PRE)$/);this.select.val(a?a.nodeName.toLowerCase():"span")}}}(jQuery),function(a){elRTE.prototype.ui.prototype.buttons.fullscreen=function(b,c){function e(){d.wz.height(a(window).height()-d.delta),d.rte.updateHeight()}var d=this;this.constructor.prototype.constructor.call(this,b,c),this.active=!0,this.editor=b.editor,this.wz=b.workzone,this.height=0,this.delta=0,this._class="el-fullscreen",setTimeout(function(){d.height=d.wz.height(),d.delta=d.editor.outerHeight()-d.height},50),this.command=function(){function o(){l&&(m=k.getBookmark())}function p(){l&&(d.wz.children().toggle(),d.rte.source.focus(),d.wz.children().toggle(),k.moveToBookmark(m))}var b=a(window),c=this.editor,f=c.parents().filter(function(b,c){return!/^(html|body)$/i.test(c.nodeName)&&a(c).css("position")=="relative"}),g=this.wz,h=this._class,i=c.hasClass(h),j=this.rte,k=this.rte.selection,l=a.browser.mozilla,m,n;o(),f.css("position",i?"relative":"static"),i?(c.removeClass(h),g.height(this.height),b.unbind("resize",e),this.domElem.removeClass("active")):(c.addClass(h).removeAttr("style"),g.height(b.height()-this.delta).css("width","100%"),b.bind("resize",e),this.domElem.addClass("active")),j.updateHeight(),j.resizable(i),p()},this.update=function(){this.domElem.removeClass("disabled")}}}(jQuery),function(a){elRTE.prototype.ui.prototype.buttons.horizontalrule=function(b,c){this.constructor.prototype.constructor.call(this,b,c);var d=this;this.src={width:a('<input type="text" />').attr({name:"width",size:4}).css("text-align","right"),wunit:a("<select />").attr("name","wunit").append(a("<option />").val("%").text("%")).append(a("<option />").val("px").text("px")).val("%"),height:a('<input type="text" />').attr({name:"height",size:4}).css("text-align","right"),bg:a("<div />"),border:a("<div />"),"class":a('<input type="text" />').css("width","100%"),style:a('<input type="text" />').css("width","100%")},this.command=function(){this.src.bg.elColorPicker({palettePosition:"outer","class":"el-colorpicker ui-icon ui-icon-pencil"});var c=this.rte.selection.getEnd();this.hr=c.nodeName=="HR"?a(c):a(b.doc.createElement("hr")).css({width:"100%",height:"1px"}),this.src.border.elBorderSelect({styleHeight:73,value:this.hr});var e=this.hr.css("width")||this.hr.attr("width");this.src.width.val(parseInt(e)||100),this.src.wunit.val(e.indexOf("px")!=-1?"px":"%"),this.src.height.val(this.rte.utils.toPixels(this.hr.css("height")||this.hr.attr("height"))||1),this.src.bg.val(this.rte.utils.color2Hex(this.hr.css("background-color"))),this.src["class"].val(this.rte.dom.attr(this.hr,"class")),this.src.style.val(this.rte.dom.attr(this.hr,"style"));var f={rte:this.rte,rtl:this.rte.rtl,submit:function(a,b){a.stopPropagation(),a.preventDefault(),d.set(),b.close()},dialog:{title:this.rte.i18n("Horizontal rule")}},g=new elDialogForm(f);g.append([this.rte.i18n("Width"),a("<span />").append(this.src.width).append(this.src.wunit)],null,!0).append([this.rte.i18n("Height"),a("<span />").append(this.src.height).append(" px")],null,!0).append([this.rte.i18n("Border"),this.src.border],null,!0).append([this.rte.i18n("Background"),this.src.bg],null,!0).append([this.rte.i18n("Css class"),this.src["class"]],null,!0).append([this.rte.i18n("Css style"),this.src.style],null,!0).open()},this.update=function(){this.domElem.removeClass("disabled"),this.rte.selection.getEnd().nodeName=="HR"?this.domElem.addClass("active"):this.domElem.removeClass("active")},this.set=function(){this.rte.history.add(),!this.hr.parentNode&&this.rte.selection.insertNode(this.hr.get(0));var a={noshade:!0,style:this.src.style.val()},b=this.src.border.val(),c={width:(parseInt(this.src.width.val())||100)+this.src.wunit.val(),height:parseInt(this.src.height.val())||1,"background-color":this.src.bg.val(),border:b.width&&b.style?b.width+" "+b.style+" "+b.color:""};this.hr.removeAttr("class").removeAttr("style").removeAttr("width").removeAttr("height").removeAttr("align").attr(a).css(c),this.src["class"].val()&&this.hr.attr("class",this.src["class"].val()),this.rte.ui.update()}}}(jQuery),function(a){elRTE.prototype.ui.prototype.buttons.image=function(b,c){this.constructor.prototype.constructor.call(this,b,c);var d=this,b=d.rte,e=0,f=0,g=0,h=null,i=function(b){a.each(d.src,function(c,d){a.each(d,function(a,c){if(a=="src"&&b)return;c.val("")})})},j=function(c){a.each(d.src,function(d,e){a.each(e,function(a,e){var f,g,h,i,j;a=="width"?f=c.width():a=="height"?f=c.height():a=="border"?(f="",j=c.css("border")||b.utils.parseStyle(c.attr("style")).border||"",j&&(g=j.match(/(\d(px|em|%))/),h=j.match(/(#[a-z0-9]+)/),f={width:g?g[1]:j,style:j,color:b.utils.color2Hex(h?h[1]:j)})):a=="margin"?f=c:a=="align"?(f=c.css("float"),f!="left"&&f!="right"&&(f=c.css("vertical-align"))):f=c.attr(a)||"",d=="events"&&(f=b.utils.trimEventCallback(f)),e.val(f)})})},k=function(){var b=d.src.main.src.val();i(!0),b?(d.prevImg?(d.prevImg.removeAttr("src").removeAttr("style").removeAttr("class").removeAttr("id").removeAttr("title").removeAttr("alt").removeAttr("longdesc"),a.each(d.src.events,function(a,b){d.prevImg.removeAttr(a)})):d.prevImg=a("<img/>").prependTo(d.preview),d.prevImg.load(function(){d.prevImg.unbind("load"),setTimeout(function(){f=d.prevImg.width(),g=d.prevImg.height(),e=(f/g).toFixed(2),d.src.main.width.val(f),d.src.main.height.val(g)},100)}).attr("src",b)):(d.preview.children("img").remove(),d.prevImg=null)},l=function(a){var b=parseInt(d.src.main.width.val())||0,c=parseInt(d.src.main.height.val())||0;d.prevImg&&(b&&c?a.target===d.src.main.width[0]?c=parseInt(b/e):b=parseInt(c*e):(b=f,c=g),d.src.main.height.val(c),d.src.main.width.val(b),d.prevImg.width(b).height(c),d.src.adv.style.val(d.prevImg.attr("style")))};this.img=null,this.prevImg=null,this.preview=a('<div class="elrte-image-preview"/>').text("Proin elit arcu, rutrum commodo, vehicula tempus, commodo a, risus. Curabitur nec arcu. Donec sollicitudin mi sit amet mauris. Nam elementum quam ullamcorper ante. Etiam aliquet massa et lorem. Mauris dapibus lacus auctor risus. Aenean tempor ullamcorper leo. Vivamus sed magna quis ligula eleifend adipiscing. Duis orci. Aliquam sodales tortor vitae ipsum. Aliquam nulla. Duis aliquam molestie erat. Ut et mauris vel pede varius sollicitudin"),this.init=function(){this.labels={main:"Properies",link:"Link",adv:"Advanced",id:"ID","class":"Css class",style:"Css style",longdesc:"Detail description URL",href:"URL",target:"Open in",title:"Title"},this.src={main:{src:a('<input type="text" />').css("width","100%").change(k),title:a('<input type="text" />').css("width","100%"),alt:a('<input type="text" />').css("width","100%"),width:a('<input type="text" />').attr("size",5).css("text-align","right").change(l),height:a('<input type="text" />').attr("size",5).css("text-align","right").change(l),margin:a("<div />").elPaddingInput({type:"margin",change:function(){var a=d.src.main.margin.val();d.prevImg&&(a.css?d.prevImg.css("margin",a.css):d.prevImg.css({"margin-left":a.left,"margin-top":a.top,"margin-right":a.right,"margin-bottom":a.bottom}))}}),align:a("<select />").css("width","100%").append(a("<option />").val("").text(this.rte.i18n("Not set","dialogs"))).append(a("<option />").val("left").text(this.rte.i18n("Left"))).append(a("<option />").val("right").text(this.rte.i18n("Right"))).append(a("<option />").val("top").text(this.rte.i18n("Top"))).append(a("<option />").val("text-top").text(this.rte.i18n("Text top"))).append(a("<option />").val("middle").text(this.rte.i18n("middle"))).append(a("<option />").val("baseline").text(this.rte.i18n("Baseline"))).append(a("<option />").val("bottom").text(this.rte.i18n("Bottom"))).append(a("<option />").val("text-bottom").text(this.rte.i18n("Text bottom"))).change(function(){var b=a(this).val(),c={"float":"","vertical-align":""};d.prevImg&&(b=="left"||b=="right"?(c["float"]=b,c["vertical-align"]=""):b&&(c["float"]="",c["vertical-align"]=b),d.prevImg.css(c))}),border:a("<div />").elBorderSelect({name:"border",change:function(){var a=d.src.main.border.val();d.prevImg&&d.prevImg.css("border",a.width?a.width+" "+a.style+" "+a.color:"")}})},adv:{},events:{}},a.each(["id","class","style","longdesc"],function(b,c){d.src.adv[c]=a('<input type="text" style="width:100%" />')}),this.src.adv["class"].change(function(){d.prevImg&&d.prevImg.attr("class",a(this).val())}),this.src.adv.style.change(function(){d.prevImg&&(d.prevImg.attr("style",a(this).val()),j(d.prevImg))})},this.command=function(){!this.src&&this.init();var c,k={rte:this.rte,rtl:b.rtl,submit:function(a,b){a.stopPropagation(),a.preventDefault(),d.set(),l.close()},close:function(){h&&b.selection.moveToBookmark(h)},dialog:{autoOpen:!1,width:500,position:"top",title:b.i18n("Image"),resizable:!0,open:function(){a.fn.resizable&&a(this).parents(".ui-dialog:first").resizable("option","alsoResize",".elrte-image-preview")}}},l=new elDialogForm(k),m=!!b.options.fmOpen,n=m?a('<div class="elrte-image-src-fm"><span class="ui-state-default ui-corner-all"><span class="ui-icon ui-icon-folder-open"/></span></div>').append(this.src.main.src.css("width","87%")):this.src.main.src;i(),this.preview.children("img").remove(),this.prevImg=null,c=b.selection.getEnd(),this.img=c.nodeName=="IMG"&&!a(c).is(".elrte-protected")?a(c):a("<img/>"),h=b.selection.getBookmark(),m&&n.children(".ui-state-default").click(function(){b.options.fmOpen(function(a){d.src.main.src.val(a).change()})}).hover(function(){a(this).toggleClass("ui-state-hover")}),l.tab("main",this.rte.i18n("Properies")).append([this.rte.i18n("Image URL"),n],"main",!0).append([this.rte.i18n("Title"),this.src.main.title],"main",!0).append([this.rte.i18n("Alt text"),this.src.main.alt],"main",!0).append([this.rte.i18n("Size"),a("<span />").append(this.src.main.width).append(" x ").append(this.src.main.height).append(" px")],"main",!0).append([this.rte.i18n("Alignment"),this.src.main.align],"main",!0).append([this.rte.i18n("Margins"),this.src.main.margin],"main",!0).append([this.rte.i18n("Border"),this.src.main.border],"main",!0),l.append(a("<fieldset><legend>"+this.rte.i18n("Preview")+"</legend></fieldset>").append(this.preview),"main"),a.each(this.src,function(c,e){if(c=="main")return;l.tab(c,b.i18n(d.labels[c])),a.each(e,function(a,e){d.src[c][a].val(c=="events"?b.utils.trimEventCallback(d.img.attr(a)):d.img.attr(a)||""),l.append([b.i18n(d.labels[a]||a),d.src[c][a]],c,!0)})}),l.open(),this.img.attr("src")&&(j(this.img),this.prevImg=this.img.clone().prependTo(this.preview),e=(this.img.width()/this.img.height()).toFixed(2),f=parseInt(this.img.width()),g=parseInt(this.img.height()))},this.set=function(){var c=this.src.main.src.val(),e;this.rte.history.add(),h&&b.selection.moveToBookmark(h);if(!c)return e=b.dom.selfOrParentLink(this.img[0]),e&&e.remove(),this.img.remove();!this.img[0].parentNode&&(this.img=a(this.rte.doc.createElement("img"))),this.img.attr("src",c).attr("style",this.src.adv.style.val()),a.each(this.src,function(b,c){a.each(c,function(b,c){var e=c.val(),f;switch(b){case"width":d.img.css("width",e);break;case"height":d.img.css("height",e);break;case"align":d.img.css(e=="left"||e=="right"?"float":"vertical-align",e);break;case"margin":e.css?d.img.css("margin",e.css):d.img.css({"margin-left":e.left,"margin-top":e.top,"margin-right":e.right,"margin-bottom":e.bottom});break;case"border":if(!e.width)e="";else{e="border:"+e.css+";"+a.trim((d.img.attr("style")||"").replace(/border\-[^;]+;?/ig,"")),b="style",d.img.attr("style",e);return}break;case"src":case"style":return;default:e?d.img.attr(b,e):d.img.removeAttr(b)}})}),!this.img[0].parentNode&&b.selection.insertNode(this.img[0]),this.rte.ui.update()},this.update=function(){this.domElem.removeClass("disabled");var b=this.rte.selection.getEnd(),c=a(b);b&&b.nodeName=="IMG"&&!c.hasClass("elrte-protected")?this.domElem.addClass("active"):this.domElem.removeClass("active")}}}(jQuery),function(a){elRTE.prototype.ui.prototype.buttons.indent=function(b,c){this.constructor.prototype.constructor.call(this,b,c);var d=this;this.command=function(){function c(b){var c=/(IMG|HR|TABLE|EMBED|OBJECT)/.test(b.nodeName)?"margin-left":"padding-left",e=d.rte.dom.attr(b,"style").indexOf(c)!=-1?parseInt(a(b).css(c))||0:0;a(b).css(c,e+40+"px")}this.rte.history.add();var b=this.rte.selection.selected({collapsed:!0,blocks:!0,wrap:"inline",tag:"p"});for(var e=0;e<b.length;e++)if(/^(TABLE|THEAD|TFOOT|TBODY|COL|COLGROUP|TR)$/.test(b[e].nodeName))a(b[e]).find("td,th").each(function(){c(this)});else if(/^LI$/.test(b[e].nodeName)){var f=a(b[e]);a(this.rte.dom.create(b[e].parentNode.nodeName)).append(a(this.rte.dom.create("li")).html(f.html()||"")).appendTo(f.html("&nbsp;"))}else c(b[e]);this.rte.ui.update()},this.update=function(){this.domElem.removeClass("disabled")}}}(jQuery),function(a){elRTE.prototype.ui.prototype.buttons.justifyleft=function(b,c){this.constructor.prototype.constructor.call(this,b,c),this.align=this.name=="justifyfull"?"justify":this.name.replace("justify",""),this.command=function(){var b=this.rte.selection.selected({collapsed:!0,blocks:!0,tag:"div"}),c=b.length;c&&this.rte.history.add();while(c--)this.rte.dom.filter(b[c],"textNodes")&&a(b[c]).css("text-align",this.align);this.rte.ui.update()},this.update=function(){var b=this.rte.selection.getNode(),c=b.nodeName=="BODY"?b:this.rte.dom.selfOrParent(b,"textNodes")||(b.parentNode&&b.parentNode.nodeName=="BODY"?b.parentNode:null);c?this.domElem.removeClass("disabled").toggleClass("active",a(c).css("text-align")==this.align):this.domElem.addClass("disabled")}},elRTE.prototype.ui.prototype.buttons.justifycenter=elRTE.prototype.ui.prototype.buttons.justifyleft,elRTE.prototype.ui.prototype.buttons.justifyright=elRTE.prototype.ui.prototype.buttons.justifyleft,elRTE.prototype.ui.prototype.buttons.justifyfull=elRTE.prototype.ui.prototype.buttons.justifyleft}(jQuery),function(a){elRTE.prototype.ui.prototype.buttons.link=function(b,c){function f(){e.labels={id:"ID","class":"Css class",style:"Css style",dir:"Script direction",lang:"Language",charset:"Charset",type:"Target MIME type",rel:"Relationship page to target (rel)",rev:"Relationship target to page (rev)",tabindex:"Tab index",accesskey:"Access key"},e.src={main:{href:a('<input type="text" />'),title:a('<input type="text" />'),anchor:a("<select />").attr("name","anchor"),target:a("<select />").append(a("<option />").text(e.rte.i18n("In this window")).val("")).append(a("<option />").text(e.rte.i18n("In new window (_blank)")).val("_blank"))},popup:{use:a('<input type="checkbox" />'),url:a('<input type="text" />').val("http://"),name:a('<input type="text" />'),width:a('<input type="text" />').attr({size:6,title:e.rte.i18n("Width")}).css("text-align","right"),height:a('<input type="text" />').attr({size:6,title:e.rte.i18n("Height")}).css("text-align","right"),left:a('<input type="text" />').attr({size:6,title:e.rte.i18n("Left")}).css("text-align","right"),top:a('<input type="text" />').attr({size:6,title:e.rte.i18n("Top")}).css("text-align","right"),location:a('<input type="checkbox" />'),menubar:a('<input type="checkbox" />'),toolbar:a('<input type="checkbox" />'),scrollbars:a('<input type="checkbox" />'),status:a('<input type="checkbox" />'),resizable:a('<input type="checkbox" />'),dependent:a('<input type="checkbox" />'),retfalse:a('<input type="checkbox" />').attr("checked",!0)},adv:{id:a('<input type="text" />'),"class":a('<input type="text" />'),style:a('<input type="text" />'),dir:a("<select />").append(a("<option />").text(e.rte.i18n("Not set")).val("")).append(a("<option />").text(e.rte.i18n("Left to right")).val("ltr")).append(a("<option />").text(e.rte.i18n("Right to left")).val("rtl")),lang:a('<input type="text" />'),charset:a('<input type="text" />'),type:a('<input type="text" />'),rel:a('<input type="text" />'),rev:a('<input type="text" />'),tabindex:a('<input type="text" />'),accesskey:a('<input type="text" />')},events:{}},a.each(e.src,function(){for(var a in this){var b=this[a].attr("type");(!b||b=="text"&&!this[a].attr("size"))&&this[a].css("width","100%")}})}this.constructor.prototype.constructor.call(this,b,c);var e=this;this.img=!1,this.bm,this.command=function(){function o(a){return a.nodeName=="A"&&a.href}var b=this.rte.selection.getNode(),c,g,h,i,j,k,l,m,n;!this.src&&f(),this.bm=this.rte.selection.getBookmark(),this.link=this.rte.dom.selfOrParentLink(b);if(!this.link){c=a.browser.msie?this.rte.selection.selected():this.rte.selection.selected({wrap:!1});if(c.length){for(g=0;g<c.length;g++)if(o(c[g])){this.link=c[g];break}this.link||(this.link=this.rte.dom.parent(c[0],o)||this.rte.dom.parent(c[c.length-1],o))}}this.link=this.link?a(this.link):a(this.rte.doc.createElement("a")),this.img=b.nodeName=="IMG"?b:null,this.updatePopup(),this.src.main.anchor.empty(),a('a[href!=""][name]',this.rte.doc).each(function(){var b=a(this).attr("name");e.src.main.anchor.append(a("<option />").val(b).text(b))}),this.src.main.anchor.children().length&&this.src.main.anchor.prepend(a("<option />").val("").text(this.rte.i18n("Select bookmark"))).change(function(){var b=a(this).val();b&&e.src.main.href.val("#"+b)}),i={rte:this.rte,rtl:this.rte.rtl,submit:function(a,b){a.stopPropagation(),a.preventDefault(),e.set(),b.close()},tabs:{show:function(a,b){b.index==3&&e.updateOnclick()}},close:function(){e.rte.browser.msie&&e.rte.selection.restoreIERange()},dialog:{width:"auto",width:430,title:this.rte.i18n("Link")}},d=new elDialogForm(i),j=a("<div />").append(a("<label />").append(this.src.popup.location).append(this.rte.i18n("Location bar"))).append(a("<label />").append(this.src.popup.menubar).append(this.rte.i18n("Menu bar"))).append(a("<label />").append(this.src.popup.toolbar).append(this.rte.i18n("Toolbar"))).append(a("<label />").append(this.src.popup.scrollbars).append(this.rte.i18n("Scrollbars"))),k=a("<div />").append(a("<label />").append(this.src.popup.status).append(this.rte.i18n("Status bar"))).append(a("<label />").append(this.src.popup.resizable).append(this.rte.i18n("Resizable"))).append(a("<label />").append(this.src.popup.dependent).append(this.rte.i18n("Depedent"))).append(a("<label />").append(this.src.popup.retfalse).append(this.rte.i18n("Add return false"))),d.tab("main",this.rte.i18n("Properies")).tab("adv",this.rte.i18n("Advanced")),l=this.link.get(0),m=this.rte.dom.attr(l,"href"),this.src.main.href.val(m).change(function(){a(this).val(e.rte.utils.absoluteURL(a(this).val()))});if(this.rte.options.fmAllow&&this.rte.options.fmOpen){var n=a("<span />").append(this.src.main.href.css("width","87%")).append(a("<span />").addClass("ui-state-default ui-corner-all").css({"float":"right","margin-right":"3px"}).attr("title",e.rte.i18n("Open file manger")).append(a("<span />").addClass("ui-icon ui-icon-folder-open")).click(function(){e.rte.options.fmOpen(function(a){e.src.main.href.val(a).change()})}).hover(function(){a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")}));d.append([this.rte.i18n("Link URL"),n],"main",!0)}else d.append([this.rte.i18n("Link URL"),this.src.main.href],"main",!0);this.src.main.href.change(),d.append([this.rte.i18n("Title"),this.src.main.title.val(this.rte.dom.attr(l,"title"))],"main",!0),this.src.main.anchor.children().length&&d.append([this.rte.i18n("Bookmark"),this.src.main.anchor.val(m)],"main",!0),(!this.rte.options.doctype.match(/xhtml/)||!this.rte.options.doctype.match(/strict/))&&d.append([this.rte.i18n("Target"),this.src.main.target.val(this.link.attr("target")||"")],"main",!0);for(var b in this.src.adv)this.src.adv[b].val(this.rte.dom.attr(l,b)),d.append([this.rte.i18n(this.labels[b]?this.labels[b]:b),this.src.adv[b]],"adv",!0);for(var b in this.src.events){var h=this.rte.utils.trimEventCallback(this.rte.dom.attr(l,b));this.src.events[b].val(h),d.append([this.rte.i18n(this.labels[b]?this.labels[b]:b),this.src.events[b]],"events",!0)}this.src.popup.use.change(function(){var b=a(this).attr("checked");a.each(e.src.popup,function(){a(this).attr("name")!="use"&&(b?a(this).removeAttr("disabled"):a(this).attr("disabled",!0))})}),this.src.popup.use.change(),d.open()},this.update=function(){var a=this.rte.selection.getNode();this.rte.dom.selfOrParentLink(a)?this.domElem.removeClass("disabled").addClass("active"):this.rte.dom.selectionHas(function(a){return a.nodeName=="A"&&a.href})?this.domElem.removeClass("disabled").addClass("active"):!this.rte.selection.collapsed()||a.nodeName=="IMG"?this.domElem.removeClass("disabled active"):this.domElem.addClass("disabled").removeClass("active")},this.updatePopup=function(){var b=""+this.link.attr("onclick");b.length>0&&(m=b.match(/window.open\('([^']+)',\s*'([^']*)',\s*'([^']*)'\s*.*\);\s*(return\s+false)?/))?(this.src.popup.use.attr("checked","on"),this.src.popup.url.val(m[1]),this.src.popup.name.val(m[2]),/location=yes/.test(m[3])&&this.src.popup.location.attr("checked",!0),/menubar=yes/.test(m[3])&&this.src.popup.menubar.attr("checked",!0),/toolbar=yes/.test(m[3])&&this.src.popup.toolbar.attr("checked",!0),/scrollbars=yes/.test(m[3])&&this.src.popup.scrollbars.attr("checked",!0),/status=yes/.test(m[3])&&this.src.popup.status.attr("checked",!0),/resizable=yes/.test(m[3])&&this.src.popup.resizable.attr("checked",!0),/dependent=yes/.test(m[3])&&this.src.popup.dependent.attr("checked",!0),(_m=m[3].match(/width=([^,]+)/))&&this.src.popup.width.val(_m[1]),(_m=m[3].match(/height=([^,]+)/))&&this.src.popup.height.val(_m[1]),(_m=m[3].match(/left=([^,]+)/))&&this.src.popup.left.val(_m[1]),(_m=m[3].match(/top=([^,]+)/))&&this.src.popup.top.val(_m[1]),m[4]&&this.src.popup.retfalse.attr("checked",!0)):a.each(this.src.popup,function(){var b=a(this);b.attr("type")=="text"?b.val(b.attr("name")=="url"?"http://":""):b.attr("name")=="retfalse"?this.attr("checked",!0):b.removeAttr("checked")})},this.updateOnclick=function(){var b=this.src.popup.url.val();if(this.src.popup.use.attr("checked")&&b){var c="";this.src.popup.location.attr("checked")&&(c+="location=yes,"),this.src.popup.menubar.attr("checked")&&(c+="menubar=yes,"),this.src.popup.toolbar.attr("checked")&&(c+="toolbar=yes,"),this.src.popup.scrollbars.attr("checked")&&(c+="scrollbars=yes,"),this.src.popup.status.attr("checked")&&(c+="status=yes,"),this.src.popup.resizable.attr("checked")&&(c+="resizable=yes,"),this.src.popup.dependent.attr("checked")&&(c+="dependent=yes,"),this.src.popup.width.val()&&(c+="width="+this.src.popup.width.val()+","),this.src.popup.height.val()&&(c+="height="+this.src.popup.height.val()+","),this.src.popup.left.val()&&(c+="left="+this.src.popup.left.val()+","),this.src.popup.top.val()&&(c+="top="+this.src.popup.top.val()+","),c.length>0&&(c=c.substring(0,c.length-1));var d=this.src.popup.retfalse.attr("checked")?"return false;":"",e="window.open('"+b+"', '"+a.trim(this.src.popup.name.val())+"', '"+c+"'); "+d;this.src.events.onclick&&this.src.events.onclick.val(e),this.src.main.href.val()||this.src.main.href.val("#")}else if(this.src.events.onclick){var f=this.src.events.onclick.val();f=f.replace(/window\.open\([^\)]+\)\s*;?\s*return\s*false\s*;?/i,""),this.src.events.onclick.val(f)}},this.set=function(){var b,c;this.updateOnclick(),this.rte.selection.moveToBookmark(this.bm),this.rte.history.add(),b=this.rte.utils.absoluteURL(this.src.main.href.val());if(!b){var d=this.rte.selection.getBookmark();this.rte.dom.unwrap(this.link[0]),this.rte.selection.moveToBookmark(d)}else{this.img&&this.img.parentNode?(this.link=a(this.rte.dom.create("a")).attr("href",b),this.rte.dom.wrap(this.img,this.link[0])):this.link[0].parentNode||(c="#--el-editor---"+Math.random(),this.rte.doc.execCommand("createLink",!1,c),this.link=a('a[href="'+c+'"]',this.rte.doc),this.link.each(function(){var b=a(this);!a.trim(b.html())&&!a.trim(b.text())&&b.replaceWith(b.text())})),this.src.main.href.val(b);for(var e in this.src)if(e!="popup")for(var f in this.src[e])if(f!="anchors"){var g=a.trim(this.src[e][f].val());g?this.link.attr(f,g):this.link.removeAttr(f)}this.img&&this.rte.selection.select(this.img)}this.rte.ui.update(!0)}}}(jQuery),function(a){elRTE.prototype.ui.prototype.buttons.nbsp=function(a,b){this.constructor.prototype.constructor.call(this,a,b),this.command=function(){this.rte.history.add(),this.rte.selection.insertHtml("&nbsp;",!0),this.rte.window.focus(),this.rte.ui.update()},this.update=function(){this.domElem.removeClass("disabled")}}}(jQuery),function(a){elRTE.prototype.ui.prototype.buttons.outdent=function(b,c){this.constructor.prototype.constructor.call(this,b,c);var d=this;this.command=function(){var b=this.find();b.node&&(this.rte.history.add(),a(b.node).css(b.type,(b.val>40?b.val-40:0)+"px"),this.rte.ui.update())},this.find=function(b){function c(b){var c={type:"",val:0},e;if(e=d.rte.dom.attr(b,"style"))c.type=e.indexOf("padding-left")!=-1?"padding-left":e.indexOf("margin-left")!=-1?"margin-left":"",c.val=c.type?parseInt(a(b).css(c.type))||0:0;return c}var b=this.rte.selection.getNode(),e=c(b);return e.val?e.node=b:a.each(this.rte.dom.parents(b,"*"),function(){e=c(this);if(e.val)return e.node=this,e}),e},this.update=function(){var a=this.find();a.node?this.domElem.removeClass("disabled"):this.domElem.addClass("disabled")}}}(jQuery),function(a){elRTE.prototype.ui.prototype.buttons.pagebreak=function(b,c){this.constructor.prototype.constructor.call(this,b,c),a(this.rte.doc.body).bind("mousedown",function(b){a(b.target).hasClass("elrte-pagebreak")&&b.preventDefault()}),this.command=function(){this.rte.selection.insertHtml('<img src="'+this.rte.filter.url+'pixel.gif" class="elrte-protected elrte-pagebreak"/>',!1)},this.update=function(){this.domElem.removeClass("disabled")}}}(jQuery),function(a){elRTE.prototype.ui.prototype.buttons.pasteformattext=function(b,c){this.constructor.prototype.constructor.call(this,b,c),this.iframe=a(document.createElement("iframe")).addClass("el-rte-paste-input"),this.doc=null;var d=this;this.command=function(){this.rte.selection.saveIERange();var a=this,b={rte:this.rte,submit:function(b,c){b.stopPropagation(),b.preventDefault(),a.paste(),c.close()},dialog:{width:500,title:this.rte.i18n("Paste formatted text")}},c=new elDialogForm(b);c.append(this.iframe).open(),this.doc=this.iframe.get(0).contentWindow.document,html=this.rte.options.doctype+'<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />',html+="</head><body> <br /> </body></html>",this.doc.open(),this.doc.write(html),this.doc.close();if(!this.rte.browser.msie)try{this.doc.designMode="on"}catch(d){}else this.doc.body.contentEditable=!0;setTimeout(function(){a.iframe[0].contentWindow.focus()},50)},this.paste=function(){a(this.doc.body).find("[class]").removeAttr("class");var b=a.trim(a(this.doc.body).html());b&&(this.rte.history.add(),this.rte.selection.restoreIERange(),this.rte.selection.insertHtml(this.rte.filter.wysiwyg2wysiwyg(this.rte.filter.proccess("paste",b))),this.rte.ui.update(!0))},this.update=function(){this.domElem.removeClass("disabled")}}}(jQuery),function(a
){elRTE.prototype.ui.prototype.buttons.pastetext=function(b,c){this.constructor.prototype.constructor.call(this,b,c),this.input=a("<textarea />").addClass("el-rte-paste-input");var d=this;this.command=function(){this.rte.browser.msie&&this.rte.selection.saveIERange();var a={rte:this.rte,submit:function(a,b){a.stopPropagation(),a.preventDefault(),d.paste(),b.close()},dialog:{width:500,title:this.rte.i18n("Paste only text")}},b=new elDialogForm(a);b.append(this.input).open()},this.paste=function(){var b=a.trim(this.input.val());b&&(this.rte.history.add(),this.rte.browser.msie&&this.rte.selection.restoreIERange(),this.rte.selection.insertText(b.replace(/\r?\n/g,"<br />"),!0),this.rte.ui.update(!0)),this.input.val("")},this.update=function(){this.domElem.removeClass("disabled")}}}(jQuery),function(a){elRTE.prototype.ui.prototype.buttons.save=function(a,b){this.constructor.prototype.constructor.call(this,a,b),this.active=!0,this.command=function(){this.rte.save()},this.update=function(){}}}(jQuery),function(a){elRTE.prototype.ui.prototype.buttons.smiley=function(b,c){this.constructor.prototype.constructor.call(this,b,c);var d=this;this.img=null,this.url=this.rte.filter.url+"smileys/",this.smileys={smile:"smile.png",happy:"happy.png",tongue:"tongue.png",surprised:"surprised.png",waii:"waii.png",wink:"wink.png",evilgrin:"evilgrin.png",grin:"grin.png",unhappy:"unhappy.png"},this.width=120,this.command=function(){var b=this,c=this.url,d,e,f;this.rte.browser.msie&&this.rte.selection.saveIERange(),e={rte:this.rte,dialog:{height:120,width:this.width,title:this.rte.i18n("Smiley"),buttons:{}}},d=new elDialogForm(e),a.each(this.smileys,function(e,f){d.append(a('<img src="'+c+f+'" title="'+e+'" id="'+e+'" class="el-rte-smiley"/>').click(function(){b.set(this.id,d)}))}),d.open()},this.update=function(){this.domElem.removeClass("disabled"),this.domElem.removeClass("active")},this.set=function(b,c){this.rte.browser.msie&&this.rte.selection.restoreIERange(),this.smileys[b]&&(this.img=a(this.rte.doc.createElement("img")),this.img.attr({src:this.url+this.smileys[b],title:b,alt:b}),this.rte.selection.insertNode(this.img.get(0)),this.rte.ui.update()),c.close()}}}(jQuery),function(a){elRTE.prototype.ui.prototype.buttons.stopfloat=function(b,c){this.constructor.prototype.constructor.call(this,b,c),this.find=function(){if(this.rte.selection.collapsed()){var b=this.rte.dom.selfOrParent(this.rte.selection.getEnd(),/^DIV$/);if(b&&(this.rte.dom.attr(b,"clear")||a(b).css("clear")!="none"))return b}},this.command=function(){var b;if(b=this.find()){var b=a(b);this.rte.history.add(),!b.children().length&&!a.trim(b.text()).length?b.remove():b.removeAttr("clear").css("clear","")}else this.rte.history.add(),this.rte.selection.insertNode(a(this.rte.dom.create("div")).css("clear","both").get(0),!0);this.rte.ui.update(!0)},this.update=function(){this.domElem.removeClass("disabled"),this.find()?this.domElem.addClass("active"):this.domElem.removeClass("active")}}}(jQuery),function(a){elRTE.prototype.ui.prototype.buttons.table=function(b,c){function e(){d.labels={main:"Properies",adv:"Advanced",id:"ID","class":"Css class",style:"Css style",dir:"Script direction",summary:"Summary",lang:"Language",href:"URL"},d.src={main:{caption:a('<input type="text" />'),rows:a('<input type="text" />').attr("size",5).val(2),cols:a('<input type="text" />').attr("size",5).val(2),width:a('<input type="text" />').attr("size",5),wunit:a("<select />").append(a("<option />").val("%").text("%")).append(a("<option />").val("px").text("px")),height:a('<input type="text" />').attr("size",5),hunit:a("<select />").append(a("<option />").val("%").text("%")).append(a("<option />").val("px").text("px")),align:a("<select />").append(a("<option />").val("").text(d.rte.i18n("Not set"))).append(a("<option />").val("left").text(d.rte.i18n("Left"))).append(a("<option />").val("center").text(d.rte.i18n("Center"))).append(a("<option />").val("right").text(d.rte.i18n("Right"))),spacing:a('<input type="text" />').attr("size",5),padding:a('<input type="text" />').attr("size",5),border:a("<div />"),rules:a("<select />").append(a("<option />").val("none").text(d.rte.i18n("No"))).append(a("<option />").val("all").text(d.rte.i18n("Cells"))).append(a("<option />").val("groups").text(d.rte.i18n("Groups"))).append(a("<option />").val("rows").text(d.rte.i18n("Rows"))).append(a("<option />").val("cols").text(d.rte.i18n("Columns"))),margin:a("<div />"),bg:a("<div />"),bgimg:a('<input type="text" />').css("width","90%")},adv:{id:a('<input type="text" />'),summary:a('<input type="text" />'),"class":a('<input type="text" />'),style:a('<input type="text" />'),dir:a("<select />").append(a("<option />").text(d.rte.i18n("Not set")).val("")).append(a("<option />").text(d.rte.i18n("Left to right")).val("ltr")).append(a("<option />").text(d.rte.i18n("Right to left")).val("rtl")),lang:a('<input type="text" />')},events:{}},a.each(d.src,function(){for(var a in this){this[a].attr("name",a);var b=this[a].get(0).nodeName;b=="INPUT"&&a!="bgimg"?this[a].css(this[a].attr("size")?{"text-align":"right"}:{width:"100%"}):b=="SELECT"&&a!="wunit"&&a!="hunit"&&this[a].css("width","100%")}}),d.src.main.align.change(function(){var b=a(this).val();if(b=="center")d.src.main.margin.val({left:"auto",right:"auto"});else{var c=d.src.main.margin.val();c.left=="auto"&&c.right=="auto"&&d.src.main.margin.val({left:"",right:""})}}),d.src.main.bgimg.change(function(){var b=a(this);b.val(d.rte.utils.absoluteURL(b.val()))})}this.constructor.prototype.constructor.call(this,b,c);var d=this;this.src=null,this.labels=null,this.command=function(){var b=this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^TABLE$/);this.name=="table"?this.table=a(this.rte.doc.createElement("table")):this.table=b?a(b):a(this.rte.doc.createElement("table")),!this.src&&e(),this.src.main.border.elBorderSelect({styleHeight:117}),this.src.main.bg.elColorPicker({palettePosition:"outer","class":"el-colorpicker ui-icon ui-icon-pencil"}),this.src.main.margin.elPaddingInput({type:"margin",value:this.table}),this.table.parents().length?(this.src.main.rows.val("").attr("disabled",!0),this.src.main.cols.val("").attr("disabled",!0)):(this.src.main.rows.val(2).removeAttr("disabled"),this.src.main.cols.val(2).removeAttr("disabled"));var c=this.table.css("width")||this.table.attr("width");this.src.main.width.val(parseInt(c)||""),this.src.main.wunit.val(c.indexOf("px")!=-1?"px":"%");var f=this.table.css("height")||this.table.attr("height");this.src.main.height.val(parseInt(f)||""),this.src.main.hunit.val(f&&f.indexOf("px")!=-1?"px":"%");var g=this.table.css("float");this.src.main.align.val("");if(g=="left"||g=="right")this.src.main.align.val(g);else{var h=this.table.css("margin-left"),i=this.table.css("margin-right");h=="auto"&&i=="auto"&&this.src.main.align.val("center")}this.src.main.border.val(this.table),this.src.main.rules.val(this.rte.dom.attr(this.table.get(0),"rules")),this.src.main.bg.val(this.table.css("background-color"));var j=(this.table.css("background-image")||"").replace(/url\(([^\)]+)\)/i,"$1");this.src.main.bgimg.val(j!="none"?j:"");var k={rte:this.rte,rtl:this.rte.rtl,submit:function(a,b){a.stopPropagation(),a.preventDefault(),d.set(),b.close()},dialog:{width:530,title:this.rte.i18n("Table")}},l=new elDialogForm(k);for(var m in this.src){l.tab(m,this.rte.i18n(this.labels[m]));if(m=="main"){var n=a("<table />").append(a("<tr />").append("<td>"+this.rte.i18n("Rows")+"</td>").append(a("<td />").append(this.src.main.rows))).append(a("<tr />").append("<td>"+this.rte.i18n("Columns")+"</td>").append(a("<td />").append(this.src.main.cols))),o=a("<table />").append(a("<tr />").append("<td>"+this.rte.i18n("Width")+"</td>").append(a("<td />").append(this.src.main.width).append(this.src.main.wunit))).append(a("<tr />").append("<td>"+this.rte.i18n("Height")+"</td>").append(a("<td />").append(this.src.main.height).append(this.src.main.hunit))),p=a("<table />").append(a("<tr />").append("<td>"+this.rte.i18n("Spacing")+"</td>").append(a("<td />").append(this.src.main.spacing.val(this.table.attr("cellspacing")||"")))).append(a("<tr />").append("<td>"+this.rte.i18n("Padding")+"</td>").append(a("<td />").append(this.src.main.padding.val(this.table.attr("cellpadding")||""))));l.append([this.rte.i18n("Caption"),this.src.main.caption.val(this.table.find("caption").eq(0).text()||"")],"main",!0).separator("main").append([n,o,p],"main",!0).separator("main").append([this.rte.i18n("Border"),this.src.main.border],"main",!0).append([this.rte.i18n("Inner borders"),this.src.main.rules],"main",!0).append([this.rte.i18n("Alignment"),this.src.main.align],"main",!0).append([this.rte.i18n("Margins"),this.src.main.margin],"main",!0).append([this.rte.i18n("Background"),a("<span />").append(a("<span />").css({"float":"left","margin-right":"3px"}).append(this.src.main.bg)).append(this.src.main.bgimg)],"main",!0)}else for(var q in this.src[m]){var r=this.rte.dom.attr(this.table,q);m=="events"&&(r=this.rte.utils.trimEventCallback(r)),l.append([this.rte.i18n(this.labels[q]?this.labels[q]:q),this.src[m][q].val(r)],m,!0)}}l.open()},this.set=function(){if(!this.table.parents().length){var b=parseInt(this.src.main.rows.val())||0,c=parseInt(this.src.main.cols.val())||0;if(b<=0||c<=0)return;this.rte.history.add();var d=a(this.rte.doc.createElement("tbody")).appendTo(this.table);for(var e=0;e<b;e++){var f="<tr>";for(var g=0;g<c;g++)f+="<td>&nbsp;</td>";d.append(f+"</tr>")}}else this.table.removeAttr("width").removeAttr("height").removeAttr("border").removeAttr("align").removeAttr("bordercolor").removeAttr("bgcolor").removeAttr("cellspacing").removeAttr("cellpadding").removeAttr("frame").removeAttr("rules").removeAttr("style");var h=a.trim(this.src.main.caption.val());h?(this.table.children("caption").length||this.table.prepend("<caption />"),this.table.children("caption").text(h)):this.table.children("caption").remove();for(var i in this.src)if(i!="main")for(var j in this.src[i]){var k=a.trim(this.src[i][j].val());k?this.table.attr(j,k):this.table.removeAttr(j)}var l,m,n;(l=parseInt(this.src.main.spacing.val()))&&l>=0&&this.table.attr("cellspacing",l),(m=parseInt(this.src.main.padding.val()))&&m>=0&&this.table.attr("cellpadding",m),(n=this.src.main.rules.val())&&this.table.attr("rules",n);var o=parseInt(this.src.main.width.val())||"",p=parseInt(this.src.main.height.val())||"",e=a.trim(this.src.main.bgimg.val()),d=this.src.main.border.val(),q=this.src.main.margin.val(),r=this.src.main.align.val();this.table.css({width:o?o+this.src.main.wunit.val():"",height:p?p+this.src.main.hunit.val():"",border:a.trim(d.width+" "+d.style+" "+d.color),"background-color":this.src.main.bg.val(),"background-image":e?"url("+e+")":""}),q.css?this.table.css("margin",q.css):this.table.css({"margin-top":q.top,"margin-right":q.right,"margin-bottom":q.bottom,"margin-left":q.left}),(r=="left"||r=="right")&&this.table.css("margin-left")!="auto"&&this.table.css("margin-right")!="auto"&&this.table.css("float",r),this.table.attr("style")||this.table.removeAttr("style"),this.table.parents().length||this.rte.selection.insertNode(this.table.get(0),!0),this.rte.ui.update()},this.update=function(){this.domElem.removeClass("disabled"),this.name=="tableprops"&&!this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^TABLE$/)&&this.domElem.addClass("disabled").removeClass("active")}},elRTE.prototype.ui.prototype.buttons.tableprops=elRTE.prototype.ui.prototype.buttons.table}(jQuery),function(a){elRTE.prototype.ui.prototype.buttons.tablerm=function(b,c){this.constructor.prototype.constructor.call(this,b,c),this.command=function(){var b=this.rte.dom.parent(this.rte.selection.getNode(),/^TABLE$/);b&&(this.rte.history.add(),a(b).remove()),this.rte.ui.update(!0)},this.update=function(){this.rte.dom.parent(this.rte.selection.getNode(),/^TABLE$/)?this.domElem.removeClass("disabled"):this.domElem.addClass("disabled")}}}(jQuery),function(a){elRTE.prototype.ui.prototype.buttons.tbcellprops=function(b,c){function e(){d.labels={main:"Properies",adv:"Advanced",id:"ID","class":"Css class",style:"Css style",dir:"Script direction",lang:"Language"},d.src={main:{type:a("<select />").css("width","100%").append(a("<option />").val("td").text(d.rte.i18n("Data"))).append(a("<option />").val("th").text(d.rte.i18n("Header"))),width:a('<input type="text" />').attr("size",4),wunit:a("<select />").append(a("<option />").val("%").text("%")).append(a("<option />").val("px").text("px")),height:a('<input type="text" />').attr("size",4),hunit:a("<select />").append(a("<option />").val("%").text("%")).append(a("<option />").val("px").text("px")),align:a("<select />").css("width","100%").append(a("<option />").val("").text(d.rte.i18n("Not set"))).append(a("<option />").val("left").text(d.rte.i18n("Left"))).append(a("<option />").val("center").text(d.rte.i18n("Center"))).append(a("<option />").val("right").text(d.rte.i18n("Right"))).append(a("<option />").val("justify").text(d.rte.i18n("Justify"))),border:a("<div />"),padding:a("<div />"),bg:a("<div />"),bgimg:a('<input type="text" />').css("width","90%"),apply:a("<select />").css("width","100%").append(a("<option />").val("").text(d.rte.i18n("Current cell"))).append(a("<option />").val("row").text(d.rte.i18n("All cells in row"))).append(a("<option />").val("column").text(d.rte.i18n("All cells in column"))).append(a("<option />").val("table").text(d.rte.i18n("All cells in table")))},adv:{id:a('<input type="text" />'),"class":a('<input type="text" />'),style:a('<input type="text" />'),dir:a("<select />").css("width","100%").append(a("<option />").text(d.rte.i18n("Not set")).val("")).append(a("<option />").text(d.rte.i18n("Left to right")).val("ltr")).append(a("<option />").text(d.rte.i18n("Right to left")).val("rtl")),lang:a('<input type="text" />')},events:{}},a.each(d.src,function(){for(var a in this)this[a].attr("name",a),this[a].attr("type")=="text"&&!this[a].attr("size")&&a!="bgimg"&&this[a].css("width","100%")})}this.constructor.prototype.constructor.call(this,b,c);var d=this;this.src=null,this.labels=null,this.command=function(){!this.src&&e(),this.cell=this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^(TD|TH)$/);if(!this.cell)return;this.src.main.type.val(this.cell.nodeName.toLowerCase()),this.cell=a(this.cell),this.src.main.border.elBorderSelect({styleHeight:117,value:this.cell}),this.src.main.bg.elColorPicker({palettePosition:"outer","class":"el-colorpicker ui-icon ui-icon-pencil"}),this.src.main.padding.elPaddingInput({value:this.cell});var b=this.cell.css("width")||this.cell.attr("width");this.src.main.width.val(parseInt(b)||""),this.src.main.wunit.val(b.indexOf("px")!=-1?"px":"%");var c=this.cell.css("height")||this.cell.attr("height");this.src.main.height.val(parseInt(c)||""),this.src.main.hunit.val(c.indexOf("px")!=-1?"px":"%"),this.src.main.align.val(this.cell.attr("align")||this.cell.css("text-align")),this.src.main.bg.val(this.cell.css("background-color"));var f=this.cell.css("background-image");this.src.main.bgimg.val(f&&f!="none"?f.replace(/url\(([^\)]+)\)/i,"$1"):""),this.src.main.apply.val("");var g={rte:this.rte,rtl:this.rte.rtl,submit:function(a,b){a.stopPropagation(),a.preventDefault(),d.set(),b.close()},dialog:{width:520,title:this.rte.i18n("Table cell properties")}},h=new elDialogForm(g);for(var i in this.src){h.tab(i,this.rte.i18n(this.labels[i]));if(i=="main")h.append([this.rte.i18n("Width"),a("<span />").append(this.src.main.width).append(this.src.main.wunit)],"main",!0).append([this.rte.i18n("Height"),a("<span />").append(this.src.main.height).append(this.src.main.hunit)],"main",!0).append([this.rte.i18n("Table cell type"),this.src.main.type],"main",!0).append([this.rte.i18n("Border"),this.src.main.border],"main",!0).append([this.rte.i18n("Alignment"),this.src.main.align],"main",!0).append([this.rte.i18n("Paddings"),this.src.main.padding],"main",!0).append([this.rte.i18n("Background"),a("<span />").append(a("<span />").css({"float":"left","margin-right":"3px"}).append(this.src.main.bg)).append(this.src.main.bgimg)],"main",!0).append([this.rte.i18n("Apply to"),this.src.main.apply],"main",!0);else for(var j in this.src[i]){var k=this.cell.attr(j)||"";i=="events"&&(k=this.rte.utils.trimEventCallback(k)),h.append([this.rte.i18n(this.labels[j]?this.labels[j]:j),this.src[i][j].val(k)],i,!0)}}h.open()},this.set=function(){var b=this.cell,c=this.src.main.apply.val();switch(this.src.main.apply.val()){case"row":b=this.cell.parent("tr").children("td,th");break;case"column":b=a(this.rte.dom.tableColumn(this.cell.get(0)));break;case"table":b=this.cell.parents("table").find("td,th")}for(var e in this.src)if(e!="main")for(var f in this.src[e]){var g=a.trim(this.src[e][f].val());g?b.attr(f,g):b.removeAttr(f)}b.removeAttr("width").removeAttr("height").removeAttr("border").removeAttr("align").removeAttr("bordercolor").removeAttr("bgcolor");var h=this.src.main.type.val(),i=parseInt(this.src.main.width.val())||"",j=parseInt(this.src.main.height.val())||"",k=a.trim(this.src.main.bgimg.val()),l=this.src.main.border.val(),m={width:i?i+this.src.main.wunit.val():"",height:j?j+this.src.main.hunit.val():"","background-color":this.src.main.bg.val(),"background-image":k?"url("+k+")":"",border:a.trim(l.width+" "+l.style+" "+l.color),"text-align":this.src.main.align.val()||""},n=this.src.main.padding.val();n.css?m.padding=n.css:(m["padding-top"]=n.top,m["padding-right"]=n.right,m["padding-bottom"]=n.bottom,m["padding-left"]=n.left),b=b.get(),a.each(b,function(){var b=this.nodeName.toLowerCase(),c=a(this);if(b!=h){var e={};for(var f in d.src.adv){var g=c.attr(f);g&&(e[f]=g.toString())}for(var f in d.src.events){var g=c.attr(f);g&&(e[f]=g.toString())}var i=c.attr("colspan")||1,j=c.attr("rowspan")||1;i>1&&(e.colspan=i),j>1&&(e.rowspan=j),c.replaceWith(a("<"+h+" />").html(c.html()).attr(e).css(m))}else c.css(m)}),this.rte.ui.update()},this.update=function(){this.rte.dom.parent(this.rte.selection.getNode(),/^TABLE$/)?this.domElem.removeClass("disabled"):this.domElem.addClass("disabled")}}}(jQuery),function(a){elRTE.prototype.ui.prototype.buttons.tbcellsmerge=function(b,c){function e(){var b=d.rte.dom.selfOrParent(d.rte.selection.getStart(),/^(TD|TH)$/),c=d.rte.dom.selfOrParent(d.rte.selection.getEnd(),/^(TD|TH)$/);return b&&c&&b!=c&&a(b).parents("table").get(0)==a(c).parents("table").get(0)?[b,c]:null}this.constructor.prototype.constructor.call(this,b,c);var d=this;this.command=function(){var b=e();if(b){var c=this.rte.dom.indexOf(a(b[0]).parent("tr").get(0)),d=this.rte.dom.indexOf(a(b[1]).parent("tr").get(0)),f=Math.min(c,d),g=Math.max(c,d)-f+1,h=this.rte.dom.tableColumn(b[0],!0,!0),i=this.rte.dom.tableColumn(b[1],!0),j=a.inArray(b[0],h.column),k=a.inArray(b[1],i.column),l=h.info.offset[j]<i.info.offset[k]?h:i,m=h.info.offset[j]>=i.info.offset[k]?h:i,n=0,o=null,p="";this.rte.history.add();var q=a(a(b[0]).parents("table").eq(0).find("tr").get().slice(f,f+g)).each(function(b){var c=p.length,d=!1;a(this).children("td,th").each(function(){var c=a(this),e=a.inArray(this,l.column),f=a.inArray(this,m.column);if(e!=-1||f!=-1){d=e!=-1&&f==-1;var g=parseInt(c.attr("colspan")||1);b==0&&(n+=g);if(e!=-1&&b>0){var h=l.info.delta[e];if(h>0){if(c.css("text-align")=="left"){var i=c.clone(!0);c.html("&nbsp;")}else var i=c.clone().html("&nbsp;");i.removeAttr("colspan").removeAttr("id").insertBefore(this),h>1&&i.attr("colspan",h)}}if(f!=-1){var h=m.info.delta[f];if(g-h>1){var j=g-h-1;if(c.css("text-align")=="right"){var i=c.clone(!0);c.html("&nbsp;")}else var i=c.clone().html("&nbsp;");i.removeAttr("colspan").removeAttr("id").insertAfter(this),j>1&&i.attr("colspan",j)}}o?(p+=c.html(),c.remove()):o=c}else d&&(b==0&&(n+=parseInt(c.attr("colspan")||1)),p+=c.html(),c.remove())}),p+=c!=p.length?"<br />":""});o.removeAttr("colspan").removeAttr("rowspan").html(o.html()+p),n>1&&o.attr("colspan",n),g>1&&o.attr("rowspan",g),this.rte.dom.fixTable(a(b[0]).parents("table").get(0))}},this.update=function(){e()?this.domElem.removeClass("disabled"):this.domElem.addClass("disabled")}}}(jQuery),function(a){elRTE.prototype.ui.prototype.buttons.tbcellsplit=function(b,c){this.constructor.prototype.constructor.call(this,b,c),this.command=function(){var b=this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^(TD|TH)$/);if(b){this.rte.history.add();var c=parseInt(this.rte.dom.attr(b,"colspan")),d=parseInt(this.rte.dom.attr(b,"rowspan"));if(c>1||d>1){var e=c-1,f=d-1,g=this.rte.dom.parent(b,/^TABLE$/),h=this.rte.dom.tableMatrix(g);if(e)for(var i=0;i<e;i++)a(this.rte.dom.create(b.nodeName)).html("&nbsp;").insertAfter(b);if(f){var j=this.rte.dom.indexesOfCell(b,h),k=j[0],l=j[1];for(var m=k+1;m<k+f+1;m++){var n;if(!h[m][l].nodeName){if(h[m][l-1].nodeName)n=h[m][l-1];else for(var i=l-1;i>=0;i--)if(h[m][i].nodeName){n=h[m][i];break}if(n)for(var i=0;i<=e;i++)a(this.rte.dom.create(n.nodeName)).html("&nbsp;").insertAfter(n)}}}a(b).removeAttr("colspan").removeAttr("rowspan"),this.rte.dom.fixTable(g)}}this.rte.ui.update(!0)},this.update=function(){var a=this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^(TD|TH)$/);a&&(parseInt(this.rte.dom.attr(a,"colspan"))>1||parseInt(this.rte.dom.attr(a,"rowspan"))>1)?this.domElem.removeClass("disabled"):this.domElem.addClass("disabled")}}}(jQuery),function(a){elRTE.prototype.ui.prototype.buttons.tbcolbefore=function(b,c){this.constructor.prototype.constructor.call(this,b,c);var d=this;this.command=function(){var b=this,c=this.rte.dom.tableColumn(this.rte.selection.getNode(),!1,!0);c.length&&(this.rte.history.add(),a.each(c,function(){var c=a(this),d=parseInt(c.attr("colspan")||1);if(d>1)c.attr("colspan",d+1);else{var e=a(b.rte.dom.create(this.nodeName)).html("&nbsp;");b.name=="tbcolbefore"?e.insertBefore(this):e.insertAfter(this)}}),this.rte.ui.update())},this.update=function(){this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^(TD|TH)$/)?this.domElem.removeClass("disabled"):this.domElem.addClass("disabled")}},elRTE.prototype.ui.prototype.buttons.tbcolafter=elRTE.prototype.ui.prototype.buttons.tbcolbefore}(jQuery),function(a){elRTE.prototype.ui.prototype.buttons.tbcolrm=function(b,c){this.constructor.prototype.constructor.call(this,b,c);var d=this;this.command=function(){var b=this.rte.selection.getNode(),c=this.rte.dom.selfOrParent(b,/^(TD|TH)$/),d=a(c).prev("td,th").get(0),e=a(c).next("td,th").get(0),f=this.rte.dom.parent(b,/^TABLE$/),g=this.rte.dom.tableColumn(b,!1,!0);g.length&&(this.rte.history.add(),a.each(g,function(){var b=a(this),c=parseInt(b.attr("colspan")||1);c>1?b.attr("colspan",c-1):b.remove()}),this.rte.dom.fixTable(f),(d||e)&&this.rte.selection.selectContents(d?d:e).collapse(!0),this.rte.ui.update(!0))},this.update=function(){this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^(TD|TH)$/)?this.domElem.removeClass("disabled"):this.domElem.addClass("disabled")}}}(jQuery),elRTE.prototype.ui.prototype.buttons.tbrowbefore=function(a,b){this.constructor.prototype.constructor.call(this,a,b),this.command=function(){var a=this.rte.selection.getNode(),b=this.rte.dom.selfOrParent(a,/^(TD|TH)$/),c=this.rte.dom.selfOrParent(b,/^TR$/),d=this.rte.dom.tableMatrix(this.rte.dom.selfOrParent(b,/^TABLE$/));if(b&&c&&d){this.rte.history.add();var e=this.name=="tbrowbefore",f=$(c).prevAll("tr").length,g=0,h=[];function i(a,b){while(b>0){b--;if(d[b]&&d[b][a]&&d[b][a].nodeName)return d[b][a]}}for(var j=0;j<d[f].length;j++)if(d[f][j]&&d[f][j].nodeName){var k=$(d[f][j]),l=parseInt(k.attr("colspan")||1);parseInt(k.attr("rowspan")||1)>1?e?g+=l:h.push(k):g+=l}else d[f][j]=="-"&&(k=i(j,f),k&&h.push($(k)));var m=$(this.rte.dom.create("tr"));for(var j=0;j<g;j++)m.append("<td>&nbsp;</td>");e?m.insertBefore(c):m.insertAfter(c),$.each(h,function(){$(this).attr("rowspan",parseInt($(this).attr("rowspan")||1)+1)}),this.rte.ui.update()}},this.update=function(){this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^TR$/)?this.domElem.removeClass("disabled"):this.domElem.addClass("disabled")}},elRTE.prototype.ui.prototype.buttons.tbrowafter=elRTE.prototype.ui.prototype.buttons.tbrowbefore,function(a){elRTE.prototype.ui.prototype.buttons.tbrowrm=function(b,c){this.constructor.prototype.constructor.call(this,b,c);var d=this;this.command=function(){var b=this.rte.selection.getNode(),c=this.rte.dom.selfOrParent(b,/^(TD|TH)$/),d=this.rte.dom.selfOrParent(c,/^TR$/),e=this.rte.dom.selfOrParent(c,/^TABLE$/),f=this.rte.dom.tableMatrix(e);if(c&&d&&f.length){this.rte.history.add();if(f.length==1)return a(e).remove(),this.rte.ui.update();var g=[],h=a(d).prevAll("tr").length;function i(a,b){while(b>0){b--;if(f[b]&&f[b][a]&&f[b][a].nodeName)return f[b][a]}}function j(b,c){y=h+1;var e=null;if(f[y]){for(var g=0;g<c;g++)f[y][g]&&f[y][g].nodeName&&(e=f[y][g]);b=b.remove(),e?b.insertAfter(e):b.prependTo(a(d).next("tr").eq(0))}}function k(a){for(var b=0;b<a.length;b++)if(a[b]==c)return b<a.length-1?a[b+1]:a[b-1]}for(var l=0;l<f[h].length;l++){var m=null,n=!1;f[h][l]&&f[h][l].nodeName?(m=f[h][l],n=!0):f[h][l]=="-"&&(m=i(l,h))&&(n=!1);if(m){m=a(m);var o=parseInt(m.attr("rowspan")||1);o>1&&(m.attr("rowspan",o-1),n&&j(m,l,h))}}var p=k(this.rte.dom.tableColumn(c));p&&this.rte.selection.selectContents(p).collapse(!0),a(d).remove()}this.rte.ui.update()},this.update=function(){this.rte.dom.selfOrParent(this.rte.selection.getNode(),/^TR$/)?this.domElem.removeClass("disabled"):this.domElem.addClass("disabled")}}}(jQuery),function(a){elRTE.prototype.ui.prototype.buttons.undo=function(a,b){this.constructor.prototype.constructor.call(this,a,b),this.command=function(){this.name=="undo"&&this.rte.history.canBack()?(this.rte.history.back(),this.rte.ui.update()):this.name=="redo"&&this.rte.history.canFwd()&&(this.rte.history.fwd(),this.rte.ui.update())},this.update=function(){this.domElem.toggleClass("disabled",this.name=="undo"?!this.rte.history.canBack():!this.rte.history.canFwd())}},elRTE.prototype.ui.prototype.buttons.redo=elRTE.prototype.ui.prototype.buttons.undo}(jQuery),function(a){elRTE.prototype.ui.prototype.buttons.unlink=function(b,c){this.constructor.prototype.constructor.call(this,b,c),this.command=function(){function d(a){return a.nodeName=="A"&&a.href}var b=this.rte.selection.getNode(),c=this.rte.dom.selfOrParentLink(b);if(!c){var e=a.browser.msie?this.rte.selection.selected():this.rte.selection.selected({wrap:!1});if(e.length){for(var f=0;f<e.length;f++)if(d(e[f])){c=e[f];break}c||(c=this.rte.dom.parent(e[0],d)||this.rte.dom.parent(e[e.length-1],d))}}c&&(this.rte.history.add(),this.rte.selection.select(c),this.rte.doc.execCommand("unlink",!1,null),this.rte.ui.update(!0))},this.update=function(){var a=this.rte.selection.getNode();this.rte.dom.selfOrParentLink(a)?this.domElem.removeClass("disabled").addClass("active"):this.rte.dom.selectionHas(function(a){return a.nodeName=="A"&&a.href})?this.domElem.removeClass("disabled").addClass("active"):this.domElem.addClass("disabled").removeClass("active")}}}(jQuery);
