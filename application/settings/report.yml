domains:
    StudyGeneral:
        paths:
            Person:
                Subject: Person,SubjectUsers,Subject
            Subject:
                Person: Subject,SubjectUsers,Person
                Position: Subject,SubjectUsers,Position
            StudyGroup:
                Person: StudyGroup,StudyGroupUsers,Person
            Programm:
                Person: Programm,StudyGroupProgramms,StudyGroup,StudyGroupUsers,Person
        title: Общая статистика обучения
        tables:
            ClassifierSubject:
                table: classifiers
                primary: classifier_id
                relations:
                    ClassifierSubjectLink:
                        local: classifier_id
                        foreign: classifier_id
                        joinType: left
            ClassifierSubjectLink:
                table: classifiers_links
                relations:
                    ClassifierSubject:
                        local: classifier_id
                        foreign: classifier_id
                        joinType: left
                    Subject:
                        joinOn: ClassifierSubjectLink.type = 0 AND ClassifierSubjectLink.item_id = Subject.subid
                        joinType: left
            ClassifierPerson:
                table: classifiers
                primary: classifier_id
                relations:
                    ClassifierPersonLink:
                        local: classifier_id
                        foreign: classifier_id
            ClassifierPersonLink:
                table: classifiers_links
                relations:
                    ClassifierPerson:
                        local: classifier_id
                        foreign: classifier_id
                    Person:
                        joinOn: ClassifierPersonLink.type = 3 AND ClassifierPersonLink.item_id = Person.MID
            StudyGroup:
                table: study_groups
                relations:
                    StudyGroupUsers:
                        joinOn: StudyGroupUsers.group_id = StudyGroup.group_id
                        joinType: left
                    StudyGroupProgramms:
                        joinOn: StudyGroupProgramms.group_id = StudyGroup.group_id
                        joinType: left
                    StudyGroupCourse:
                        joinOn: StudyGroupCourse.group_id = StudyGroup.group_id
                        joinType: left
            StudyGroupCourse:
                table: study_groups_courses
                relations:
                    StudyGroup:
                        joinOn: StudyGroupCourse.group_id = StudyGroup.group_id
                        joinType: left
                    Subject:
                        joinOn: StudyGroupCourse.course_id = Subject.subid
                        joinType: left
            StudyGroupUsers:
                table: study_groups_users
                relations:
                    StudyGroup:
                        joinOn: StudyGroupUsers.group_id = StudyGroup.group_id
                        joinType: left
                    Person:
                        joinOn: StudyGroupUsers.user_id = Person.MID
                        joinType: left
            Programm:
                table: programm
                relations:
                    StudyGroupProgramms:
                        joinOn: StudyGroupProgramms.programm_id = Programm.programm_id
                        joinType: left
                    ProgrammSubjects:
                        joinOn: ProgrammSubjects.programm_id = Programm.programm_id
            ProgrammSubjects:
                table: programm_events
                relations:
                    Programm:
                        joinOn: ProgrammSubjects.programm_id = Programm.programm_id
                    Subject:
                        joinOn: ProgrammSubjects.item_id = Subject.subid AND ProgrammSubjects.type = 1
                        joinType: left
            StudyGroupProgramms:
                table: study_groups_programms
                relations:
                    StudyGroup:
                        joinOn: StudyGroupProgramms.group_id = StudyGroup.group_id
                        joinType: left
                    Programm:
                        joinOn: StudyGroupProgramms.programm_id = Programm.programm_id
                        joinType: left
                    Person:
                        joinOn: StudyGroupUsers.user_id = Person.MID
                        joinType: left
            Position:
                table: structure_of_organ
                primary: soid
                relations:
                    Person:
                        local: mid
                        foreign: MID
                        joinType: left
                    Department:
                        local: owner_soid
                        foreign: soid
                        joinType: left
            Department:
                table: structure_of_organ
                primary: soid
                relations:
                    Position:
                        local: soid
                        foreign: owner_soid
                        joinType: left
            Teacher:
                table: Teachers
                primary: PID
                relations:
                    TPerson:
                        local: MID
                        foreign: MID
                        joinType: left
                    Subject:
                        local: CID
                        foreign: subid
                        joinType: left
            TPerson:
                    table: People
                    primary: MID
                    relations:
                        Teacher:
                            local: MID
                            foreign: MID
                            joinType: left
            Person:
                table: People
                primary: MID
                relations:
                    Position:
                        local: MID
                        foreign: mid
                        joinType: left
                    ClassifierPersonLink:
                        joinOn: Person.MID = ClassifierPersonLink.item_id AND ClassifierPersonLink.type = 3
                    SubjectUsers:
                        local: MID
                        foreign: user_id
                    StudyGroupUsers:
                        joinOn: StudyGroupUsers.user_id = Person.MID
                        joinType: left
            SubjectUsers:
                table: subjects_users
                relations:
                    Subject:
                        local: subject_id
                        foreign: subid
                        joinOn: SubjectUsers.subject_id = Subject.subid AND Subject.base_id <> 2
                        joinType: left
                    Person:
                        local: user_id
                        foreign: MID
                    Claimant:
                        joinOn: Claimant.CID = SubjectUsers.subject_id AND Claimant.MID = SubjectUsers.user_id AND SubjectUsers.status = 0
                        joinType: left
                    Student:
                        joinOn: Student.CID = SubjectUsers.subject_id AND Student.MID = SubjectUsers.user_id AND SubjectUsers.status = 1
                        joinType: left
                    Graduated:
                        joinOn: Graduated.CID = SubjectUsers.subject_id AND Graduated.MID = SubjectUsers.user_id AND SubjectUsers.status = 2
                        joinType: left
            Subject:
                table: subjects
                primary: subid
                relations:
                    ClassifierSubjectLink:
                        joinOn: Subject.subid = ClassifierSubjectLink.item_id AND ClassifierSubjectLink.type = 0
                        joinType: left
                    SubjectB:
                        joinOn: SubjectB.subid=Subject.base_id AND Subject.base=2
                        joinType: left
                    SubjectUsers:
                        joinOn: Subject.subid = SubjectUsers.subject_id
                        joinType: left
                    Teacher:
                        local: subid
                        foreign: CID
                        joinType: left
                    StudyGroupCourse:
                        joinOn: Subject.subid = StudyGroupCourse.course_id
                        joinType: left
                    ProgrammSubjects:
                        joinOn: ProgrammSubjects.item_id = Subject.subid AND ProgrammSubjects.type = 1
                        joinType: left
            SubjectB:
                table: subjects
                primary: subid
                relations:
                    Subject:
                        joinOn: SubjectB.subid=Subject.base_id AND SubjectB.base = 1
                        joinType: left
            Claimant:
                table: claimants
                relations:
                    SubjectUsers:
                        joinOn: Claimant.CID = SubjectUsers.subject_id AND Claimant.MID = SubjectUsers.user_id AND SubjectUsers.status = 0
                        joinType: left
            Student:
                table: Students
                relations:
                    SubjectUsers:
                        joinOn: Student.CID = SubjectUsers.subject_id AND Student.MID = SubjectUsers.user_id AND SubjectUsers.status = 1
                        joinType: left
                    StudyGroupUsers:
                        joinOn: StudyGroupUsers.user_id = Student.MID
                        joinType: left
            Graduated:
                table: graduated
                relations:
                    Mark:
                        joinOn: Graduated.CID = Mark.cid AND Graduated.MID = Mark.mid
                        joinType: left
                    SubjectUsers:
                        joinOn: Graduated.CID = SubjectUsers.subject_id AND Graduated.MID = SubjectUsers.user_id AND SubjectUsers.status = 2
                        joinType: left
            Mark:
                table: courses_marks
                relations:
                    Graduated:
                        joinOn: Graduated.CID = Mark.cid AND Graduated.MID = Mark.mid
                        joinType: left
        categories:
            Orgstructure:
                title: Организационная структура
                fields:
                    departmentId:
                        table: Department
                        title: ID подразделения
                        type: string
                        field: soid
                        aggregation:
                            - count                
                    department:
                        table: Department
                        title: Название подразделения
                        type: string
                        field: name
                    position:
                        table: Position
                        title: Должность
                        type: string
                        field: name
            Person:
                title: Пользователь
                fields:
                    personId:
                        table: Person
                        title: ID пользователя
                        type: string
                        field: MID
                        aggregation:
                            - count
                    fio:
                        table: Person
                        title: ФИО
                        type: string
                        field: fio
                        expression: CASE WHEN CONCAT(CONCAT(CONCAT(CONCAT(Person.LastName, ' '), Person.FirstName), ' '), Person.Patronymic) IS NULL THEN 'Нет' ELSE CONCAT(CONCAT(CONCAT(CONCAT(Person.LastName, ' '), Person.FirstName), ' '), Person.Patronymic) END
                        expressionFields: LastName, FirstName, Patronymic
                        aggregation:
                            - group_concat                        
                    login:
                        table: Person
                        title: Логин
                        type: string
                        field: Login
                    gender:
                        table: Person
                        title: Пол
                        type: string
                        expression: CASE WHEN (Person.Gender = 2) THEN 'Женский' ELSE 'Мужской' END
                    age:
                        table: Person
                        title: Возраст
                        type: string
                        expression: CASE WHEN ((YEAR(NOW()) - YEAR(Person.BirthDate)) < 100) THEN YEAR(NOW()) - YEAR(Person.BirthDate) ELSE 0 END
                    status:
                        table: SubjectUsers
                        title: Статус обучения                       
                        type: string
                        expression: CASE WHEN (SubjectUsers.status = 0) THEN 'Планируется' ELSE CASE WHEN (SubjectUsers.status = 1) THEN 'Идёт' ELSE 'Завершено' END END
                    personClassifier:
                        table: ClassifierPerson
                        title: Классификация пользователя
                        type: string
                        field: name
                        aggregation:
                            - group_concat
            Subject:
                title: Учебный курс/сессия
                fields:
                    subjectId:
                        table: Subject
                        title: ID курса
                        type: string
                        field: subid
                        function:
                            isSession:
                                title: Является сессией
                                expression: CASE WHEN (Subject.base = 2) THEN 'Да' ELSE 'Нет' END
                        aggregation:
                            - count
                    subjectTitle:
                        table: Subject
                        title: Название курса
                        type: string
                        field: name
                        aggregation:
                            - group_concat
                    subjectType:
                        table: Subject
                        title: Тип обучения
                        type: string
                        field: type
                        expression: CASE WHEN (Subject.is_fulltime = 1) THEN 'Дистанционное' ELSE 'Очное' END
                    subjectPrice:
                        table: Subject
                        title: Стоимость
                        type: string
                        field: price
                        aggregation:
                            - sum
                    subjectBegin:
                        table: Subject
                        title: Дата начала
                        type: date
                        field: begin
                        function:
                            dayMonthYear:
                                title: День-Месяц-Год
                                callback: dayMonthYear
                            monthYear:
                                title: Месяц-Год
                                callback: monthYear
                            year:
                                title: Год
                                callback: year
                    subjectEnd:
                        table: Subject
                        title: Дата окончания
                        type: date
                        field: end
                        function:
                            dayMonthYear:
                                title: День-Месяц-Год
                                callback: dayMonthYear
                            monthYear:
                                title: Месяц-Год
                                callback: monthYear
                            year:
                                title: Год
                                callback: year
                    subjectClassifier:
                        table: ClassifierSubject
                        title: Классификация курса
                        type: string
                        field: name
                        aggregation:
                            - group_concat
                    teacherFio:
                        table: TPerson
                        title: ФИО Тьютора
                        type: string
                        field: fio
                        expression: CONCAT(CONCAT(CONCAT(CONCAT(TPerson.LastName, ' '), TPerson.FirstName), ' '), TPerson.Patronymic)
                        expressionFields: LastName, FirstName, Patronymic
                        aggregation:
                            - group_concat
            StudyGroup:
                title: Учебная группа
                fields:
                    studygroupname:
                        table: StudyGroup
                        title: Название учебной группы
                        type: string
                        field: name
                        expression: CASE WHEN (StudyGroup.name IS NULL) THEN 'Нет' ELSE StudyGroup.name END
            Programm:
                title: Учебная программа
                fields:
                    programm:
                        table: Programm
                        title: Название учебной программы
                        type: string
                        field: name
                        expression: CASE WHEN (Programm.name IS NULL) THEN 'Нет' ELSE Programm.name END
            SubjectBase:
                title: Базовый курс
                fields:
                    sessionId:
                        table: SubjectB
                        title: ID базового курса
                        type: string
                        field: subid
                        aggregation:
                            - count                
                    sessionName:
                        table: SubjectB
                        title: Название базового курса
                        type: string
                        field: name                        
                        aggregation:
                            - group_concat                        
            Claimant:
                title: Обучение планируется
                fields:
                    claimantId:
                        table: Claimant
                        title: ID заявки
                        type: string
                        field: SID
                        aggregation:
                            - count                
            Student:
                title: Обучение идёт
                fields:
                    studentId:
                        table: Student
                        title: ID слушателя
                        type: string
                        field: SID
                        aggregation:
                            - count                
                    studentSubjectBegin:
                        table: Student
                        title: Дата начала обучения
                        type: date
                        field: time_registered
                        function:
                            dayMonthYear:
                                title: День-Месяц-Год
                                callback: dayMonthYear
                            monthYear:
                                title: Месяц-Год
                                callback: monthYear
                            year:
                                title: Год
                                callback: year
                    studentSubjectEnd:
                        table: Student
                        title: Плановая дата окончания обучения
                        type: date
                        field: end_personal
                        function:
                            dayMonthYear:
                                title: День-Месяц-Год
                                callback: dayMonthYear
                            monthYear:
                                title: Месяц-Год
                                callback: monthYear
                            year:
                                title: Год
                                callback: year
                            expiriedEnded:
                                title: Срок истек
                                expression: CASE WHEN (NOW() > Student.end_personal) THEN 'Да' ELSE NULL END
                                type: string
                        aggregation:
                            - count
            Graduated:
                title: Обучение завершено
                fields:
                    graduatedId:
                        table: Graduated
                        title: ID прошедшего обучение
                        type: string
                        field: SID
                        aggregation:
                            - count                
                    graduatedSubjectBegin:
                        table: Graduated
                        title: Дата начала обучения
                        type: date
                        field: begin
                        function:
                            dayMonthYear:
                                title: День-Месяц-Год
                                callback: dayMonthYear
                            monthYear:
                                title: Месяц-Год
                                callback: monthYear
                            year:
                                title: Год
                                callback: year
                    graduatedSubjectEnd:
                        table: Graduated
                        title: Дата окончания обучения
                        type: date
                        field: end
                        function:
                            dayMonthYear:
                                title: День-Месяц-Год
                                callback: dayMonthYear
                            monthYear:
                                title: Месяц-Год
                                callback: monthYear
                            year:
                                title: Год
                                callback: year
                    graduatedSubjectMark:
                        table: Mark
                        title: Итоговая оценка
                        type: integer
                        field: mark
                        expression: CASE WHEN (Mark.mark > 0) THEN Mark.mark ELSE 0 END
                        function:
                            withMark:
                                title: Выставлена
                                expression: CASE WHEN (Mark.mark > 0) THEN 'Да' END
                            withoutMark:
                                title: Не выставлена
                                expression: CASE WHEN (Mark.mark IS NULL) OR (Mark.mark = '') OR (Mark.mark = 0) THEN 'Не выставлена' END
                        aggregation:
                            - count
                            - sum
                    certificateNumber:
                        table: Graduated
                        title: Номер сертификата
                        type: string
                        field: certificate_number
                        expression: LPAD(Graduated.certificate_id, 10, '0')
                        expressionFields: certificate_id
    StudyDetailed:
        title: Текущие результаты обучения
        paths:
            Person:
                Schedule: Person,ScheduleId,Schedule
                Subject: Person,SubjectUsers,Subject
            Schedule:
                Person: Schedule,ScheduleId,Person
            Subject:
                Person: Subject,SubjectUsers,Person
        tables:
            Position:
                table: structure_of_organ
                primary: soid
                relations:
                    Person:
                        local: mid
                        foreign: MID
                        joinType: left
                    Department:
                        local: owner_soid
                        foreign: soid
                        joinType: left
            Department:
                table: structure_of_organ
                primary: soid
                relations:
                    Position:
                        local: soid
                        foreign: owner_soid
                        joinType: left
            Person:
                table: People
                primary: MID
                relations:
                    Position:
                        local: MID
                        foreign: mid
                        joinType: left
                    ScheduleId:
                        local: MID
                        foreign: MID
                    SubjectUsers:
                        local: MID
                        foreign: user_id
                    Student:
                        local: MID
                        foreign: MID
                    StudyGroupUsers:
                        joinOn: StudyGroupUsers.user_id = Person.MID
                        joinType: left
            StudyGroupUsers:
                table: study_groups_users
                relations:
                    StudyGroup:
                        joinOn: StudyGroupUsers.group_id = StudyGroup.group_id
                        joinType: left
                    Person:
                        joinOn: StudyGroupUsers.user_id = Person.MID
                        joinType: left
            StudyGroup:
                table: study_groups
                relations:
                    StudyGroupUsers:
                        joinOn: StudyGroupUsers.group_id = StudyGroup.group_id
                        joinType: left
            Schedule:
                table: schedule
                primary: SHEID
                relations:
                    ScheduleId:
                        local: SHEID
                        foreign: SHEID
                    Subject:
                        joinOn: Schedule.CID = Subject.subid AND Schedule.isfree = 0
            ScheduleId:
                table: scheduleID
                primary: SSID
                relations:
                    Schedule:
                        local: SHEID
                        foreign: SHEID
                    Person:
                        local: MID
                        foreign: MID
            Subject:
                table: subjects
                primary: subid
                relations:
                    Schedule:
                        joinOn: Student.CID = Subject.subid AND Schedule.isfree = 0
                    ProgrammEvent:
                        joinOn: Subject.subid = ProgrammEvent.item_id AND ProgrammEvent.type = 1
                        joinType: left
                    SubjectUsers:
                        joinOn: Subject.subid = SubjectUsers.subject_id
                        joinType: left
            ProgrammEvent:
                table: programm_events
                primary: programm_event_id
                relations:
                    Subject:
                        joinOn: ProgrammEvent.item_id = Subject.subid AND ProgrammEvent.type = 1
                        joinType: left
                    Programm:
                        joinOn: ProgrammEvent.programm_id = Programm.programm_id
                        joinType: left
            Programm:
                table: programm
                primary: programm_id
                relations:
                    ProgrammEvent:
                        joinOn: Programm.programm_id = ProgrammEvent.programm_id
                        joinType: left
            Student:
                table: Students
                relations:
                    Person:
                        local: MID
                        foreign: MID
                    SubjectUsers:
                        local: MID
                        foreign: user_id
                        joinOn: Student.CID = SubjectUsers.subject_id AND Student.MID = SubjectUsers.user_id AND SubjectUsers.status = 1
                        joinType: left
            SubjectUsers:
                table: subjects_users
                relations:
                    Subject:
                        local: subject_id
                        foreign: subid
                        joinOn: SubjectUsers.subject_id = Subject.subid AND Subject.base_id <> 2
                        joinType: left
                    Person:
                        local: user_id
                        foreign: MID
                    Student:
                        local: user_id
                        foreign: MID
                        joinOn: Student.CID = SubjectUsers.subject_id AND Student.MID = SubjectUsers.user_id AND SubjectUsers.status = 1
                        joinType: left
        categories:
            Orgstructure:
                title: Организационная структура
                fields:
                    departmentId:
                        table: Department
                        title: ID подразделения
                        type: string
                        field: soid
                        aggregation:
                            - count                
                    department:
                        table: Department
                        title: Подразделение
                        type: string
                        field: name
                    position:
                        table: Position
                        title: Должность
                        type: string
                        field: name
            Person:
                title: Пользователь
                fields:
                    personId:
                        table: Person
                        title: ID пользователя
                        type: string
                        field: MID
                        aggregation:
                            - count
                    fio:
                        table: Person
                        title: ФИО
                        type: string
                        field: fio
                        expression: CONCAT(CONCAT(CONCAT(CONCAT(Person.LastName, ' '), Person.FirstName), ' '), Person.Patronymic)
                        expressionFields: LastName, FirstName, Patronymic
                    lastname:
                        table: Person
                        title: Фамилия
                        type: string
                        field: LastName
                    firstname:
                        table: Person
                        title: Имя
                        type: string
                        field: FirstName
                    patronymic:
                        table: Person
                        title: Отчество
                        type: string
                        field: Patronymic
                    login:
                        table: Person
                        title: Логин
                        type: string
                        field: Login
                    gender:
                        table: Person
                        title: Пол
                        type: string
                        expression: CASE WHEN (Gender = 2) THEN 'Женский' ELSE 'Мужской' END
                    age:
                        table: Person
                        title: Возраст
                        type: string
                        expression: CASE WHEN ((YEAR(NOW()) - YEAR(BirthDate)) < 100) THEN YEAR(NOW()) - YEAR(BirthDate) ELSE 0 END
            Subject:
                title: Учебный курс/сессия
                fields:
                    subjectId:
                        table: Subject
                        title: ID курса
                        type: string
                        field: subid
                        function:
                            isSession:
                                title: Является сессией
                                expression: CASE WHEN (Subject.base = 2) THEN 'Да' ELSE 'Нет' END
                        aggregation:
                            - count
                    subjectTitle:
                        table: Subject
                        title: Название курса
                        type: string
                        field: name
                        aggregation:
                            - group_concat
            StudyGroup:
                 title: Учебная группа
                 fields:
                    studygroupname:
                        table: StudyGroup
                        title: Название учебной группы
                        type: string
                        field: name
                        expression: CASE WHEN (StudyGroup.name IS NULL) THEN 'Нет' ELSE StudyGroup.name END
            Programm:
                title: Учебная программа
                fields:
                    programm:
                        table: Programm
                        title: Название учебной программы
                        type: string
                        field: name
                        expression: CASE WHEN (Programm.name IS NULL) THEN 'Нет' ELSE Programm.name END
            Student:
                title: Обучение по курсу
                fields:
                    studentId:
                        table: Student
                        title: ID слушателя
                        type: string
                        field: SID
                        aggregation:
                            - count                
                    studentSubjectBegin:
                        table: Student
                        title: Дата начала обучения
                        type: date
                        field: time_registered
                        function:
                            dayMonthYear:
                                title: День-Месяц-Год
                                callback: dayMonthYear
                            monthYear:
                                title: Месяц-Год
                                callback: monthYear
                            year:
                                title: Год
                                callback: year
                    studentSubjectEnd:
                        table: Student
                        title: Плановая дата окончания обучения
                        type: date
                        field: end_personal
                        function:
                            dayMonthYear:
                                title: День-Месяц-Год
                                callback: dayMonthYear
                            monthYear:
                                title: Месяц-Год
                                callback: monthYear
                            year:
                                title: Год
                                callback: year
                    studentProgress:
                        table: Student
                        title: Процент прохождения плана занятий
                        type: integer
                        field: SID
                        callback: getStudentProgress
                        sortable: false
            Schedule:
                title: Занятие
                fields:
                    scheduleId:
                        table: Schedule
                        title: ID занятия
                        type: string
                        field: SHEID
                        aggregation:
                            - count
                    scheduleTitle:
                        table: Schedule
                        title: Название занятия
                        type: string
                        field: title
                        aggregation:
                            - group_concat
                    scheduleMaxMark:
                        table: Schedule
                        title: Максимальная оценка
                        type: integer
                        field: max_mark
                        aggregation:
                            - count
                            - sum
                    scheduleEnd:
                        table: Schedule
                        title: Дата окончания
                        type: data
                        field: end
                        function:
                            expiriedEnded:
                                title: Прошлое
                                expression: CASE WHEN (NOW() > Schedule.end AND Schedule.timetype != 2 ) THEN 'Да' ELSE NULL END
                                type: string
                            expiriedFuture:
                                title: Будущее
                                expression: CASE WHEN (NOW() < Schedule.end) THEN 'Да' ELSE NULL END
                                type: string
                        aggregation:
                            - count
            ScheduleId:
                title: Выполнение занятия
                fields:
                    scheduleMark:
                        table: ScheduleId
                        title: Оценка за занятие
                        type: integer
                        field: V_STATUS
                        callback: getScheduleMark
                        expression: CASE WHEN (ScheduleId.V_STATUS = '-1') THEN 0 ELSE ScheduleId.V_STATUS END
                        function:
                            notempty:
                                title: Выставлена
                                expression: CASE WHEN (ScheduleId.V_STATUS IS NULL OR ScheduleId.V_STATUS = '-1') THEN NULL ELSE 'Да' END
                        aggregation:
                            - count
                            - sum
                    scheduleDate:
                        table: ScheduleId
                        title: Дата и время прохождения занятия
                        type: datetime
                        field: V_DATE
    StudyTests:
        title: Результаты тестирования 
        paths:
            #Person:
            #   Subject: Person,Student,Subject
            #    Schedule: Person,ScheduleId,Schedule
            #    ScheduleTest: Person,ScheduleId,Schedule,ScheduleTest
            #Subject:
            #    Person: Subject,Student,Person
            #Schedule:
            #    Person: Schedule,ScheduleId,Person
            #ScheduleTest:
            #    Person: ScheduleTest,Schedule,ScheduleId,Person
        tables:
            Person:
                table: People
                primary: MID
                relations:
                    Student:
                        local: MID
                        foreign: MID
                    TestAttempt:
                        local: MID
                        foreign: user_id
                        #joinType: left
                    StudyGroupUsers:
                        joinOn: StudyGroupUsers.user_id = Person.MID
                        joinType: left
                    ScheduleId:
                        joinOn: ScheduleId.MID = Person.MID
                        joinType: inner
            StudyGroupUsers:
                table: study_groups_users
                relations:
                    StudyGroup:
                        joinOn: StudyGroupUsers.group_id = StudyGroup.group_id
                        joinType: left
                    Person:
                        joinOn: StudyGroupUsers.user_id = Person.MID
                        joinType: left
            StudyGroup:
                table: study_groups
                relations:
                    StudyGroupUsers:
                        joinOn: StudyGroupUsers.group_id = StudyGroup.group_id
                        joinType: left
            Student:
                table: Students
                relations:
                    Person:
                        local: MID
                        foreign: MID
            Subject:
                table: subjects
                primary: subid
                relations:
                    ProgrammEvent:
                        joinOn: Subject.subid = ProgrammEvent.item_id AND ProgrammEvent.type = 1
                        joinType: inner
                    SubjectUsers:
                        joinOn: SubjectUsers.subject_id = Subject.subid AND SubjectUsers.user_id = People.MID
                        joinType: inner
                    Schedule:
                        joinOn: Subject.subid = Schedule.CID
                        joinType: inner
            SubjectUsers:
                table: subjects_users
                primary: subject_id
                relations:
                    Subject:
                      joinOn: SubjectUsers.subject_id = Subject.subid and SubjectUsers.user_id = Person.MID
                      joinType: left
            Schedule:
                table: schedule
                primary: SHEID
                relations:
                    TestAttempt:
                        joinOn: Schedule.SHEID = TestAttempt.context_event_id AND TestAttempt.context_type = 1
                        joinType: inner
                    Subject:
                        joinOn: Schedule.CID = Subject.subid
                        joinType: inner
                    ScheduleId:
                        joinOn: ScheduleId.SHEID = Schedule.SHEID
                        joinType: left
            ScheduleId:
                table: scheduleID
                primary: SSID
                relations:
                    Schedule:
                        joinOn: ScheduleId.SHEID = Schedule.SHEID
                        joinType: inner
                    Person:
                        joinOn: ScheduleId.MID = Person.MID
                        joinType: inner
            Test:
                table: questionnaires
                primary: quest_id
                relations:
                    TestAttempt:
                        joinOn: TestAttempt.quest_id = Test.quest_id AND Test.type = 'test'
                        joinType: inner
            TestAttempt:
                table: quest_attempts
                primary: attempt_id
                relations:
                    Person:
                        local: user_id
                        foreign: MID
                    Schedule:
                         joinOn: TestAttempt.context_event_id = Schedule.SHEID AND TestAttempt.context_type = 1
                         joinType: inner
                    Test:
                        joinOn: TestAttempt.quest_id = Test.quest_id AND Test.type = 'test'
                        joinType: inner
                    AttemptCluster:
                        joinOn: AttemptCluster.quest_attempt_id = TestAttempt.attempt_id
                        joinType: inner
            ProgrammEvent:
                table: programm_events
                primary: programm_event_id
                relations:
                    Subject:
                        joinOn: ProgrammEvent.item_id = Subject.subid AND ProgrammEvent.type = 1
                        joinType: left
                    Programm:
                        joinOn: ProgrammEvent.programm_id = Programm.programm_id
                        joinType: left
            Programm:
                table: programm
                primary: programm_id
                relations:
                    ProgrammEvent:
                        joinOn: Programm.programm_id = ProgrammEvent.programm_id
                        joinType: left
            AttemptCluster:
                table: quest_attempt_clusters
                primary: quest_attempt_cluster_id
                relations:
                    TestAttempt:
                        joinOn: AttemptCluster.quest_attempt_id = TestAttempt.attempt_id
                        joinType: inner
                    Cluster:
                        joinOn: AttemptCluster.cluster_id = Cluster.cluster_id
                        joinType: left
            Cluster:
                table: quest_clusters
                primary: cluster_id
                relations:
                    AttemptCluster:
                        joinOn: AttemptCluster.cluster_id = Cluster.cluster_id
                        joinType: left
        categories:
            StudyGroup:
                title: Учебная группа
                fields:
                    studygroupname:
                        table: StudyGroup
                        title: Название учебной группы
                        type: string
                        field: name
                        expression: CASE WHEN (StudyGroup.name IS NULL) THEN 'Нет' ELSE StudyGroup.name END
            Person:
                title: Пользователь
                fields:
                    personId:
                        table: Person
                        title: ID пользователя
                        type: string
                        field: MID
                        aggregation:
                            - count
                    fio:
                        table: Person
                        title: ФИО
                        type: string
                        field: fio
                        expression: CONCAT(CONCAT(CONCAT(CONCAT(Person.LastName, ' '), Person.FirstName), ' '), Person.Patronymic)
                        expressionFields: LastName, FirstName, Patronymic
                    lastname:
                        table: Person
                        title: Фамилия
                        type: string
                        field: LastName
                    firstname:
                        table: Person
                        title: Имя
                        type: string
                        field: FirstName
                    patronymic:
                        table: Person
                        title: Отчество
                        type: string
                        field: Patronymic
                    login:
                        table: Person
                        title: Логин
                        type: string
                        field: Login
                    gender:
                        table: Person
                        title: Пол
                        type: string
                        expression: CASE WHEN (Person.Gender = 2) THEN 'Женский' ELSE 'Мужской' END
            Programm:
                title: Учебная программа
                fields:
                    programm:
                        table: Programm
                        title: Название учебной программы
                        type: string
                        field: name
                        expression: CASE WHEN (Programm.name IS NULL) THEN 'Нет' ELSE Programm.name END
            Subject:
                title: Учебный курс
                fields:
                    subjectId:
                        table: Subject
                        title: ID курса
                        type: string
                        field: subid
                        aggregation:
                            - count
                    subjectTitle:
                        table: Subject
                        title: Название курса
                        type: string
                        field: name
                        aggregation:
                            - group_concat
            Test:
                title: Тест
                fields:
                    testId:
                        table: Test
                        title: ID теста
                        type: string
                        field: quest_id
                        aggregation:
                            - count
                    testTitle:
                        table: Test
                        title: Название теста
                        type: string
                        field: name
                        aggregation:
                            - group_concat
            Cluster:
                title: Блок вопросов
                fields:
                    clusterId:
                        table: Cluster
                        title: ID Блока вопросов
                        type: string
                        field: cluster_id
                        aggregation:
                            - count
                    clusterTitle:
                        table: Cluster
                        title: Название блока вопросов
                        type: string
                        field: name
                        aggregation:
                            - group_concat
                        callback: getDefaultClusterName
                    clusterResult:
                        table: AttemptCluster
                        title: Результат
                        type: string
                        field: score_percented
                        expression: CONCAT(ROUND(100 * AttemptCluster.score_percented, 0), '%')
                        aggregation:
                            - sum
                            - max
                            - avg
            TestAttempt:
                title: Попытка прохождения теста
                fields:
                    testAttemptId:
                        table: TestAttempt
                        title: ID попытки
                        type: integer
                        field: attempt_id
                        aggregation:
                            - count
                    testAttemptStop:
                        table: TestAttempt
                        title: Дата и время попытки
                        type: datetime
                        field: date_end
                    testAttemptBal:
                        table: TestAttempt
                        title: Результат (в баллах)
                        type: double
                        field: score_raw
                        aggregation:
                            - max
                    testAttemptMark:
                        table: ScheduleId
                        title: Результат (оценка)
                        type: double
                        field: V_STATUS
                        expression: CASE WHEN (ScheduleId.V_STATUS > 0) THEN ScheduleId.V_STATUS ELSE 0 END
                        aggregation:
                            - sum
                        function:
                            minute:
                                title: Выставлена
                                expression: CASE WHEN (ScheduleId.V_STATUS > -1) THEN 'Выставлена' ELSE 'Не выставлена' END
                    testAttemptPercent:
                        table: TestAttempt
                        title: Результат (в процентах)
                        type: integer
                        field: score_weighted
                        expression: CONCAT(ROUND(100 * TestAttempt.score_weighted, 0), '%')
                        expressionFields: score_weighted
                        aggregation:
                            - max                        
#                    testAttemptQuestDone:
#                        table: TestAttempt
#                        title: Кол-во пройденных вопросов
#                        type: integer
#                        field: questdone
                    testAttemptTime:
                        table: TestAttempt
                        title: Время прохождения
                        type: string
                        field: date_begin
                        expression: TestAttempt.date_end-TestAttempt.date_begin
                        expressionFields: date_begin, date_end
#                        aggregation:
#                            - sum
#                            - max
#                            - avg
                        function:
                            minute:
                                title: В минутах
                                expression: ROUND((TestAttempt.date_end-TestAttempt.date_begin) / 60, 0)
                            hour:
                                title: В часах
                                expression: ROUND((TestAttempt.date_end-TestAttempt.date_begin) / 60 / 60, 0)
                    testStatus:
                        table: TestAttempt
                        title: Статус тестирования
                        type: string
                        field: status
                        expression: CASE WHEN (TestAttempt.status = 0) THEN 'не начат' ELSE CASE WHEN (TestAttempt.status = 1) THEN 'идет тестирование' ELSE CASE WHEN (TestAttempt.status = 2) THEN 'закончен' END END END
    AdminSessions:
        title: Пользовательские сессии
        tables:
            Person:
                table: People
                primary: MID
                relations:
                    UserSession:
                        local: MID
                        foreign: mid
                    StudyGroupUsers:
                        joinOn: StudyGroupUsers.user_id = Person.MID
                        joinType: left
            StudyGroupUsers:
                table: study_groups_users
                relations:
                    StudyGroup:
                        joinOn: StudyGroupUsers.group_id = StudyGroup.group_id
                        joinType: left
                    Person:
                        joinOn: StudyGroupUsers.user_id = Person.MID
                        joinType: left
            StudyGroup:
                table: study_groups
                relations:
                    StudyGroupUsers:
                        joinOn: StudyGroupUsers.group_id = StudyGroup.group_id
                        joinType: left
            UserSession:
                table: sessions
               # primary: sessid
                relations:
                    Person:
                        local: mid
                        foreign: MID
                    UserSystemSession:
                        joinOn: UserSystemSession.sessid = UserSession.sessid AND UserSession.course_id IS NULL AND UserSession.lesson_id IS NULL AND UserSession.resource_id IS NULL
                        joinType: inner
                    UserCourseSession:
                        joinOn: UserSession.sessid = UserCourseSession.sessid AND UserSession.course_id IS NOT NULL
                        joinType: inner
                    UserLessonSession:
                        joinOn: UserSession.sessid = UserLessonSession.sessid AND UserSession.lesson_id IS NOT NULL
                        joinType: inner
            UserSystemSession:
                table: sessions
              #  primary: sessid
                relations:
                    UserSession:
                        joinOn: UserSystemSession.sessid = UserSession.sessid AND UserSession.course_id IS NULL AND UserSession.lesson_id IS NULL AND UserSession.resource_id IS NULL
                        joinType: inner
            UserCourseSession:
                table: sessions
              #  primary: sessid
                relations:
                    UserSession:
                        joinOn: UserSession.sessid = UserCourseSession.sessid AND UserSession.course_id IS NOT NULL
                        joinType: inner
                    Subject:
                        local: course_id
                        foreign: subid
            UserLessonSession:
                table: sessions
              #  primary: sessid
                relations:
                    UserSession:
                        joinOn: UserSession.sessid = UserLessonSession.sessid AND UserSession.lesson_id IS NOT NULL
                        joinType: inner
                    Schedule:
                        local: lesson_id
                        foreign: SHEID
            Subject:
                table: subjects
#                primary: subid
                relations:
                    UserCourseSession:
                        local: subid
                        foreign: course_id
            Schedule:
                table: schedule
                primary: SHEID
                relations:
                    UserLessonSession:
                        local: SHEID
                        foreign: lesson_id
        categories:
            Person:
                title: Пользователь
                fields:
                    personId:
                        table: Person
                        title: ID пользователя
                        type: string
                        field: MID
                        aggregation:
                            - group_concat
                            - count
                    fio:
                        table: Person
                        title: ФИО
                        type: string
                        field: fio
                        expression: CONCAT(CONCAT(CONCAT(CONCAT(Person.LastName, ' '), Person.FirstName), ' '), Person.Patronymic)
                        expressionFields: LastName, FirstName, Patronymic
                    login:
                        table: Person
                        title: Логин
                        type: string
                        field: Login
                    gender:
                        table: Person
                        title: Пол
                        type: string
                        expression: CASE WHEN (Person.Gender = 2) THEN 'Женский' ELSE 'Мужской' END
                    age:
                        table: Person
                        title: Возраст
                        type: string
                        field: BirthDate
                        callback: getUserAge
            StudyGroup:
                title: Учебная группа
                fields:
                    studygroupname:
                        table: StudyGroup
                        title: Название учебной группы
                        type: string
                        field: name
                        expression: CASE WHEN (StudyGroup.name IS NULL) THEN 'Нет' ELSE StudyGroup.name END
            UserSession:
                title: Пользовательская сессия
                fields:
                    sessionStart:
                        table: UserSession
                        title: Время начала
                        type: datetime
                        field: start
                        function:
                            dayMonthYear:
                                title: День-Месяц-Год
                                callback: dayMonthYear
                            monthYear:
                                title: Месяц-Год
                                callback: monthYear
                            year:
                                title: Год
                                callback: year
                    sessionEnd:
                        table: UserSession
                        title: Время окончания
                        type: datetime
                        field: stop
                        function:
                            dayMonthYear:
                                title: День-Месяц-Год
                                callback: dayMonthYear
                            monthYear:
                                title: Месяц-Год
                                callback: monthYear
                            year:
                                title: Год
                                callback: year
                        aggregation:
                            - group_concat
                    sessionIp:
                        table: UserSession
                        title: ip-адрес
                        type: string
                        field: ip
            UserSystemSession:
                title: Сеанс работы с системой
                fields:
                    sessionStart1:
                        table: UserSystemSession
                        title: Время входа в систему
                        type: string
                        field: start
                        function:
                            dayMonthYear:
                                title: День-Месяц-Год
                                expression: CONCAT(CONCAT(CONCAT(CONCAT(LPAD(DAY(UserSystemSession.start), 2, '0'), '.'), LPAD(MONTH(UserSystemSession.start), 2, '0')), '.'), YEAR(UserSystemSession.start))
                                type: string
                            monthYear:
                                title: Месяц-Год
                                expression: CONCAT(CONCAT(LPAD(MONTH(UserSystemSession.start), 2, '0'), '.'), YEAR(UserSystemSession.start))
                                type: string
                            year:
                                title: Год
                                expression: YEAR(UserSystemSession.start)
                                type: string
                        aggregation:
                            - group_concat
                            - group_concat_distinct
                            - count
                            - count_distinct
            UserCourseSession:
                title: Сеанс работы с курсом
                fields:
                    sessionStart2:
                        table: UserCourseSession
                        title: Время входа в курс
                        type: string
                        field: start
                        function:
                            dayMonthYear:
                                title: День-Месяц-Год
                                expression: CONCAT(CONCAT(CONCAT(CONCAT(LPAD(DAY(UserCourseSession.start), 2, '0'), '.'), LPAD(MONTH(UserCourseSession.start), 2, '0')), '.'), YEAR(UserCourseSession.start))
                                type: string
                            monthYear:
                                title: Месяц-Год
                                expression: CONCAT(CONCAT(LPAD(MONTH(UserCourseSession.start), 2, '0'), '.'), YEAR(UserCourseSession.start))
                                type: string
                            year:
                                title: Год
                                expression: YEAR(UserCourseSession.start)
                                type: string
                        aggregation:
                            - group_concat
                            - group_concat_distinct
                            - count
                            - count_distinct
            UserLessonSession:
                title: Сеанс работы с занятием
                fields:
                    sessionStart3:
                        table: UserLessonSession
                        title: Время входа в занятие
                        type: string
                        field: start
                        function:
                            dayMonthYear:
                                title: День-Месяц-Год
                                expression: CONCAT(CONCAT(CONCAT(CONCAT(LPAD(DAY(UserLessonSession.start), 2, '0'), '.'), LPAD(MONTH(UserLessonSession.start), 2, '0')), '.'), YEAR(UserLessonSession.start))
                                type: string
                            monthYear:
                                title: Месяц-Год
                                expression: CONCAT(CONCAT(LPAD(MONTH(UserLessonSession.start), 2, '0'), '.'), YEAR(UserLessonSession.start))
                                type: string
                            year:
                                title: Год
                                expression: YEAR(UserLessonSession.start)
                                type: string
                        aggregation:
                            - group_concat
                            - group_concat_distinct
                            - count
                            - count_distinct
            Subject:
                title: Учебный курс
                fields:
                    subjectId:
                        table: Subject
                        title: ID курса
                        type: string
                        field: subid
                        aggregation:
                            - count
                    subjectTitle:
                        table: Subject
                        title: Название курса
                        type: string
                        field: name
                        aggregation:
                            - group_concat
                            - count
            Schedule:
                title: Занятие
                fields:
                    scheduleId:
                        table: Schedule
                        title: ID занятия
                        type: string
                        field: SHEID
                        aggregation:
                            - group_concat
                            - count
                    scheduleName:
                        table: Schedule
                        title: Название занятия
                        type: string
                        field: title
                        aggregation:
                            - group_concat
                            - count
                    scheduleType:
                        table: Schedule
                        title: Тип занятия
                        type: string
                        field: typeID
                        expression: CASE WHEN (Schedule.typeID = 'empty') THEN 'Без типа' WHEN (Schedule.typeID = 'lecture') THEN 'Раздел учебного модуля' WHEN (Schedule.typeID = 'test') THEN 'Тест' WHEN (Schedule.typeID = 'exercise') THEN 'Упражнение' WHEN (Schedule.typeID = 'course') THEN 'Учебный модуль' WHEN (Schedule.typeID = 'webinar') THEN 'Вебинар' WHEN (Schedule.typeID = 'resource') THEN 'Информационный ресурс' WHEN (Schedule.typeID = 'poll') THEN 'Опрос' WHEN (Schedule.typeID = 'task') THEN 'Задание' WHEN (Schedule.typeID = 2) THEN 'Форум' WHEN (Schedule.typeID = 'eclass') THEN 'Вебинар' END
    Materials:
        title: Учебные материалы
        tables:
            Resource_:
                table: resources
                primary: resource_id
                condition: Resource_.parent_id = 0
                relations:
                    DependentResource:
                        joinOn: Resource_.resource_id = DependentResource.parent_id AND DependentResource.parent_revision_id = 0
                        joinType: left
                    SubjectResource:
                        local: resource_id
                        foreign: resource_id
                        joinType: left
                    Course:
                        joinOn: 0 = 1
                    KbaseAssessment:
                        joinOn: Resource_.resource_id = KbaseAssessment.resource_id AND KbaseAssessment.type = 'resource'
                        joinType: left
                    UserResourceSession:
                        joinOn: UserResourceSession.resource_id = Resource_.resource_id
            DependentResource:
                table: resources
                primary: resource_id
                relations:
                    Resource_:
                        joinOn: Resource_.resource_id = DependentResource.parent_id AND DependentResource.parent_revision_id = 0
                        joinType: left
            SubjectResource:
                table: subjects_resources
                relations:
                    Resource_:
                        local: resource_id
                        foreign: resource_id
                        joinType: left
                    Subject1:
                        local: subject_id
                        foreign: subid
                        joinType: left
            Subject1:
                table: subjects
                primary: subid
                relations:
                    SubjectResource:
                        local: subid
                        foreign: subject_id
                        joinType: left
            Subject2:
                table: subjects
                primary: subid
                relations:
                    SubjectCourse:
                        local: subid
                        foreign: subject_id
                        joinType: left
            Course:
                table: Courses
                primary: CID
                relations:
                    Resource_:
                        joinOn: 0 = 1
                    SubjectCourse:
                        local: CID
                        foreign: course_id
                        joinType: left
            SubjectCourse:
                table: subjects_courses
                relations:
                    Course:
                        local: course_id
                        foreign: CID
                        joinType: left
                    Subject2:
                        local: subject_id
                        foreign: subid
                        joinType: left
            KbaseAssessment:
                table: kbase_assessment
                relations:
                    Resource_:
                        joinOn: Resource_.resource_id = KbaseAssessment.resource_id AND KbaseAssessment.type = 'resource'
                        joinType: left
            Person:
                table: People
                primary: MID
                relations:
                    UserResourceSession:
                        local: MID
                        foreign: mid
            UserResourceSession:
                table: sessions
#                primary: sessid
                relations:
                    Person:
                        local: mid
                        foreign: MID
                    Resource_:
                        joinOn: UserResourceSession.resource_id = Resource_.resource_id
        categories:
            Resource_:
                title: Информационный ресурс
                fields:
                    resourceId:
                        table: Resource_
                        title: ID ресурса
                        type: string
                        field: resource_id
                        aggregation:
                            - count
                    resourceTitle:
                        table: Resource_
                        title: Название ресурса
                        type: string
                        field: title
                    created:
                        table: Resource_
                        title: Дата создания
                        type: date
                        field: created
                        isAggregation: true
                        function:
                            dayMonthYear:
                                title: День-Месяц-Год
                                callback: dayMonthYear
                            monthYear:
                                title: Месяц-Год
                                callback: monthYear
                            year:
                                title: Год
                                callback: year
                    updated:
                        table: Resource_
                        title: Дата обновления
                        type: date
                        field: updated
                        isAggregation: true
                        function:
                            dayMonthYear:
                                title: День-Месяц-Год
                                callback: dayMonthYear
                            monthYear:
                                title: Месяц-Год
                                callback: monthYear
                            year:
                                title: Год
                                callback: year
                    resourceLocation:
                        table: Resource_
                        title: Место хранения
                        type: string
                        expression: CASE WHEN (Resource_.location = 1) THEN 'База знаний' ELSE 'Учебный курс' END
                    resourceStatus:
                        table: Resource_
                        title: Статус
                        type: string
                        expression: CASE WHEN (Resource_.status = 1) THEN 'Опубликован' WHEN (Resource_.status = 7) THEN 'Ограниченное использование' ELSE 'Не опубликован' END
                    type:
                        table: Resource_
                        title: Тип ресурса
                        type: string
                        expression: CASE WHEN (Resource_.type = 0) THEN 'Файл' ELSE CASE WHEN (Resource_.type = 1) THEN 'HTML-страница' ELSE CASE WHEN (Resource_.type = 2) THEN 'Ссылка на внешний ресурс' ELSE CASE WHEN (Resource_.type = 3) THEN 'HTML-сайт' ELSE CASE WHEN (Resource_.type = 4) THEN 'Запись вебинара' ELSE 'Сервис взаимодействия' END END END END END
                    volume:
                        table: Resource_
                        title: Размер
                        type: string
                        field: volume
                    filename:
                        table: Resource_
                        title: Имя файла
                        type: string
                        field: filename
                    filetype:
                        table: Resource_
                        title: Тип файла
                        type: string
                        expression: CASE WHEN (Resource_.filetype = 1) THEN 'Текстовый файл' ELSE CASE WHEN (Resource_.filetype = 2) THEN 'HTML-страница' ELSE CASE WHEN (Resource_.filetype = 3) THEN 'Изображение' ELSE CASE WHEN (Resource_.filetype = 4) THEN 'Аудио-файл' ELSE CASE WHEN (Resource_.filetype = 5) THEN 'Видео-файл' ELSE CASE WHEN (Resource_.filetype = 6) THEN 'Flash' ELSE CASE WHEN (Resource_.filetype = 7) THEN 'Документ MS Word' ELSE CASE WHEN (Resource_.filetype = 8) THEN 'Таблица MS Excel' ELSE CASE WHEN (Resource_.filetype = 9) THEN 'Презентация MS PowePoint' ELSE CASE WHEN (Resource_.filetype = 10) THEN 'Документ PDF' ELSE '' END END END END END END END END END END
                    activitytype:
                        table: Resource_
                        title: Тип сервиса взаимодействия
                        type: string
                        expression: CASE WHEN (Resource_.activity_type = 2) THEN 'Форум' ELSE CASE WHEN (Resource_.filetype = 64) THEN 'Блог' ELSE CASE WHEN (Resource_.filetype = 128) THEN 'Wiki' ELSE CASE WHEN (Resource_.filetype = 512) THEN 'Протокол чата' ELSE '' END END END END
                    raiting:
                        table: KbaseAssessment
                        title: Рейтинг
                        type: integer
                        isAggregation: true
                        expression: CASE WHEN (AVG(KbaseAssessment.assessment) IS NOT NULL) THEN AVG(KbaseAssessment.assessment) ELSE 0 END
            UserResourceSession:
                title: Просмотр
                fields:
                    sessionId:
                        table: UserResourceSession
                        title: ID сессии
                        type: string
                        field: sessid
                        aggregation:
                            - group_concat
                            - count
                    duration:
                        table: UserResourceSession
                        title: Длительность (часов)
                        type: integer
                        field: duration
                        expression: FLOOR((UNIX_TIMESTAMP(UserResourceSession.stop) - UNIX_TIMESTAMP(UserResourceSession.start)) / 60 / 60)
                        expressionFields: start, stop
            Person:
                title: Пользователь
                fields:
                    personId:
                        table: Person
                        title: ID пользователя
                        type: string
                        field: MID
                        aggregation:
                            - group_concat
                            - count
                    fio:
                        table: Person
                        title: ФИО
                        type: string
                        field: fio
                        expression: CONCAT(CONCAT(CONCAT(CONCAT(Person.LastName, ' '), Person.FirstName), ' '), Person.Patronymic)
                        expressionFields: LastName, FirstName, Patronymic
                    login:
                        table: Person
                        title: Логин
                        type: string
                        field: Login
                    gender:
                        table: Person
                        title: Пол
                        type: string
                        expression: CASE WHEN (Person.Gender = 2) THEN 'Женский' ELSE 'Мужской' END
                    age:
                        table: Person
                        title: Возраст
                        type: string
                        field: BirthDate
                        callback: getUserAge
            DependentResource:
                title: Несколько файлов в одном ресурсе
                fields:
                    dependentFilename:
                        table: DependentResource
                        title: Имя файла
                        type: string
                        field: filename
                        aggregation:
                            - group_concat
            Course:
                title: Учебный модуль
                fields:
                    courseId:
                        table: Course
                        title: ID учебного модуля
                        type: string
                        field: CID
                        aggregation:
                            - count
                    courseTitle:
                        table: Course
                        title: Название учебного модуля
                        type: string
                        field: Title
                    courseLocation:
                        table: Course
                        title: Место хранения
                        type: string
                        expression: CASE WHEN (Course.chain = 0) THEN 'База знаний' ELSE 'Учебный курс' END
                    courseStatus:
                        table: Course
                        title: Статус
                        type: string
                        expression: CASE WHEN (Course.status = 1) THEN 'Опубликован' WHEN (Course.status = 7) THEN 'Ограниченное использование' WHEN (Course.status = 2) THEN 'Архивный' WHEN (Course.status = 0) THEN 'Не опубликован (в разработке)' END
            Subject1:
                title: Использeтся в учебном курсе (ресурс)
                fields:
                    subjectId:
                        table: Subject1
                        title: ID учебного курса
                        type: string
                        field: subid
                        aggregation:
                            - count
                    subjectTitle:
                        table: Subject1
                        title: Название учебного курса
                        type: string
                        field: name
                        aggregation:
                            - group_concat
            Subject2:
                title: Использeтся в учебном курсе (учебный модуль)
                fields:
                    subjectId:
                        table: Subject2
                        title: ID учебного курса
                        type: string
                        field: subid
                        aggregation:
                            - count
                    subjectTitle:
                        table: Subject2
                        title: Название учебного курса
                        type: string
                        field: name
                        aggregation:
                            - group_concat
    Assessment:
        title: Общая статистика оценочных сессий
        tables:
            ClassifierPerson:
                table: classifiers
                primary: classifier_id
                relations:
                    ClassifierPersonLink:
                        local: classifier_id
                        foreign: classifier_id
            ClassifierPersonLink:
                table: classifiers_links
                relations:
                    ClassifierPerson:
                        local: classifier_id
                        foreign: classifier_id
                    PersonUser:
                        joinOn: ClassifierPersonLink.type = 3 AND ClassifierPersonLink.item_id = PersonUser.MID
            TopDepartmentUser:
                table: structure_of_organ
                primary: soid
                relations:
                    DepartmentUser:
                        joinOn: TopDepartmentUser.lft < DepartmentUser.lft AND TopDepartmentUser.rgt > DepartmentUser.rgt AND TopDepartmentUser.level = 0
                    UpDepartmentUser:
                        joinOn: TopDepartmentUser.lft < UpDepartmentUser.lft AND TopDepartmentUser.rgt > UpDepartmentUser.rgt AND TopDepartmentUser.level = 0
            UpDepartmentUser:
                table: structure_of_organ
                primary: soid
                relations:
                    TopDepartmentUser:
                        joinOn: TopDepartmentUser.lft < UpDepartmentUser.lft AND TopDepartmentUser.rgt > UpDepartmentUser.rgt AND TopDepartmentUser.level = 0
                    DepartmentUser:
                        local: soid
                        foreign: owner_soid
            DepartmentUser:
                table: structure_of_organ
                primary: soid
                relations:
                    TopDepartmentUser:
                        joinOn: TopDepartmentUser.lft < DepartmentUser.lft AND TopDepartmentUser.rgt > DepartmentUser.rgt AND TopDepartmentUser.level = 0
                    UpDepartmentUser:
                        local: owner_soid
                        foreign: soid
                    PositionUser:
                        local: soid
                        foreign: owner_soid
            PositionUser:
                table: structure_of_organ
                primary: soid
                relations:
                    PersonUser:
                        local: mid
                        foreign: MID
                    DepartmentUser:
                        local: owner_soid
                        foreign: soid
            PersonUser:
                table: People
                primary: MID
                relations:
                    PositionUser:
                        local: MID
                        foreign: mid
                    ClassifierPersonLink:
                        joinOn: PersonUser.MID = ClassifierPersonLink.item_id AND ClassifierPersonLink.type = 3
                    SessionUser:
                        local: MID
                        foreign: user_id
                    UserKpi:
                        local: MID
                        foreign: user_id
            SessionUser:
                table: at_session_users
                relations:
                    Session:
                        joinOn: Session.session_id = SessionUser.session_id AND Session.programm_type = 1
                    PersonUser:
                        local: user_id
                        foreign: MID
                    SessionUserCriterionValue:
                        joinType: left
                        local: session_user_id
                        foreign: session_user_id
                    AtProfiles:
                        local: profile_id
                        foreign: profile_id
                    SessionUserRating:
                        joinOn: SessionUser.session_user_id = SessionUserRating.session_user_id AND SessionUserRating.criterion_id = 0
                    SessionEvent:
                        local: session_user_id
                        foreign: session_user_id
            TopDepartmentRespondent:
                table: structure_of_organ
                primary: soid
                relations:
                    DepartmentRespondent:
                        joinOn: TopDepartmentRespondent.lft < DepartmentRespondent.lft AND TopDepartmentRespondent.rgt > DepartmentRespondent.rgt AND TopDepartmentRespondent.level = 0
            DepartmentRespondent:
                table: structure_of_organ
                primary: soid
                relations:
                    TopDepartmentRespondent:
                        joinOn: TopDepartmentRespondent.lft < DepartmentRespondent.lft AND TopDepartmentRespondent.rgt > DepartmentRespondent.rgt AND TopDepartmentRespondent.level = 0
                    PositionRespondent:
                        local: soid
                        foreign: owner_soid
            PositionRespondent:
                table: structure_of_organ
                primary: soid
                relations:
                    PersonRespondent:
                        local: mid
                        foreign: MID
                    DepartmentRespondent:
                        local: owner_soid
                        foreign: soid
            PersonRespondent:
                table: People
                primary: MID
                relations:
                    PositionRespondent:
                        local: MID
                        foreign: mid
                    SessionRespondent:
                        local: MID
                        foreign: user_id
            SessionRespondent:
                table: at_session_respondents
                relations:
                    SessionEvent:
                        local: session_respondent_id
                        foreign: session_respondent_id
                    PersonRespondent:
                        local: user_id
                        foreign: MID
            SessionEvent:
                table: at_session_events
                relations:
                    SessionRespondent:
                        local: session_respondent_id
                        foreign: session_respondent_id
                    SessionUser:
                        local: session_user_id
                        foreign: session_user_id
            Session:
                table: at_sessions
                primary: session_id
                relations:
                    SessionUser:
                        joinOn: Session.session_id = SessionUser.session_id AND Session.programm_type = 1
#                    Cycles:
#                        local: cycle_id
#                        foreign: cycle_id
            SessionUserCriterionValue:
                table: at_session_user_criterion_values
                relations:
                    SessionUser:
                        joinType: left
                        local: session_user_id
                        foreign: session_user_id
                    Criteria:
                        joinType: left
                        joinOn: Criteria.criterion_id = SessionUserCriterionValue.criterion_id AND SessionUserCriterionValue.criterion_type = 1
                    CriteriaTest:
                        joinType: left
                        joinOn: CriteriaTest.criterion_id = SessionUserCriterionValue.criterion_id AND SessionUserCriterionValue.criterion_type = 2
                    CriteriaPersonal:
                        joinType: left
                        joinOn: CriteriaPersonal.criterion_id = SessionUserCriterionValue.criterion_id AND SessionUserCriterionValue.criterion_type = 3
            SessionUserRating:
                table: at_session_pair_ratings
                relations:
                    SessionUser:
                        joinOn: SessionUser.session_user_id = SessionUserRating.session_user_id AND SessionUserRating.criterion_id = 0
            Criteria:
                table: at_criteria
                relations:
                    SessionUserCriterionValue:
                        joinType: left
                        joinOn: Criteria.criterion_id = SessionUserCriterionValue.criterion_id AND SessionUserCriterionValue.criterion_type = 1
                    AtProfileCriterionValue:
                        joinOn: Criteria.criterion_id = AtProfileCriterionValue.criterion_id AND AtProfileCriterionValue.criterion_type = 1
            CriteriaPersonal:
                table: at_criteria_personal
                relations:
                    SessionUserCriterionValue:
                        joinType: left
                        joinOn: CriteriaPersonal.criterion_id = SessionUserCriterionValue.criterion_id AND SessionUserCriterionValue.criterion_type = 3
                    AtProfileCriterionValue:
                        joinOn: CriteriaPersonal.criterion_id = AtProfileCriterionValue.criterion_id AND AtProfileCriterionValue.criterion_type = 3
            CriteriaTest:
                table: at_criteria_test
                relations:
                    SessionUserCriterionValue:
                        joinType: left
                        joinOn: CriteriaTest.criterion_id = SessionUserCriterionValue.criterion_id AND SessionUserCriterionValue.criterion_type = 2
                    AtProfileCriterionValue:
                        joinOn: CriteriaTest.criterion_id = AtProfileCriterionValue.criterion_id AND AtProfileCriterionValue.criterion_type = 2
                    CriteriaTestGroup:
                        joinType: left
                        joinOn: CriteriaTestGroup.lft < CriteriaTest.lft AND CriteriaTestGroup.rgt > CriteriaTest.lft AND CriteriaTestGroup.level + 1 = CriteriaTest.level
            CriteriaTestGroup:
                table: at_criteria_test
                relations:
                    CriteriaTest:
                        joinType: left
                        joinOn: CriteriaTestGroup.lft < CriteriaTest.lft AND CriteriaTestGroup.rgt > CriteriaTest.lft AND CriteriaTestGroup.level + 1 = CriteriaTest.level
            AtProfiles:
                table: at_profiles
                relations:
                    SessionUser:
                        local: profile_id
                        foreign: profile_id
                    AtProfileCriterionValue:
                        local: profile_id
                        foreign: profile_id
            AtProfileCriterionValue:
                table: at_profile_criterion_values
                relations:
                    AtProfiles:
                        local: profile_id
                        foreign: profile_id
                    Criteria:
                        joinOn: Criteria.criterion_id = AtProfileCriterionValue.criterion_id AND AtProfileCriterionValue.criterion_type = 1
                    CriteriaPersonal:
                        joinOn: CriteriaPersonal.criterion_id = AtProfileCriterionValue.criterion_id AND AtProfileCriterionValue.criterion_type = 3
                    CriteriaTest:
                        joinOn: CriteriaTest.criterion_id = AtProfileCriterionValue.criterion_id AND AtProfileCriterionValue.criterion_type = 2
#            Cycles:
#                table: cycles
#                relations:
#                    Session:
#                        local: cycle_id
#                        foreign: cycle_id
            UserKpi:
                table: at_user_kpis
                relations:
                    PersonUser:
                        local: user_id
                        foreign: MID
                    Cycle:
                        local: cycle_id
                        foreign: cycle_id
                    Kpi:
                        local: kpi_id
                        foreign: kpi_id
            Cycle:
                table: cycles
                relations:
                    UserKpi:
                        local: cycle_id
                        foreign: cycle_id
            Kpi:
                table: at_kpis
                relations:
                    UserKpi:
                        local: kpi_id
                        foreign: kpi_id
                    KpiUnit:
                        local: kpi_unit_id
                        foreign: kpi_unit_id
                        joinType: left
                    KpiCluster:
                        local: kpi_cluster_id
                        foreign: kpi_cluster_id
                        joinType: left
            KpiUnit:
                table: at_kpi_units
                relations:
                    Kpi:
                        local: kpi_unit_id
                        foreign: kpi_unit_id
                        joinType: left
            KpiCluster:
                table: at_kpi_clusters
                relations:
                    Kpi:
                        local: kpi_cluster_id
                        foreign: kpi_cluster_id
                        joinType: left
        categories:
            Session:
                title: Оценочная сессия
                fields:
                    sessionId:
                        table: Session
                        title: ID сессии
                        type: string
                        field: session_id
                        aggregation:
                            - count
                    sessionCycle:
                        table: Cycle
                        title: Оценочный период
                        type: string
                        field: name
                    sessionTitle:
                        table: Session
                        title: Название сессии
                        type: string
                        field: name
                        aggregation:
                            - group_concat
                    sessionBegin:
                        table: Session
                        title: Дата начала
                        type: date
                        field: begin_date
                        isAggregation: true
                        function:
                            dayMonthYear:
                                title: День-Месяц-Год
                                expression: CONCAT(CONCAT(CONCAT(CONCAT(LPAD(DAY(Session.begin), 2, '0'), '.'), LPAD(MONTH(Session.begin), 2, '0')), '.'), YEAR(Session.begin))
                            monthYear:
                                title: Месяц-Год
                                expression: CONCAT(CONCAT(LPAD(MONTH(Session.begin), 2, '0'), '.'), YEAR(Session.begin))
                            year:
                                title: Год
                                expression: YEAR(Session.begin)
                    sessionEnd:
                        table: Session
                        title: Дата окончания
                        type: date
                        field: end_date
                        isAggregation: true
                        function:
                            dayMonthYear:
                                title: День-Месяц-Год
                                expression: CONCAT(CONCAT(CONCAT(CONCAT(LPAD(DAY(Session.end), 2, '0'), '.'), LPAD(MONTH(Session.end), 2, '0')), '.'), YEAR(Session.end))
                            monthYear:
                                title: Месяц-Год
                                expression: CONCAT(CONCAT(LPAD(MONTH(Session.end), 2, '0'), '.'), YEAR(Session.end))
                            year:
                                title: Год
                                expression: YEAR(Session.end)
            SessionUser:
                title: Участник оценки
                fields:
                    sessionUserId:
                        table: SessionUser
                        title: ID участника
                        type: string
                        field: session_user_id
                        aggregation:
                            - count                
                    fio:
                        table: PersonUser
                        title: ФИО участника
                        type: string
                        field: fio
                        expression: CONCAT(CONCAT(CONCAT(CONCAT(PersonUser.LastName, ' '), PersonUser.FirstName), ' '), PersonUser.Patronymic)
                        expressionFields: LastName, FirstName, Patronymic
                        aggregation:
                            - group_concat
                    topDepartment:
                        table: TopDepartmentUser
                        title: Подразделение 1-го уровня
                        type: string
                        field: name
                    upDepartment:
                        table: UpDepartmentUser
                        title: Вышестоящее подразделение
                        type: string
                        field: name
                    departmentId:
                        table: DepartmentUser
                        title: ID подразделения
                        type: string
                        field: soid
                        aggregation:
                            - count
                    department:
                        table: DepartmentUser
                        title: Подразделение
                        type: string
                        field: name
                    profile:
                        table: AtProfiles
                        title: Профиль должности
                        type: string
                        field: name
                    position:
                        table: PositionUser
                        title: Должность
                        type: string
                        field: name
                    is_manager:
                        table: PositionUser
                        title: Признак руководителя
                        type: string
                        field: is_manager
                        expression: CASE WHEN (PositionUser.is_manager = 1) THEN 'Да' ELSE 'Нет' END
                    experience:
                        table: PositionUser
                        title: Стаж (в мес.)
                        field: position_date
                        callback: getExperience
                    login:
                        table: PersonUser
                        title: Логин
                        type: string
                        field: Login
                    gender:
                        table: PersonUser
                        title: Пол
                        type: string
                        expression: CASE WHEN (Gender = 2) THEN 'Женский' ELSE 'Мужской' END
                    age:
                        table: PersonUser
                        title: Возраст
                        type: string
                        expression: CASE WHEN ((YEAR(NOW()) - YEAR(BirthDate)) < 100) THEN YEAR(NOW()) - YEAR(BirthDate) ELSE 0 END
                    personClassifier:
                        table: ClassifierPerson
                        title: Классификация пользователя
                        type: string
                        field: name
                        aggregation:
                            - group_concat
                    status:
                        table: SessionUser
                        title: Статус
                        type: string
                        field: status
                        function:
                            notempty:
                                title: Окончена
                                expression: CASE WHEN (SessionUser.status < 2) THEN 'Нет' ELSE 'Да' END
                        aggregation:
                            - count
                    kpi:
                        table: SessionUser
                        title: Ранг результативности
                        type: float
                        field: total_kpi
                    competence:
                        table: SessionUser
                        title: Соответствие профилю успешности
                        type: float
                        field: total_competence
                    rating:
                        table: SessionUserRating
                        title: Рейтинг в парных сравнениях
                        type: float
                        field: rating
                    category:
                        table: SessionUser
                        title: Категория по итогам оценки
                        type: string
                        expression: CASE WHEN (result_category = 1) THEN 'Группа риска' ELSE (CASE WHEN (result_category = 2) THEN 'Группа разбора' ELSE (CASE WHEN (result_category = 3) THEN 'Старательные' ELSE (CASE WHEN (result_category = 4) THEN 'Перспективные' ELSE (CASE WHEN (result_category = 5) THEN 'Эксперты' ELSE (CASE WHEN (result_category = 6) THEN 'Лидеры' ELSE '' END) END) END) END) END) END
            Criteria:
                title: Компетенции
                fields:
                    criterionId:
                        table: Criteria
                        title: ID компетенции
                        type: string
                        field: criterion_id
                        aggregation:
                            - count                
                    criterionName:
                        table: Criteria
                        title: Название компетенции
                        type: string
                        field: name     
                    sessionUserCriterionValue:
                        table: SessionUserCriterionValue
                        title: Результат оценки компетенции
                        type: float
                        field: value
                        aggregation:
                            - min
                            - max
                            - avg
            CriteriaTest: 
                 title: Квалификации
                 fields:
                    criterionTestId:
                        table: CriteriaTest
                        title: ID квалификации
                        type: string
                        field: criterion_id
                        aggregation:
                            - count  
                    criterionTestName:
                        table: CriteriaTest
                        title: Название квалификации
                        type: string
                        field: name
                    criterionTestNameGroup:
                        table: CriteriaTestGroup
                        title: Название группы квалификации
                        type: string
                        field: name
                    sessionUserCriteriaTestValue:
                        table: SessionUserCriterionValue
                        title: Результат оценки квалификации
                        field: value
#            CriteriaPersonal: 
#                 title: Личностные характеристики
#                 fields:
#                    criterionName:
#                        table: CriteriaPersonal
#                        title: Название личностной характеристики
#                        type: string
#                        field: name
            Kpi: 
                 title: Показатели эффективности
                 fields:
                    kpiName:
                        table: Kpi
                        title: Название показателя
                        type: string
                        field: name
                    kpiCluster:
                        table: KpiCluster
                        title: Название кластера показателей
                        type: string
                        field: name
                    kpiUnit:
                        table: KpiUnit
                        title: Единица измерения
                        type: string
                        field: name
                    kpiPlanValue:
                        table: UserKpi
                        title: Плановое значение
                        type: float
                        field: value_plan
                    kpiFactValue:
                        table: UserKpi
                        title: Фактическое значение
                        type: float
                        field: value_fact
                        function:
                            relative:
                                title: Относительная величина
                                expression: ROUND(100*UserKpi.value_fact/UserKpi.value_plan)
                            relativeWeighted:
                                title: Взвешенная величина
                                expression: ROUND(100*UserKpi.weight*UserKpi.value_fact/UserKpi.value_plan)
                            exceed:
                                title: Превышение плана
                                expression: CASE WHEN ((UserKpi.value_fact IS NULL) OR (UserKpi.value_plan > UserKpi.value_fact)) THEN 'Нет' ELSE 'Да' END
                        aggregation:
                            - sum
                            - count
                            - min
                            - max
                            - avg
                    cycleName:
                        table: Cycle
                        title: Оценочный период
                        type: string
                        field: name
                    cycleEnd:
                        table: Cycle
                        title: Дата окончания периода
                        type: date
                        field: end_date
                        isAggregation: true
                        function:
                            dayMonthYear:
                                title: День-Месяц-Год
                                expression: CONCAT(CONCAT(CONCAT(CONCAT(LPAD(DAY(Cycle.end_date), 2, '0'), '.'), LPAD(MONTH(Cycle.end_date), 2, '0')), '.'), YEAR(Cycle.end_date))
                            monthYear:
                                title: Месяц-Год
                                expression: CONCAT(CONCAT(LPAD(MONTH(Cycle.end_date), 2, '0'), '.'), YEAR(Cycle.end_date))
                            year:
                                title: Год
                                expression: YEAR(Cycle.end_date)
            SessionEvent:
                title: Анкета
                fields:
                    sessionEventId:
                        table: SessionEvent
                        title: ID анкеты
                        type: string
                        field: session_event_id
                        aggregation:
                            - count                
                    sessionEventName:
                        table: SessionEvent
                        title: Название
                        type: string
                        field: name
            SessionRespondent:
                title: Респондент
                fields:
                    sessionRespondentId:
                        table: SessionRespondent
                        title: ID респондента
                        type: string
                        field: session_respondent_id
                        aggregation:
                            - count                
                    fioRespondent:
                        table: PersonRespondent
                        title: ФИО респондента
                        type: string
                        field: fio
                        expression: CONCAT(CONCAT(CONCAT(CONCAT(PersonRespondent.LastName, ' '), PersonRespondent.FirstName), ' '), PersonRespondent.Patronymic)
                        expressionFields: LastName, FirstName, Patronymic
                        aggregation:
                            - group_concat
                    topDepartmentRespondent:
                        table: TopDepartmentRespondent
                        title: Подразделение 1-го уровня
                        type: string
                        field: name
                    departmentRespondent:
                        table: DepartmentRespondent
                        title: Подразделение
                        type: string
                        field: name
                    positionRespondent:
                        table: PositionRespondent
                        title: Должность
                        type: string
                        field: name
                    isManagerRespondent:
                        table: PositionRespondent
                        title: Признак руководителя
                        type: string
                        field: is_manager
                        expression: CASE WHEN (PositionRespondent.is_manager = 1) THEN 'Да' ELSE 'Нет' END
                    experienceRespondent:
                        table: PositionRespondent
                        title: Стаж (в мес.)
                        field: position_date
                        callback: getExperience
                    loginRespondent:
                        table: PersonRespondent
                        title: Логин
                        type: string
                        field: Login
                    genderRespondent:
                        table: PersonRespondent
                        title: Пол
                        type: string
                        expression: CASE WHEN (Gender = 2) THEN 'Женский' ELSE 'Мужской' END
                    ageRespondent:
                        table: PersonRespondent
                        title: Возраст
                        type: string
                        expression: CASE WHEN ((YEAR(NOW()) - YEAR(BirthDate)) < 100) THEN YEAR(NOW()) - YEAR(BirthDate) ELSE 0 END
    ExternalStaffReserv:
        title: Внешний кадровый резерв
        tables:
            Reservist:
                table: recruit_reservists
                primary: reservist_id
        categories:
            Reservist:
                title: Резевист
                fields:
                    company:
                        table: Reservist
                        title: Наименование организации
                        type:  string
                        field: company
                    department:
                        table: Reservist
                        title: Структурное подразделение
                        type:  string
                        field: department
                    brigade:
                        table: Reservist
                        title: Бригада
                        type:  string
                        field: brigade
                    position:
                        table: Reservist
                        title: Должность
                        type:  string
                        field: position
                    fio:
                        table: Reservist
                        title: Фамилия, имя, отчество
                        type:  string
                        field: fio
                    gender:
                        table: Reservist
                        title: Пол
                        type:  string
                        field: gender
                    snils:
                        table: Reservist
                        title: СНИЛС
                        type:  string
                        field: snils
                    birthday:
                        table: Reservist
                        title: Дата рождения
                        type:  date
                        field: birthday
                    age:
                        table: Reservist
                        title: Возраст
                        type:  string
                        field: age
                    region:
                        table: Reservist
                        title: Регион проживания
                        type:  string
                        field: region
                    citizenship:
                        table: Reservist
                        title: Гражданство
                        type:  string
                        field: citizenship
                    phone:
                        table: Reservist
                        title: Телефон личный
                        type:  string
                        field: phone
                    phone_family:
                        table: Reservist
                        title: Телефон членов семьи
                        type:  string
                        field: phone_family
                    email:
                        table: Reservist
                        title: e-mail
                        type:  string
                        field: email
                    position_experience:
                        table: Reservist
                        title: Стаж работы в должности (профессии)
                        type:  string
                        field: position_experience
                    sgc_experience:
                        table: Reservist
                        title: Стаж работы в СГК
                        type:  string
                        field: sgc_experience
                    education:
                        table: Reservist
                        title: Основное образование
                        type:  string
                        field: education
                    retraining:
                        table: Reservist
                        title: Профессиональная переподготовка
                        type:  string
                        field: retraining
                    training:
                        table: Reservist
                        title: Повышение квалификации
                        type:  string
                        field: training
                    qualification_result:
                        table: Reservist
                        title: Результаты проверки/подтверждения квалификации
                        type:  string
                        field: qualification_result
                    rewards:
                        table: Reservist
                        title: Наличие поощрений, наград
                        type:  string
                        field: rewards
                    violations:
                        table: Reservist
                        title: Сведения о наличии нарушений требований ОТ, ПБ и ООС
                        type:  string
                        field: violations
                    comments_dkz_pk:
                        table: Reservist
                        title: Наличие замечаний от ДКЗиПК
                        type:  string
                        field: comments_dkz_pk
                    relocation_readiness:
                        table: Reservist
                        title: Готовность к релокации для работы на объектах СГК
                        type:  string
                        field: relocation_readiness
                    evaluation_degree:
                        table: Reservist
                        title: Оценка степени профессиональной ценности, качества работы и исполнительской надежности по результатам анкетирования
                        type:  string
                        field: evaluation_degree
                    leadership:
                        table: Reservist
                        title: Лидерство в бригаде (структурном подразделении)
                        type:  string
                        field: leadership
                    productivity:
                        table: Reservist
                        title: Производительность труда
                        type:  string
                        field: productivity
                    quality_information:
                        table: Reservist
                        title: Сведения о качестве выполняемых работ
                        type:  string
                        field: quality_information
                    salary:
                        table: Reservist
                        title: Должностной оклад
                        type:  string
                        field: salary
                    hourly_rate:
                        table: Reservist
                        title: Часовая тарифная ставка
                        type:  string
                        field: hourly_rate
                    annual_income_rks:
                        table: Reservist
                        title: Среднегодовой доход (с РКС)
                        field: annual_income_rks
                        type:  integer
                        aggregation:
                            - sum
                            - max
                            - min
                            - avg                        
                    annual_income_no_rks:
                        table: Reservist
                        title: Среднегодовой доход (без РКС)
                        field: annual_income_no_rks
                        type:  integer
                        aggregation:
                            - sum
                            - max
                            - min
                            - avg                        
                    monthly_income_rks:
                        table: Reservist
                        title: Среднемесячный доход (с РКС)
                        field: monthly_income_rks
                        type:  integer
                        aggregation:
                            - sum
                            - max
                            - min
                            - avg                        
                    monthly_income_no_rks:
                        table: Reservist
                        title: Среднемесячный доход (без РКС)
                        field: monthly_income_no_rks
                        type:  integer
                        aggregation:
                            - sum
                            - max
                            - min
                            - avg                        
    Recruiting:
        title: Общая статистика сессий подбора
        tables:
            ClassifierPerson:
                table: classifiers
                primary: classifier_id
                relations:
                    ClassifierPersonLink:
                        joinType: left
                        local: classifier_id
                        foreign: classifier_id
            ClassifierPersonLink:
                table: classifiers_links
                relations:
                    ClassifierPerson:
                        joinType: left
                        local: classifier_id
                        foreign: classifier_id
                    PersonUser:
                        joinType: left
                        joinOn: ClassifierPersonLink.type = 3 AND ClassifierPersonLink.item_id = PersonUser.MID
            TopDepartmentVacancy:
                table: structure_of_organ
                primary: soid
                relations:
                    DepartmentVacancy:
                        joinOn: TopDepartmentVacancy.lft < DepartmentVacancy.lft AND TopDepartmentVacancy.rgt > DepartmentVacancy.rgt AND TopDepartmentVacancy.level = 0 AND DepartmentVacancy.type=0
                    UpDepartmentVacancy:
                        joinOn: TopDepartmentVacancy.lft < UpDepartmentVacancy.lft AND TopDepartmentVacancy.rgt > UpDepartmentVacancy.rgt AND TopDepartmentVacancy.level = 0 AND UpDepartmentVacancy.type=0
            UpDepartmentVacancy:
                table: structure_of_organ
                primary: soid
                relations:
                    TopDepartmentVacancy:
                        joinOn: TopDepartmentVacancy.lft < UpDepartmentVacancy.lft AND TopDepartmentVacancy.rgt > UpDepartmentVacancy.rgt AND TopDepartmentVacancy.level = 0 AND UpDepartmentVacancy.type=0
                    DepartmentVacancy:
                        joinOn: UpDepartmentVacancy.soid = DepartmentVacancy.owner_soid AND DepartmentVacancy.type=0
            DepartmentVacancy:
                table: structure_of_organ
                primary: soid
                relations:
                    TopDepartmentVacancy:
                        joinOn: TopDepartmentVacancy.lft < DepartmentVacancy.lft AND TopDepartmentVacancy.rgt > DepartmentVacancy.rgt AND TopDepartmentVacancy.level = 0 AND DepartmentVacancy.type=0
                    UpDepartmentVacancy:
                        joinOn: UpDepartmentVacancy.soid = DepartmentVacancy.owner_soid AND DepartmentVacancy.type=0
                    PositionVacancy:
                        joinOn: PositionVacancy.owner_soid = DepartmentVacancy.soid AND PositionVacancy.type=1
            PositionVacancy:
                table: structure_of_organ
                primary: soid
                relations:
                    Vacancy:
                        local: soid
                        foreign: position_id
                    DepartmentVacancy:
                        joinOn: PositionVacancy.owner_soid = DepartmentVacancy.soid AND PositionVacancy.type=1
                    Profile:
                        local: profile_id
                        foreign: profile_id
            Vacancy:
                table: recruit_vacancies
                primary: vacancy_id
                relations:
                    PositionVacancy:
                        local: position_id
                        foreign: soid
                    VacancyCandidate:
                        local: vacancy_id
                        foreign: vacancy_id
            VacancyCandidate:
                table: recruit_vacancy_candidates
                primary: vacancy_candidate_id
                relations:
                    Vacancy:
                        local: vacancy_id
                        foreign: vacancy_id
                    Candidate:
                        local: candidate_id
                        foreign: candidate_id
                    SessionUser:
                        local: vacancy_candidate_id
                        foreign: vacancy_candidate_id
            Candidate:
                table: recruit_candidates
                primary: candidate_id
                relations:
                    VacancyCandidate:
                        local: candidate_id
                        foreign: candidate_id
                    PersonCandidate:
                        local: user_id
                        foreign: MID
            PersonCandidate:
                table: People
                primary: MID
                relations:
                    ClassifierPersonLink:
                        joinType: left
                        joinOn: PersonCandidate.MID = ClassifierPersonLink.item_id AND ClassifierPersonLink.type = 3
                    Candidate:
                        local: MID
                        foreign: user_id
            SessionUser:
                table: at_session_users
                relations:
                    Session:
                        joinOn: Session.session_id = SessionUser.session_id AND Session.programm_type = 2
                    VacancyCandidate:
                        local: vacancy_candidate_id
                        foreign: vacancy_candidate_id
                    SessionUserCriterionValue:
                        joinType: left
                        local: session_user_id
                        foreign: session_user_id
            Session:
                table: at_sessions
                primary: session_id
                relations:
                    SessionUser:
                        joinOn: Session.session_id = SessionUser.session_id AND Session.programm_type = 2
            SessionUserCriterionValue:
                table: at_session_user_criterion_values
                relations:
                    SessionUser:
                        joinType: left
                        local: session_user_id
                        foreign: session_user_id
                    ProfileCriterionValue:
                        joinType: left
                        joinOn: ProfileCriterionValue.profile_id = SessionUser.profile_id AND ProfileCriterionValue.criterion_id = SessionUserCriterionValue.criterion_id AND ProfileCriterionValue.criterion_type = SessionUserCriterionValue.criterion_type
                    Criteria:
                        joinOn: Criteria.criterion_id = SessionUserCriterionValue.criterion_id AND SessionUserCriterionValue.criterion_type = 1
            Criteria:
                table: criteria
                relations:
                    SessionUserCriterionValue:
                        joinOn: Criteria.criterion_id = SessionUserCriterionValue.criterion_id AND SessionUserCriterionValue.criterion_type = Criteria.criterion_type
            Profile:
                table: at_profiles
                relations:
                    PositionVacancy:
                        local: profile_id
                        foreign: profile_id
            ProfileCriterionValue:
                table: at_profile_criterion_values
                relations:
                    SessionUserCriterionValue:
                        joinType: left
                        joinOn: ProfileCriterionValue.profile_id = SessionUser.profile_id AND ProfileCriterionValue.criterion_id = SessionUserCriterionValue.criterion_id AND ProfileCriterionValue.criterion_type = SessionUserCriterionValue.criterion_type
        categories:
            Vacancy:
                title: Сессия подбора
                fields:
                    vacancyId:
                        table: Vacancy
                        title: ID сессии
                        type: string
                        field: vacancy_id
                        aggregation:
                            - count
                    vacancyName:
                        table: Vacancy
                        title: Название
                        type: string
                        field: name
                        aggregation:
                            - count
                    topDepartment:
                        table: TopDepartmentVacancy
                        title: Подразделение 1-го уровня
                        type: string
                        field: name
                    upDepartment:
                        table: UpDepartmentVacancy
                        title: Вышестоящее подразделение
                        type: string
                        field: name
                    departmentId:
                        table: DepartmentVacancy
                        title: ID подразделения
                        type: string
                        field: soid
                        aggregation:
                            - count
                    department:
                        table: DepartmentVacancy
                        title: Подразделение
                        type: string
                        field: name
                    position:
                        table: PositionVacancy
                        title: Должность
                        type: string
                        field: name
                    profile:
                        table: Profile
                        title: Профиль должности
                        type: string
                        field: name
                    is_manager:
                        table: PositionVacancy
                        title: Признак руководителя
                        type: string
                        field: is_manager
                        expression: CASE WHEN (PositionVacancy.is_manager = 1) THEN 'Да' ELSE 'Нет' END
                    vacancyBegin:
                        table: Vacancy
                        title: Дата начала
                        type: date
                        field: open_date
                        isAggregation: true
                        function:
                            dayMonthYear:
                                title: День-Месяц-Год
                                expression: CONCAT(CONCAT(CONCAT(CONCAT(LPAD(DAY(Vacancy.begin), 2, '0'), '.'), LPAD(MONTH(Vacancy.begin), 2, '0')), '.'), YEAR(Vacancy.begin))
                            monthYear:
                                title: Месяц-Год
                                expression: CONCAT(CONCAT(LPAD(MONTH(Vacancy.begin), 2, '0'), '.'), YEAR(Vacancy.begin))
                            year:
                                title: Год
                                expression: YEAR(Vacancy.begin)
                    vacancyEnd:
                        table: Vacancy
                        title: Дата окончания
                        type: date
                        field: close_date
                        isAggregation: true
                        function:
                            dayMonthYear:
                                title: День-Месяц-Год
                                expression: CONCAT(CONCAT(CONCAT(CONCAT(LPAD(DAY(Vacancy.end), 2, '0'), '.'), LPAD(MONTH(Vacancy.end), 2, '0')), '.'), YEAR(Vacancy.end))
                            monthYear:
                                title: Месяц-Год
                                expression: CONCAT(CONCAT(LPAD(MONTH(Vacancy.end), 2, '0'), '.'), YEAR(Vacancy.end))
                            year:
                                title: Год
                                expression: YEAR(Vacancy.end)
            VacancyCandidate:
                title: Кандидат
                fields:
                    vacancyCandidateId:
                        table: VacancyCandidate
                        title: ID кандидата
                        type: string
                        field: vacancy_candidate_id
                        aggregation:
                            - count                
                    fio:
                        table: PersonCandidate
                        title: ФИО кандидата
                        type: string
                        field: fio
                        expression: CONCAT(CONCAT(CONCAT(CONCAT(PersonCandidate.LastName, ' '), PersonCandidate.FirstName), ' '), PersonCandidate.Patronymic)
                        expressionFields: LastName, FirstName, Patronymic
                        aggregation:
                            - group_concat
                    login:
                        table: PersonCandidate
                        title: Логин
                        type: string
                        field: Login
                    gender:
                        table: PersonCandidate
                        title: Пол
                        type: string
                        expression: CASE WHEN (Gender = 2) THEN 'Женский' ELSE 'Мужской' END
                    age:
                        table: PersonCandidate
                        title: Возраст
                        type: string
                        expression: CASE WHEN ((YEAR(NOW()) - YEAR(BirthDate)) < 100) THEN YEAR(NOW()) - YEAR(BirthDate) ELSE 0 END
                    personClassifier:
                        table: ClassifierPerson
                        title: Классификация пользователя
                        type: string
                        field: name
                        aggregation:
                            - group_concat
                    status:
                        table: SessionUser
                        title: Статус
                        type: string
                        field: status
                        function:
                            notempty:
                                title: Окончена
                                expression: CASE WHEN (SessionUser.status < 2) THEN 'Нет' ELSE 'Да' END
                        aggregation:
                            - count
                    competence:
                        table: SessionUser
                        title: Соответствие профилю должности
                        type: float
                        field: total_competence
            SessionUserCriterionValue:
                title: Результаты оценки
                fields:
                    criterionType:
                        table: sessionUserCriterionValue
                        title: Тип критерия
                        type: string
                        expression: CASE WHEN (SessionUserCriterionValue.criterion_type = 1) THEN 'Компетенция' ELSE CASE WHEN (SessionUserCriterionValue.criterion_type = 2) THEN 'Квалификация' ELSE 'Личностная характеристика' END END
                    criterionName:
                        table: Criteria
                        title: Название критерия
                        type: string
                        field: name
                    sessionUserCriterionValue:
                        table: SessionUserCriterionValue
                        title: Результат оценки
                        type: float
                        field: value
                        aggregation:
                            - min
                            - max
                            - avg
                    profileCriterionValue:
                        table: ProfileCriterionValue
                        title: Уровень успешности
                        field: value
                        aggregation:
                            - min
                            - max
                            - avg
                        function:
                            notempty:
                                title: Превышен
                                expression: CASE WHEN (SessionUserCriterionValue.value < ProfileCriterionValue.value) THEN 'Нет' ELSE 'Да' END
    Tc:
        title: Внешнее обучение
        tables:
            ClassifierSubject:
                table: classifiers
                primary: classifier_id
                relations:
                    ClassifierSubjectLink:
                        local: classifier_id
                        foreign: classifier_id
                        joinType: left
            ClassifierSubjectLink:
                table: classifiers_links
                relations:
                    ClassifierSubject:
                        local: classifier_id
                        foreign: classifier_id
                        joinType: left
                    Subject:
                        joinOn: ClassifierSubjectLink.type = 0 AND ClassifierSubjectLink.item_id = Subject.subid
                        joinType: left
            Position:
                table: structure_of_organ
                primary: soid
                relations:
                    Person:
                        local: mid
                        foreign: MID
                    Department:
                        local: owner_soid
                        foreign: soid
            Department:
                table: structure_of_organ
                primary: soid
                relations:
                    Position:
                        local: soid
                        foreign: owner_soid
            Person:
                table: People
                primary: MID
                relations:
                    Position:
                        local: MID
                        foreign: mid
                    Application:
                        joinOn: Person.MID = Application.user_id AND Application.status = 2
            Application:
                table: tc_applications
                relations:
                    Subject:
                        joinOn: Subject.subid = Application.subject_id AND Application.status = 2
                    Person:
                        joinOn: Person.MID = Application.user_id AND Application.status = 2
                    SessionDepartment:
                        joinOn: SessionDepartment.session_department_id = Application.session_department_id AND Application.status = 2
            Subject:
                table: subjects
                primary: subid
                relations:
                    ClassifierSubjectLink:
                        joinOn: Subject.subid = ClassifierSubjectLink.item_id AND ClassifierSubjectLink.type = 0
                        joinType: left
                    Application:
                        joinOn: Subject.subid = Application.subject_id AND Application.status = 2
                    Provider:
                        local: provider_id
                        foreign: provider_id
            Provider:
                table: tc_providers
                relations:
                    Subject:
                        local: provider_id
                        foreign: provider_id
            TcSession:
                table: tc_sessions
                relations:
                    SessionDepartment:
                        local: session_department_id
                        foreign: session_department_id
            SessionDepartment:
                table: tc_session_departments
                relations:
                    TcSession:
                        local: session_department_id
                        foreign: session_department_id
                    Application:
                        joinOn: SessionDepartment.session_department_id = Application.session_department_id AND Application.status = 2
                    DepartmentSessionDepartment:
                        local: department_id
                        foreign: soid
            DepartmentSessionDepartment:
                table: structure_of_organ
                relations:
                    SessionDepartment:
                        local: soid
                        foreign: department_id
        categories:
            Orgstructure:
                title: Подразделение пользователя
                fields:
                    departmentId:
                        table: Department
                        title: ID подразделения
                        type: string
                        field: soid
                        aggregation:
                            - count                
                    department:
                        table: Department
                        title: Название подразделения
                        type: string
                        field: name
                    position:
                        table: Position
                        title: Должность
                        type: string
                        field: name
            Person:
                title: пользователь
                fields:
                    personId:
                        table: Person
                        title: ID пользователя
                        type: string
                        field: MID
                        aggregation:
                            - count
                    fio:
                        table: Person
                        title: ФИО
                        type: string
                        field: fio
                        expression: CASE WHEN CONCAT(CONCAT(CONCAT(CONCAT(Person.LastName, ' '), Person.FirstName), ' '), Person.Patronymic) IS NULL THEN 'Нет' ELSE CONCAT(CONCAT(CONCAT(CONCAT(Person.LastName, ' '), Person.FirstName), ' '), Person.Patronymic) END
                        expressionFields: LastName, FirstName, Patronymic
                        aggregation:
                            - group_concat                        
                    login:
                        table: Person
                        title: Логин
                        type: string
                        field: Login
                    gender:
                        table: Person
                        title: Пол
                        type: string
                        expression: CASE WHEN (Person.Gender = 2) THEN 'Женский' ELSE 'Мужской' END
                    age:
                        table: Person
                        title: Возраст
                        type: string
                        expression: CASE WHEN ((YEAR(NOW()) - YEAR(Person.BirthDate)) < 100) THEN YEAR(NOW()) - YEAR(Person.BirthDate) ELSE 0 END
            Application:
                title: Заявка 
                fields:
                    applicationId:
                        table: Application
                        title: ID заявки
                        type: string
                        field: application_id
                        aggregation:
                            - count
                    applicationQuarter:
                        table: Application
                        title: Период
                        type: string
                        field: period
            SessionDepartment:
                title: Консолидированная заявка 
                fields:
                    sessionDepartmentId:
                        table: SessionDepartment
                        title: ID консолидированной заявки
                        type: string
                        field: session_department_id
                        aggregation:
                            - count
                    sessionDepartmentTitle:
                        table: DepartmentSessionDepartment
                        title: Название департамента
                        type: string
                        field: name
            TcSession:
                title: Сессия годового планирования 
                fields:
                    tcSessionTitle:
                        table: TcSession
                        title: Название сессии
                        type: string
                        field: name
            Subject:
                title: Курс 
                fields:
                    subjectId:
                        table: Subject
                        title: ID курса
                        type: string
                        field: subid
                        aggregation:
                            - count
                    subjectTitle:
                        table: Subject
                        title: Название курса
                        type: string
                        field: name
                        aggregation:
                            - group_concat
                    subjectPrice:
                        table: Subject
                        title: Стоимость
                        type: string
                        field: price
                        aggregation:
                            - sum
                    subjectClassifier:
                        table: ClassifierSubject
                        title: Классификация курса
                        type: string
                        field: name
                        aggregation:
                            - group_concat
            Provider:
                title: Провайдер 
                fields:
                    providerId:
                        table: Provider
                        title: ID провайдера
                        type: string
                        field: provider_id
                        aggregation:
                            - count
                    providerTitle:
                        table: Provider
                        title: Название провайдера
                        type: string
                        field: name
                        aggregation:
                            - group_concat
    Timesheets:
        title: Учёт рабочего времени
        tables:
            Timesheet:
                table: timesheets
                primary: timesheet_id
                relations:
                    ActionType:
                        local: action_type
                        foreign: classifier_id
                        joinType: inner
                    Person:
                        local: user_id
                        foreign: MID
                        joinType: inner
            ActionType:
                table: classifiers
                primary: classifier_id
                relations:
                    Timesheet:
                        local: classifier_id
                        foreign: action_type
                        joinType: inner
            Person:
                table: People
                primary: MID
                relations:
                    Timesheet:
                        local: MID
                        foreign: user_id
                        joinType: inner
        categories:
            Person:
                title: пользователь
                fields:
                    fio:
                        table: Person
                        title: ФИО
                        type: string
                        field: fio
                        expression: CASE WHEN CONCAT(CONCAT(CONCAT(CONCAT(Person.LastName, ' '), Person.FirstName), ' '), Person.Patronymic) IS NULL THEN 'Нет' ELSE CONCAT(CONCAT(CONCAT(CONCAT(Person.LastName, ' '), Person.FirstName), ' '), Person.Patronymic) END
                        expressionFields: LastName, FirstName, Patronymic
                        aggregation:
                            - group_concat
                    actionType:
                        table: ActionType
                        title: Тип активности
                        type: string
                        field: name
                    actionDescription:
                        table: Timesheet
                        title: Описание активности
                        type: string
                        field: description
                    actionStart:
                        table: Timesheet
                        title: Дата/Время начала активности
                        type: string
                        expression: CONCAT(CONCAT(CONCAT(Timesheet.action_date, ' '), Timesheet.begin_time), ' ')
                        expressionFields: action_date, begin_time
                    actionEnd:
                        table: Timesheet
                        title: Дата/Время окончания активности
                        type: string
                        expression: CONCAT(CONCAT(CONCAT(Timesheet.action_date, ' '), Timesheet.end_time), ' ')
                        expressionFields: action_date, end_time
                    actionDuration:
                        table: Timesheet
                        title: Продолжительность активности (минут)
                        type: integer
                        expression: FLOOR((UNIX_TIMESTAMP(end_time) - UNIX_TIMESTAMP(begin_time)) / 60)
                        expressionFields: begin_time, end_time